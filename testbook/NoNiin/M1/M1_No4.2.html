<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŠ¬å…°è¯­ç²¾è¯» - ç¬¬å››è¯¾ (Kaisan luona)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&family=Noto+Sans:wght@400;700&display=swap');

        :root {
            /* ä¿æŒé£æ ¼ä¸€è‡´ï¼Œå¾®è°ƒé…è‰²ä»¥åŒºåˆ†è¯¾ç¨‹ (æ¸©æš–çš„æ©™çº¢è‰²è°ƒï¼Œå¯¹åº”å®¶åº­èšä¼š) */
            --primary-gradient: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            --card-back-gradient: linear-gradient(135deg, #434343 0%, #000000 100%); /* æ·±è‰²èƒŒæ™¯çªå‡ºæ–‡å­— */
            --accent-color: #fda085;
            --text-color: #2d3748;
            --bg-color: #fff1eb;
        }

        body {
            font-family: 'Noto Sans', 'Noto Sans SC', sans-serif;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            color: var(--text-color);
            margin: 0;
            min-height: 100vh;
        }

        /* è¿”å›æŒ‰é’® */
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(135deg, #8fd3f4 0%, #84fab0 100%); /* æ¸…æ–°çš„ç»¿è‰²è¿”å›é”® */
            color: #1a202c;
            border: none;
            border-radius: 50px;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            z-index: 1000;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        h1 {
            text-align: center;
            color: #1a202c;
            margin-bottom: 10px;
            font-weight: 800;
            font-size: 2rem;
        }

        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 40px;
            max-width: 600px;
            line-height: 1.5;
        }

        /* å¡ç‰‡ç½‘æ ¼ */
        .card-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 30px;
            width: 100%;
            max-width: 1400px;
            margin-bottom: 60px;
        }

        /* å¡ç‰‡åŸºç¡€ç»“æ„ */
        .card {
            background-color: transparent;
            width: 100%;
            height: 420px; /* é€‚é…è¾ƒé•¿çš„è¯­æ³•è§£é‡Š */
            perspective: 1500px;
            cursor: pointer;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s cubic-bezier(0.7, 0, 0.3, 1);
            transform-style: preserve-3d;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            border-radius: 20px;
        }
        
        .card:hover .card-inner {
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
        }

        .card.is-flipped .card-inner {
            transform: rotateY(180deg);
        }

        /* å¡ç‰‡æ­£åé¢é€šç”¨ */
        .card-front,
        .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            padding: 24px;
            box-sizing: border-box;
            border-radius: 20px;
            overflow: hidden;
        }

        /* å¡ç‰‡æ­£é¢ */
        .card-front {
            background-color: #ffffff;
            color: var(--text-color);
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .card-category {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: 700;
        }
        
        /* é’ˆå¯¹æœ¬è¯¾çš„åˆ†ç±»æ ·å¼ */
        .cat-title { background-color: #fed7d7; color: #9b2c2c; } /* æ ‡é¢˜ */
        .cat-narration { background-color: #bee3f8; color: #2c5282; } /* æ—ç™½ */
        .cat-dialogue { background-color: #c6f6d5; color: #276749; } /* å¯¹è¯ */

        .card-number {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 1.2rem;
            font-weight: 800;
            color: #cbd5e0;
        }

        .fi-text {
            font-size: 1.5rem;
            font-weight: 700;
            line-height: 1.4;
            margin: 20px 0;
            color: #2d3748;
        }

        .speaker-tag {
            font-size: 0.9rem;
            color: #718096;
            font-weight: 600;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        /* å¡ç‰‡èƒŒé¢ */
        .card-back {
            background: var(--card-back-gradient);
            color: #e2e8f0;
            transform: rotateY(180deg);
            text-align: left;
            overflow-y: auto;
            padding-right: 18px;
        }

        .card-back::-webkit-scrollbar { width: 6px; }
        .card-back::-webkit-scrollbar-track { background: rgba(255,255,255,0.1); }
        .card-back::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 10px; }

        .card-back h3 {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #fda085; /* ä½¿ç”¨ä¸»é¢˜è‰²ç‚¹ç¼€ */
            margin: 15px 0 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            padding-bottom: 4px;
        }
        .card-back h3:first-child { margin-top: 0; }

        .chunk-box {
            background: rgba(255,255,255,0.1);
            padding: 8px 12px;
            border-radius: 8px;
            font-family: 'Noto Sans Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 10px;
            border-left: 3px solid #fda085;
        }

        .grammar-text, .zh-text {
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .grammar-text strong { color: #81e6d9; } /* å¼ºè°ƒè‰²å˜æ›´ä¸ºé’è‰²ä»¥åœ¨æ·±åº•ä¸Šæ¸…æ™° */
        .grammar-text em { color: #feb2b2; font-style: normal; text-decoration: underline; }

        /* TTS æŒ‰é’® */
        .tts-btn {
            background: var(--primary-gradient);
            color: #fff;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 15px;
            box-shadow: 0 4px 10px rgba(253, 160, 133, 0.4);
        }

        .tts-btn-small {
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            color: #fff;
            border: none;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.9rem;
            margin-left: 8px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
            vertical-align: middle;
            box-shadow: 0 2px 6px rgba(253, 160, 133, 0.3);
        }

        .tts-btn-small:hover { transform: scale(1.15); }
        .tts-btn-small:active { transform: scale(0.9); }

        .tts-btn:hover { transform: scale(1.1); }
        .tts-btn:active { transform: scale(0.95); }
        .tts-btn.playing { animation: pulse 1.5s infinite; background: #fff; color: #fda085; }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(253, 160, 133, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(253, 160, 133, 0); }
            100% { box-shadow: 0 0 0 0 rgba(253, 160, 133, 0); }
        }

        .flip-hint {
            margin-top: auto;
            font-size: 0.8rem;
            color: #a0aec0;
            font-weight: 500;
        }

        /* æ€»ç»“è¡¨æ ¼åŒºåŸŸ */
        .summary-section {
            width: 100%;
            max-width: 1000px;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            margin-top: 20px;
        }

        .summary-section h2 {
            text-align: left;
            border-bottom: 2px solid #edf2f7;
            padding-bottom: 15px;
            margin-bottom: 25px;
            color: #d05b2d;
        }

        .vocab-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }
        
        .vocab-table th, .vocab-table td {
            text-align: left;
            padding: 12px 15px;
            border-bottom: 1px solid #edf2f7;
        }
        
        .vocab-table th {
            background-color: #fff5f0;
            color: #c05621;
            font-weight: 700;
        }
        
        .vocab-table tr:hover { background-color: #fffaf0; }

        @media (max-width: 600px) {
            .card-container { grid-template-columns: 1fr; }
            h1 { font-size: 1.5rem; }
            .card { height: 460px; } /* ç§»åŠ¨ç«¯é«˜åº¦é€‚é… */
            .summary-section { padding: 20px; }
        }
    </style>
</head>
<body>

    <button class="back-button" onclick="history.back()">
        <span>â†</span> è¿”å›
    </button>

    <h1>ç¬¬å››è¯¾ï¼šKaisan luona</h1>
    <p class="subtitle">åŒ…å«å…¥æ ¼(Illatiivi)ã€éƒ¨åˆ†æ ¼(Partitiivi)ä¸é«˜çº§ KPT å˜æ¢<br>é‡ç‚¹ï¼šåŠ¨è¯ç±»å‹4ä¸5ã€æ¡ä»¶å¼</p>

    <div class="card-container" id="cardContainer">
        <!-- å¡ç‰‡å°†é€šè¿‡ JS åŠ¨æ€ç”Ÿæˆ -->
    </div>

    <!-- è¯æ±‡æ€»ç»“åŒºåŸŸ -->
    <div class="summary-section">
        <h2>é•¿éš¾èŠ¬å…°è¯­å•è¯è¯­æ³•åˆ†è§£è¡¨ (Sanasto ja Kielioppi)</h2>
        
        <table class="vocab-table">
            <thead>
                <tr><th>å•è¯</th><th>ä¸­æ–‡</th><th>æ„è¯æ³•ä¸å˜å½¢è§£é‡Š (Morphology & KPT)</th></tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>soi</strong> <button class="tts-btn-small" onclick="speak(this, 'soi')" title="å¬å‘éŸ³">ğŸ”Š</button></td>
                    <td>å“</td>
                    <td><strong>åŸå½¢: soida (VT2)</strong>ã€‚å»æ‰ da â†’ soiã€‚æ—  KPTã€‚</td>
                </tr>
                <tr>
                    <td><strong>avaa</strong> <button class="tts-btn-small" onclick="speak(this, 'avaa')" title="å¬å‘éŸ³">ğŸ”Š</button></td>
                    <td>æ‰“å¼€</td>
                    <td><strong>åŸå½¢: avata (VT4)</strong>ã€‚å»æ‰ ta + a â†’ avaaã€‚æ³¨æ„åŸå½¢é‡Œçš„ t æ¶ˆå¤±äº†ã€‚</td>
                </tr>
                <tr>
                    <td><strong>oven</strong> <button class="tts-btn-small" onclick="speak(this, 'oven')" title="å¬å‘éŸ³">ğŸ”Š</button></td>
                    <td>é—¨ (å®¾è¯­)</td>
                    <td><strong>åŸå½¢: ovi</strong>ã€‚è¯å¹²å˜åŒ–: i â†’ e (ove-) + å®¾æ ¼ -nã€‚</td>
                </tr>
                <tr>
                    <td><strong>tuliainen</strong> <button class="tts-btn-small" onclick="speak(this, 'tuliainen')" title="å¬å‘éŸ³">ğŸ”Š</button></td>
                    <td>ä¼´æ‰‹ç¤¼</td>
                    <td><strong>-nen åè¯</strong>: ä¸»æ ¼å½¢å¼ã€‚è®°ä½è¯å¹²æ˜¯ tuliaise-ã€‚</td>
                </tr>
                <tr>
                    <td><strong>onnea</strong> <button class="tts-btn-small" onclick="speak(this, 'onnea')" title="å¬å‘éŸ³">ğŸ”Š</button></td>
                    <td>è¿æ°”/å¿«ä¹</td>
                    <td><strong>åŸå½¢: onni</strong>ã€‚éƒ¨åˆ†æ ¼: i â†’ e (onne-) + éƒ¨åˆ†æ ¼ -aã€‚</td>
                </tr>
                <tr>
                    <td><strong>tarvinnut</strong> <button class="tts-btn-small" onclick="speak(this, 'tarvinnut')" title="å¬å‘éŸ³">ğŸ”Š</button></td>
                    <td>éœ€è¦ (åˆ†è¯)</td>
                    <td><strong>åŸå½¢: tarvita (VT5)</strong>ã€‚è¯å¹² tarvitse- â†’ è¿‡å»åˆ†è¯åç¼€ -nnutã€‚</td>
                </tr>
                <tr>
                    <td><strong>kengÃ¤t</strong> <button class="tts-btn-small" onclick="speak(this, 'kengÃ¤t')" title="å¬å‘éŸ³">ğŸ”Š</button></td>
                    <td>é‹å­ (å¤æ•°)</td>
                    <td><strong>åŸå½¢: kenkÃ¤</strong>ã€‚KPT (nk > ng): å¤æ•° -t å¯¼è‡´é—­éŸ³èŠ‚ï¼Œè§¦å‘å¼±é˜¶ ngã€‚</td>
                </tr>
                <tr>
                    <td><strong>eteiseen</strong> <button class="tts-btn-small" onclick="speak(this, 'eteiseen')" title="å¬å‘éŸ³">ğŸ”Š</button></td>
                    <td>è¿›é—¨å…</td>
                    <td><strong>åŸå½¢: eteinen</strong>ã€‚å…¥æ ¼: -nen è¯å¹²å˜ä¸º -se + å…¥æ ¼ -en â†’ eteiseenã€‚</td>
                </tr>
                <tr>
                    <td><strong>takin</strong> <button class="tts-btn-small" onclick="speak(this, 'takin')" title="å¬å‘éŸ³">ğŸ”Š</button></td>
                    <td>å¤–å¥— (å®¾è¯­)</td>
                    <td><strong>åŸå½¢: takki</strong>ã€‚KPT (kk > k): å®¾æ ¼ -n å¯¼è‡´é—­éŸ³èŠ‚ï¼Œè§¦å‘å¼±é˜¶ kã€‚</td>
                </tr>
                <tr>
                    <td><strong>naulakkoon</strong> <button class="tts-btn-small" onclick="speak(this, 'naulakkoon')" title="å¬å‘éŸ³">ğŸ”Š</button></td>
                    <td>è¿›è¡£æ¶</td>
                    <td><strong>å…¥æ ¼ä¾‹å¤–!</strong> å…¥æ ¼ (Illatiivi) ä¸å‘ç”Ÿ KPT å˜åŒ–ï¼Œ<strong>ä¿ç•™å¼ºé˜¶ kk</strong>ã€‚</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        // æ ¸å¿ƒæ•°æ®ï¼šåŒ…å« Markdown ä¸­çš„æ‰€æœ‰å¥å­å’Œåˆ†æ
        const lessonData = [
            // --- Title ---
            {
                speaker: "",
                fi: "Kaisan luona",
                zh: "åœ¨ Kaisa å®¶",
                category: "title",
                chunks: "Kaisan (Kaisaçš„) / luona (é‚£é‡Œ/ä½å¤„)",
                grammar: "<strong>luona</strong>: åç½®è¯ï¼Œè¡¨ç¤º<strong>é™æ€</strong>çš„ä½ç½®ã€‚è¦æ±‚å‰é¢çš„è¯ç”¨å±æ ¼ (-n)ã€‚<br>å¯¹æ¯”ï¼šluokse (å»...é‚£é‡Œï¼ŒåŠ¨æ€)ã€‚"
            },
            // --- Intro ---
            {
                speaker: "",
                fi: "Kello 12.15 ovikello soi.",
                zh: "12ç‚¹15åˆ†ï¼Œé—¨é“ƒå“äº†ã€‚",
                category: "narration",
                chunks: "Kello 12.15 / ovikello (é—¨é“ƒ) / soi (å“)",
                grammar: "<strong>ovikello</strong>: å¤åˆè¯ ovi + kelloã€‚<br><strong>soi</strong>: åŠ¨è¯ç±»å‹ 2 (soida)ï¼Œå»æ‰ -da å¾—åˆ°è¯å¹²ã€‚"
            },
            {
                speaker: "",
                fi: "Kaisa avaa oven.",
                zh: "Kaisa æ‰“å¼€äº†é—¨ã€‚",
                category: "narration",
                chunks: "Kaisa / avaa (æ‰“å¼€) / oven (é—¨)",
                grammar: "<strong>avaa</strong>: åŠ¨è¯ç±»å‹ 4 (avata)ã€‚KPTç°è±¡: åŸå½¢é‡Œçš„ <em>t</em> åœ¨å˜å½¢æ—¶æ¶ˆå¤± (avata -> avaa)ã€‚<br><strong>oven</strong>: ovi çš„å®¾æ ¼ã€‚è¯å¹²å˜åŒ– i -> e (ove-n)ã€‚"
            },
            // --- Dialogue ---
            {
                speaker: "Sandrine",
                fi: "Moi! TÃ¤ssÃ¤ me nyt olemme.",
                zh: "å—¨ï¼æˆ‘ä»¬åˆ°å•¦ã€‚",
                category: "dialogue",
                chunks: "Moi! / TÃ¤ssÃ¤ (è¿™é‡Œ) / me nyt olemme (æˆ‘ä»¬ç°åœ¨æ˜¯/åˆ°äº†)",
                grammar: "<strong>TÃ¤ssÃ¤</strong>: tÃ¤mÃ¤ (è¿™ä¸ª) çš„å†…æ ¼ã€‚è¡¨ç¤º'åœ¨è¿™é‡Œ'ã€‚"
            },
            {
                speaker: "Kaisa",
                fi: "Moikka! Kiva juttu. Tervetuloa!",
                zh: "å—¨ï¼çœŸå¥½ã€‚æ¬¢è¿æ¬¢è¿ï¼",
                category: "dialogue",
                chunks: "Moikka! / Kiva juttu. / Tervetuloa!",
                grammar: "<strong>juttu</strong>: äº‹æƒ…ã€‚è¿™é‡Œä¿æŒå¼ºé˜¶ ttã€‚<br><strong>Tervetuloa</strong>: å›ºå®šè¡¨è¾¾ã€‚terve + tulo + -a (éƒ¨åˆ†æ ¼)ã€‚"
            },
            {
                speaker: "Sandrine",
                fi: "TÃ¤ssÃ¤ on sinulle pieni tuliainen, ole hyvÃ¤.",
                zh: "è¿™æ˜¯ç»™ä½ çš„å°ç¤¼ç‰©ï¼Œè¯·æ”¶ä¸‹ã€‚",
                category: "dialogue",
                chunks: "TÃ¤ssÃ¤ on / sinulle (ç»™ä½ ) / pieni tuliainen, / ole hyvÃ¤ (è¯·/be good)",
                grammar: "<strong>sinulle</strong>: å‘æ ¼ (Allatiivi, -lle)ã€‚<br><strong>tuliainen</strong>: -nen ç»“å°¾çš„åè¯ã€‚<br><strong>ole hyvÃ¤</strong>: é€’ä¸œè¥¿æ—¶çš„ç¤¼è²Œç”¨è¯­ã€‚"
            },
            {
                speaker: "Sandrine",
                fi: "Ja Sofialle pieni synttÃ¤rilahja. Paljon onnea!",
                zh: "è¿˜æœ‰ç»™ Sofia çš„å°ç”Ÿæ—¥ç¤¼ç‰©ã€‚ç”Ÿæ—¥å¿«ä¹ï¼",
                category: "dialogue",
                chunks: "Ja Sofialle / pieni synttÃ¤rilahja. / Paljon onnea!",
                grammar: "<strong>Paljon</strong>: ä¸å®šé‡è¯ï¼Œè¦æ±‚åé¢å¿…é¡»è·Ÿ<strong>éƒ¨åˆ†æ ¼</strong>ã€‚<br><strong>onnea</strong>: onni (è¿æ°”) çš„éƒ¨åˆ†æ ¼ (i -> e + a)ã€‚"
            },
            {
                speaker: "Kaisa",
                fi: "Voi kiitos, mutta ei sun olisi tarvinnut tuoda mitÃ¤Ã¤n!",
                zh: "å™¢è°¢è°¢ï¼Œä½†ä½ çœŸçš„æ²¡å¿…è¦å¸¦ä»»ä½•ä¸œè¥¿æ¥çš„ï¼",
                category: "dialogue",
                chunks: "mutta ei sun (ä½†æ˜¯ä¸ä½ çš„) / olisi tarvinnut (æœ¬éœ€è¦) / tuoda mitÃ¤Ã¤n!",
                grammar: "<strong>B1/B2 éš¾ç‚¹</strong>: <br><strong>olisi tarvinnut</strong>: å¦å®šå®Œæˆæ¡ä»¶å¼ã€‚è¡¨ç¤º'æœ¬æ¥ä¸éœ€è¦ï¼Œä½†ä½ åšäº†'ã€‚<br><strong>ei sun</strong>: å£è¯­ sinunï¼Œä½œä¸»è¯­ã€‚<br><strong>mitÃ¤Ã¤n</strong>: å¦å®šå¥ä¸­å®¾è¯­ç”¨éƒ¨åˆ†æ ¼ã€‚"
            },
            {
                speaker: "Kaisa",
                fi: "TÃ¤mÃ¤ on tosi kaunis kukkakimppu, kiitti.",
                zh: "è¿™èŠ±æŸçœŸæ¼‚äº®ï¼Œè°¢äº†ã€‚",
                category: "dialogue",
                chunks: "TÃ¤mÃ¤ on / tosi kaunis kukkakimppu, / kiitti.",
                grammar: "<strong>kukkakimppu</strong>: å¤åˆè¯ã€‚kimppu (pp) æ˜¯å¼ºé˜¶ï¼Œä¸»æ ¼ä¸å˜åŒ–ã€‚<br><strong>kiitti</strong>: å£è¯­ kiitosã€‚"
            },
            {
                speaker: "Kaisa",
                fi: "SÃ¤ voit jÃ¤ttÃ¤Ã¤ kengÃ¤t eteiseen ja laittaa takin naulakkoon.",
                zh: "ä½ å¯ä»¥æŠŠé‹å­ç•™åœ¨ç„å…³ï¼ŒæŠŠå¤–å¥—æŒ‚åœ¨è¡£æ¶ä¸Šã€‚",
                category: "dialogue",
                chunks: "jÃ¤ttÃ¤Ã¤ kengÃ¤t (é‹) / eteiseen (è¿›é—¨å…) / ja laittaa takin (å¤–å¥—) / naulakkoon (è¿›è¡£æ¶)",
                grammar: "<strong>KPT é‡ç‚¹å¯¹æ¯”</strong>:<br>1. <strong>kengÃ¤t</strong> (nk->ng): å¤æ•° -t å¯¼è‡´é—­éŸ³èŠ‚ -> å¼±é˜¶ã€‚<br>2. <strong>takin</strong> (kk->k): å®¾æ ¼ -n å¯¼è‡´é—­éŸ³èŠ‚ -> å¼±é˜¶ã€‚<br>3. <strong>naulakkoon</strong> (kk): å…¥æ ¼ (Illatiivi) æ˜¯ä¾‹å¤–ï¼Œ<strong>ä¿æŒå¼ºé˜¶ï¼</strong>"
            }
        ];

        // æ¸²æŸ“å¡ç‰‡
        const container = document.getElementById('cardContainer');

        lessonData.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'card';
            
            // ç¡®å®šç±»åˆ«æ ‡ç­¾æ ·å¼
            let catClass = 'cat-text';
            let catText = 'Teksti';
            
            if (item.category === 'title') { catClass = 'cat-title'; catText = 'Otsikko'; }
            else if (item.category === 'narration') { catClass = 'cat-narration'; catText = 'Kertoja'; }
            else if (item.category === 'dialogue') { catClass = 'cat-dialogue'; catText = 'Dialogi'; }
            
            // åºå·é€»è¾‘ï¼šæ ‡é¢˜ä¸æ ‡å·
            const numberDisplay = item.category === 'title' ? 'â˜…' : index; 
            
            // è¯´è¯äººæ ‡ç­¾
            const speakerHtml = item.speaker ? `<div class="speaker-tag">${item.speaker}:</div>` : '';

            card.innerHTML = `
                <div class="card-inner">
                    <div class="card-front">
                        <span class="card-number">${numberDisplay}</span>
                        <span class="card-category ${catClass}">${catText}</span>
                        ${speakerHtml}
                        <div class="fi-text">${item.fi}</div>
                        <button class="tts-btn" onclick="speak(this, '${item.fi.replace(/'/g, "\\'")}')" title="å¬å‘éŸ³">ğŸ”Š</button>
                        <div class="flip-hint">ç‚¹å‡»æŸ¥çœ‹è§£æ</div>
                    </div>
                    <div class="card-back">
                        <h3>è¯­è¨€ç»„å— (Chunks)</h3>
                        <div class="chunk-box">${item.chunks}</div>
                        
                        <h3>è¯­æ³•åˆ†æ (Kielioppi)</h3>
                        <div class="grammar-text">${item.grammar}</div>
                        
                        <h3>ä¸­æ–‡ç¿»è¯‘ (KÃ¤Ã¤nnÃ¶s)</h3>
                        <div class="zh-text">${item.zh}</div>
                    </div>
                </div>
            `;

            // ç‚¹å‡»å¡ç‰‡ç¿»è½¬é€»è¾‘ï¼ˆæ’é™¤æŒ‰é’®ç‚¹å‡»ï¼‰
            card.addEventListener('click', (e) => {
                if (!e.target.closest('.tts-btn')) {
                    card.classList.toggle('is-flipped');
                }
            });

            container.appendChild(card);
        });

        // TTS è¯­éŸ³åŠŸèƒ½
        let currentBtn = null;

        function speak(btn, text) {
            if (window.speechSynthesis.speaking) {
                return;
            }

            currentBtn = btn;

            // å¤„ç†ç‰¹æ®Šå‘éŸ³è°ƒæ•´ (å¦‚æ•°å­—)
            let speechText = text;
            if (text.includes("12.15")) {
                speechText = text.replace("12.15", "kaksitoista viisitoista");
            }

            const utterance = new SpeechSynthesisUtterance(speechText);
            utterance.lang = 'fi-FI'; // èŠ¬å…°è¯­
            utterance.rate = 0.85; // é€‚åˆæ•™å­¦çš„è¯­é€Ÿ

            btn.classList.add('playing');
            btn.textContent = 'ğŸ”‡';

            utterance.onend = () => {
                if (btn === currentBtn) {
                    btn.classList.remove('playing');
                    btn.textContent = 'ğŸ”Š';
                }
            };

            utterance.onerror = (e) => {
                console.error('TTS Error:', e);
                if (btn === currentBtn) {
                    btn.classList.remove('playing');
                    btn.textContent = 'ğŸ”Š';
                }
                // é™çº§æ–¹æ¡ˆ
                const url = `https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&q=${encodeURIComponent(text)}&tl=fi`;
                new Audio(url).play();
            };

            window.speechSynthesis.speak(utterance);
        }
    </script>
</body>
</html>