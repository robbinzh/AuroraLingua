<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>èŠ¬å…°è¯­å…¥é—¨ - æ¨¡å—äºŒå¤ä¹  (TTS)</title>
    <style>
        body {
            font-family: "Microsoft YaHei", sans-serif;
            line-height: 1.6;
            margin: 20px auto;
            max-width: 900px;
            padding: 0 20px;
        }
        h1, h2, h3, h4 {
            color: #2c3e50;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            overflow-x: auto;
            display: block;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        thead {
            background-color: #f4f4f4;
        }
        .tts-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2em;
            margin-left: 5px;
            padding: 0;
            display: inline-block;
            vertical-align: middle;
        }
        .tts-button:hover {
            opacity: 0.7;
        }
        .debug-section {
            background-color: #fffbf0;
            border: 2px solid #ffa500;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .debug-button {
            background-color: #4CAF50;
            color: white;
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .debug-button:hover {
            background-color: #45a049;
        }
        .note {
            font-size: 0.9em;
            color: #555;
            margin-left: 10px;
        }
        .final-summary ul {
            list-style-type: none;
            padding-left: 0;
        }
        .final-summary ul li {
            margin-bottom: 5px;
        }
        .speakable-block p, .speakable-block li {
            margin-bottom: 5px;
        }
        .scene-block h3 { /* For TTS on scene titles */
            display: inline-block; /* Allows button to be next to it */
        }
    </style>
</head>
<body>

<h1>âœ… æ¨¡å—äºŒé™å®šè¯­æ³•ç³»ç»Ÿå¤ä¹ </h1>

<!-- TTSè°ƒè¯•åŒºåŸŸ -->
<div class="debug-section">
    <h3>ğŸ”§ TTSåŠŸèƒ½æµ‹è¯•</h3>
    <p>å¦‚æœTTSæŒ‰é’®æ²¡æœ‰å£°éŸ³ï¼Œè¯·å…ˆæµ‹è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
    <button class="debug-button" onclick="testBasicTTS()">æµ‹è¯•åŸºæœ¬TTS</button>
    <button class="debug-button" onclick="testFinnishTTS()">æµ‹è¯•èŠ¬å…°è¯­TTS</button>
    <button class="debug-button" onclick="listVoices()">æŸ¥çœ‹å¯ç”¨è¯­éŸ³</button>
    <button class="debug-button" onclick="removeDebugSection()">ç§»é™¤è°ƒè¯•åŒºåŸŸ</button>
    <div id="debug-output" style="margin-top: 10px; padding: 10px; background-color: #f0f0f0; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;"></div>
</div>

<hr>

<section id="grammar-system-summary">
    <h2>âœ… æ¨¡å—äºŒé™å®šè¯­æ³•ç³»ç»Ÿ</h2>
    <table>
        <thead>
            <tr>
                <th>åŠŸèƒ½</th>
                <th>åŠ¨è¯</th>
                <th>ç»“æ„ (æ ¼)</th>
                <th>ç¤ºä¾‹</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>æ„æ„¿</td><td><span class="speakable-finnish">Haluan</span></td><td>éƒ¨åˆ†æ ¼</td><td><span class="speakable-finnish">Haluan kahvia.</span></td></tr>
            <tr><td>éœ€è¦</td><td><span class="speakable-finnish">Tarvitsen</span></td><td>éƒ¨åˆ†æ ¼</td><td><span class="speakable-finnish">Tarvitsen kahvia.</span></td></tr>
            <tr><td>å–œæ¬¢</td><td><span class="speakable-finnish">PidÃ¤n</span></td><td>å‡ºæ ¼</td><td><span class="speakable-finnish">PidÃ¤n kahvista.</span></td></tr>
            <tr><td>å–</td><td><span class="speakable-finnish">Juon</span></td><td>éƒ¨åˆ†æ ¼</td><td><span class="speakable-finnish">Juon kahvia.</span></td></tr>
            <tr><td>åƒ</td><td><span class="speakable-finnish">SyÃ¶n</span></td><td>éƒ¨åˆ†æ ¼</td><td><span class="speakable-finnish">SyÃ¶n leipÃ¤Ã¤.</span></td></tr>
            <tr><td>å¦å®šæ„æ„¿</td><td><span class="speakable-finnish">En halua</span></td><td>éƒ¨åˆ†æ ¼</td><td><span class="speakable-finnish">En halua kahvia.</span></td></tr>
            <tr><td>å¦å®šéœ€è¦</td><td><span class="speakable-finnish">En tarvitse</span></td><td>éƒ¨åˆ†æ ¼</td><td><span class="speakable-finnish">En tarvitse apua.</span></td></tr>
            <tr><td>å¦å®šå–œæ¬¢</td><td><span class="speakable-finnish">En pidÃ¤</span></td><td>å‡ºæ ¼</td><td><span class="speakable-finnish">En pidÃ¤ mehusta.</span></td></tr>
            <tr><td>å¦å®šå–</td><td><span class="speakable-finnish">En juo</span></td><td>éƒ¨åˆ†æ ¼</td><td><span class="speakable-finnish">En juo mehua.</span></td></tr>
            <tr><td>å¦å®šåƒ</td><td><span class="speakable-finnish">En syÃ¶</span></td><td>éƒ¨åˆ†æ ¼</td><td><span class="speakable-finnish">En syÃ¶ liian makeaa.</span></td></tr>
        </tbody>
    </table>
</section>

<hr>

<section id="scene-cafe">
    <h2>ğŸŒŒ åœºæ™¯ä¸€ï¼šå’–å•¡åº—ï¼ˆæ¨¡å—äºŒé™å®šè¯­æ³•ï¼‰</h2>
    <table>
        <thead>
            <tr>
                <th>èŠ¬å…°è¯­</th>
                <th>ä¸­æ–‡ç¿»è¯‘</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><span class="speakable-finnish">Haluan kahvia, kiitos.</span></td><td>æˆ‘æƒ³è¦ç‚¹å’–å•¡ï¼Œè°¢è°¢ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Juon kahvia.</span></td><td>æˆ‘å–å’–å•¡ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">SyÃ¶n leipÃ¤Ã¤.</span></td><td>æˆ‘åƒé¢åŒ…ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">PidÃ¤n tÃ¤stÃ¤ kahvista.</span></td><td>æˆ‘å–œæ¬¢è¿™ä¸ªå’–å•¡ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En halua mehua.</span></td><td>æˆ‘ä¸æƒ³è¦æœæ±ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En juo mehua.</span></td><td>æˆ‘ä¸å–æœæ±ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En pidÃ¤ tÃ¤stÃ¤ mehusta.</span></td><td>æˆ‘ä¸å–œæ¬¢è¿™ä¸ªæœæ±ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Tarvitsen kahvia.</span></td><td>æˆ‘éœ€è¦å’–å•¡ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">MissÃ¤ on maito?</span></td><td>ç‰›å¥¶åœ¨å“ªï¼Ÿ</td></tr>
            <tr><td><span class="speakable-finnish">Onko tÃ¤mÃ¤ hyvÃ¤Ã¤ kahvia?</span> <span class="note">(TÃ¤ssÃ¤ on hyvÃ¤Ã¤ kahvia? on myÃ¶s ok)</span></td><td>è¿™å’–å•¡å¥½å—ï¼Ÿ</td></tr>
            <tr><td><span class="speakable-finnish">En syÃ¶ tÃ¤tÃ¤. Onko tÃ¤mÃ¤ hyvÃ¤Ã¤?</span></td><td>æˆ‘ä¸åƒè¿™ä¸ªã€‚è¿™ä¸ªå¥½åƒå—ï¼Ÿ</td></tr>
            <tr><td><span class="speakable-finnish">En tarvitse enÃ¤Ã¤.</span></td><td>æˆ‘ä¸éœ€è¦äº†ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Juon jotain lÃ¤mmintÃ¤.</span></td><td>æˆ‘å–ç‚¹çƒ­çš„ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">SyÃ¶n jotain makeaa.</span></td><td>æˆ‘åƒç‚¹ç”œçš„ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Haluan toisen kahvin.</span></td><td>æˆ‘æƒ³è¦å¦ä¸€æ¯å’–å•¡ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">PidÃ¤n tÃ¤stÃ¤. Onko se hyvÃ¤Ã¤?</span></td><td>æˆ‘å–œæ¬¢è¿™ä¸ªã€‚å¥½åƒ/å¥½å–å—ï¼Ÿ</td></tr>
            <tr><td><span class="speakable-finnish">En pidÃ¤ tÃ¤stÃ¤. Haluan jotain toista.</span></td><td>æˆ‘ä¸å–œæ¬¢è¿™ä¸ªã€‚æˆ‘æƒ³è¦åˆ«çš„ã€‚</td></tr>
        </tbody>
    </table>
</section>

<hr>

<section id="scene-restaurant">
    <h2>ğŸ§± åœºæ™¯äºŒï¼šé¤å…ï¼ˆæ¨¡å—äºŒé™å®šè¯­æ³•ï¼‰</h2>
    <table>
        <thead>
            <tr>
                <th>èŠ¬å…°è¯­</th>
                <th>ä¸­æ–‡ç¿»è¯‘</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><span class="speakable-finnish">Haluan ruokaa.</span></td><td>æˆ‘æƒ³è¦ç‚¹åƒçš„ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">SyÃ¶n leipÃ¤Ã¤.</span></td><td>æˆ‘åƒé¢åŒ…ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En halua soppaa.</span></td><td>æˆ‘ä¸æƒ³è¦æ±¤ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">MitÃ¤ syÃ¶t?</span></td><td>ä½ åƒä»€ä¹ˆï¼Ÿ</td></tr>
            <tr><td><span class="speakable-finnish">SyÃ¶n kalaa.</span></td><td>æˆ‘åƒé±¼ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Juon kahvia.</span></td><td>æˆ‘å–å’–å•¡ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">PidÃ¤n tÃ¤stÃ¤ ruoasta.</span></td><td>æˆ‘å–œæ¬¢è¿™ä»½é£Ÿç‰©ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En pidÃ¤ sopasta.</span><span class="note">(sopasta on sopanå‡ºæ ¼)</span></td><td>æˆ‘ä¸å–œæ¬¢æ±¤ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Tarvitsen vettÃ¤.</span></td><td>æˆ‘éœ€è¦æ°´ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Onko tÃ¤mÃ¤ makeaa?</span></td><td>è¿™ç”œå—ï¼Ÿ</td></tr>
            <tr><td><span class="speakable-finnish">En syÃ¶ liian makeaa.</span></td><td>æˆ‘ä¸åƒå¤ªç”œçš„ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Haluan jotain lÃ¤mmintÃ¤.</span></td><td>æˆ‘æƒ³è¦ç‚¹çƒ­çš„ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Juon jotain makeaa.</span></td><td>æˆ‘å–ç‚¹ç”œçš„ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">MitÃ¤ juot?</span></td><td>ä½ å–ä»€ä¹ˆï¼Ÿ</td></tr>
            <tr><td><span class="speakable-finnish">Juon kahvia.</span></td><td>æˆ‘å–å’–å•¡ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Kiitos, en tarvitse lisÃ¤Ã¤.</span></td><td>è°¢è°¢ï¼Œæˆ‘ä¸éœ€è¦æ›´å¤šäº†ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En halua enÃ¤Ã¤.</span></td><td>æˆ‘ä¸æƒ³è¦äº†ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En juo olutta.</span></td><td>æˆ‘ä¸å–å•¤é…’ã€‚</td></tr>
        </tbody>
    </table>
</section>

<hr>

<section id="scene-post-office">
    <h2>ğŸ§¬ åœºæ™¯ä¸‰ï¼šé‚®å±€ / æŸœå°ï¼ˆæ¨¡å—äºŒé™å®šè¯­æ³•ï¼‰</h2>
    <table>
        <thead>
            <tr>
                <th>èŠ¬å…°è¯­</th>
                <th>ä¸­æ–‡ç¿»è¯‘</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><span class="speakable-finnish">Haluan postimerkin.</span> <span class="note">(é‚®ç¥¨ = postimerkki, lipun = ç¥¨)</span></td><td>æˆ‘æƒ³è¦å¼ é‚®ç¥¨ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Tarvitsen lomaketta.</span></td><td>æˆ‘éœ€è¦å¼ è¡¨æ ¼ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En halua tÃ¤tÃ¤.</span></td><td>æˆ‘ä¸æƒ³è¦è¿™ä¸ªã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En tarvitse tÃ¤tÃ¤.</span></td><td>æˆ‘ä¸éœ€è¦è¿™ä¸ªã€‚</td></tr>
            <tr><td><span class="speakable-finnish">PidÃ¤n tÃ¤stÃ¤.</span></td><td>æˆ‘å–œæ¬¢è¿™ä¸ªã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Juon kahvia.</span></td><td>æˆ‘å–å’–å•¡ã€‚ <span class="note">(åœ¨é‚®å±€å–å’–å•¡ï¼Ÿä¹Ÿè®¸æ˜¯ç­‰å¾…æ—¶)</span></td></tr>
            <tr><td><span class="speakable-finnish">SyÃ¶n muroja.</span></td><td>æˆ‘åƒéº¦ç‰‡ã€‚ <span class="note">(åœ¨é‚®å±€åƒéº¦ç‰‡ï¼Ÿåœºæ™¯å¯èƒ½éœ€è¦è°ƒæ•´)</span></td></tr>
            <tr><td><span class="speakable-finnish">En pidÃ¤ tÃ¤stÃ¤.</span></td><td>æˆ‘ä¸å–œæ¬¢è¿™ä¸ªã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En pidÃ¤ siitÃ¤.</span></td><td>æˆ‘ä¸å–œæ¬¢é‚£ä¸ªã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Onko tÃ¤mÃ¤ hyvÃ¤Ã¤ kahvia?</span></td><td>è¿™å’–å•¡å¥½å—ï¼Ÿ</td></tr>
            <tr><td><span class="speakable-finnish">Tarvitsen jotain.</span></td><td>æˆ‘éœ€è¦ç‚¹ä»€ä¹ˆã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Haluan jotain.</span></td><td>æˆ‘æƒ³è¦ç‚¹ä»€ä¹ˆã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En tarvitse enÃ¤Ã¤.</span></td><td>æˆ‘ä¸éœ€è¦äº†ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En halua enÃ¤Ã¤.</span></td><td>æˆ‘ä¸æƒ³è¦äº†ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">MinÃ¤ en pidÃ¤ tÃ¤stÃ¤ muodosta.</span> <span class="note">(muodosta on muodonå‡ºæ ¼)</span></td><td>æˆ‘ä¸å–œæ¬¢è¿™ç§æ ·å¼ã€‚</td></tr>
        </tbody>
    </table>
</section>

<hr>

<section id="language-transformer">
    <h2>ğŸ§® æ¨¡å—äºŒÂ·è¯­è¨€å®‡å®™å˜å½¢å™¨ï¼ˆè¯­å—èåˆè®­ç»ƒï¼‰</h2>
    <table>
        <thead>
            <tr>
                <th>æ¨¡å—äºŒè¯­å—</th>
                <th>ä¸­æ–‡æ˜ å°„</th>
                <th>åŠŸèƒ½</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><span class="speakable-finnish">Juon kahvia. SyÃ¶n leipÃ¤Ã¤.</span></td><td>æˆ‘å–å’–å•¡ã€‚æˆ‘åƒé¢åŒ…ã€‚</td><td>è¡Œä¸ºç»‘å®š</td></tr>
            <tr><td><span class="speakable-finnish">Haluan kahvia. Tarvitsen kahvia.</span></td><td>æˆ‘æƒ³è¦å’–å•¡ã€‚æˆ‘éœ€è¦å’–å•¡ã€‚</td><td>æ„æ„¿+ç°å®</td></tr>
            <tr><td><span class="speakable-finnish">PidÃ¤n kahvista. En pidÃ¤ mehusta.</span></td><td>æˆ‘å–œæ¬¢å’–å•¡ã€‚æˆ‘ä¸å–œæ¬¢æœæ±ã€‚</td><td>å–œå¥½åé¦ˆ</td></tr>
            <tr><td><span class="speakable-finnish">En halua tÃ¤tÃ¤. En syÃ¶ tÃ¤tÃ¤.</span></td><td>æˆ‘ä¸æƒ³è¦è¿™ä¸ªã€‚æˆ‘ä¸åƒè¿™ä¸ªã€‚</td><td>åŒé‡æ‹’ç»</td></tr>
            <tr><td><span class="speakable-finnish">Juon jotain makeaa. SyÃ¶n jotain lÃ¤mmintÃ¤.</span></td><td>æˆ‘å–ç‚¹ç”œçš„ã€‚æˆ‘åƒç‚¹çƒ­çš„ã€‚</td><td>æ¨¡ç³Šè¡¨è¾¾</td></tr>
            <tr><td><span class="speakable-finnish">En tarvitse enÃ¤Ã¤. En halua enÃ¤Ã¤.</span></td><td>æˆ‘ä¸éœ€è¦äº†ã€‚æˆ‘ä¸è¦äº†ã€‚</td><td>ç»“æŸè¡¨è¾¾</td></tr>
        </tbody>
    </table>
</section>

<hr>

<section id="language-bleeding-task-3day" class="speakable-block">
    <h2>ğŸ§ª æ¨¡å—äºŒÂ·è¯­è¨€å‡ºè¡€ä»»åŠ¡ï¼ˆä¸‰æ—¥è®¡åˆ’ï¼‰</h2>
    <h3><span class="speakable-finnish">ğŸ“† ç¬¬1æ—¥ï¼šå’–å•¡åº—æ¤å…¥å®éªŒ</span></h3>
    <ul>
        <li><span class="speakable-finnish">åä¸‹ â†’ è¯´ï¼š"Juon kahvia. SyÃ¶n leipÃ¤Ã¤."</span></li>
        <li><span class="speakable-finnish">è¢«é—®ï¼š"MitÃ¤ haluat?" â†’ å›åº”ï¼š"Juon kahvia. En halua mehua."</span></li>
        <li><span class="speakable-finnish">æœ‹å‹é—®ï¼š"PidÃ¤tkÃ¶?" â†’ å›åº”ï¼š"PidÃ¤n tÃ¤stÃ¤. Onko tÃ¤mÃ¤ hyvÃ¤Ã¤?"</span></li>
    </ul>
    <h3><span class="speakable-finnish">ğŸ“† ç¬¬2æ—¥ï¼šé¤å…æ¤å…¥å®éªŒ</span></h3>
    <ul>
        <li><span class="speakable-finnish">è¢«é—®ï¼š"MitÃ¤ syÃ¶t?" â†’ å›åº”ï¼š"SyÃ¶n kalaa. Juon kahvia."</span></li>
        <li><span class="speakable-finnish">æœåŠ¡å‘˜é€’ä¸Šæ±¤ â†’ è¯´ï¼š"En pidÃ¤ sopasta. Haluan jotain makeaa."</span></li>
        <li><span class="speakable-finnish">æƒ³ç‚¹ç”œå“ â†’ è¯´ï¼š"SyÃ¶n makeaa. En halua mehua."</span></li>
    </ul>
    <h3><span class="speakable-finnish">ğŸ“† ç¬¬3æ—¥ï¼šé‚®å±€æ¤å…¥å®éªŒ</span></h3>
    <ul>
        <li><span class="speakable-finnish">åœ¨é‚®å±€ â†’ æŒ‡ç€é‚®ç¥¨è¯´ï¼š"Haluan postimerkin."</span></li>
        <li><span class="speakable-finnish">è¢«é—®ï¼š"Tarvitsetko apua?" â†’ å›åº”ï¼š"En tarvitse apua."</span></li>
        <li><span class="speakable-finnish">è¢«é—®ï¼š"PidÃ¤tkÃ¶ tÃ¤stÃ¤?" â†’ å›åº”ï¼š"En pidÃ¤. Haluan jotain toista."</span></li>
        <li><span class="speakable-finnish">æƒ³è¦ç¦»å¼€ â†’ è¯´ï¼š"En halua enÃ¤Ã¤. Kiitos."</span></li>
    </ul>
</section>

<hr>

<section id="survival-chunk-summary">
    <h2>ğŸ§± æ¨¡å—äºŒÂ·ç”Ÿå­˜è¯­å—æ€»ç»“ï¼ˆé«˜é¢‘æ¤å…¥æ¸…å•ï¼‰</h2>
    <table>
        <thead>
            <tr>
                <th>è¡¨è¾¾</th>
                <th>ä¸­æ–‡</th>
                <th>ä½¿ç”¨é¢‘ç‡</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><span class="speakable-finnish">Juon kahvia.</span></td><td>æˆ‘å–å’–å•¡ã€‚</td><td>â˜•â˜•â˜•â˜•â˜•</td></tr>
            <tr><td><span class="speakable-finnish">SyÃ¶n leipÃ¤Ã¤.</span></td><td>æˆ‘åƒé¢åŒ…ã€‚</td><td>ğŸ</td></tr>
            <tr><td><span class="speakable-finnish">Haluan kahvia.</span></td><td>æˆ‘æƒ³è¦å’–å•¡ã€‚</td><td>âœ…</td></tr>
            <tr><td><span class="speakable-finnish">Tarvitsen kahvia.</span></td><td>æˆ‘éœ€è¦å’–å•¡ã€‚</td><td>âœ…</td></tr>
            <tr><td><span class="speakable-finnish">En halua mehua.</span></td><td>æˆ‘ä¸æƒ³è¦æœæ±ã€‚</td><td>âœ…</td></tr>
            <tr><td><span class="speakable-finnish">En juo mehua.</span></td><td>æˆ‘ä¸å–æœæ±ã€‚</td><td>âœ…</td></tr>
            <tr><td><span class="speakable-finnish">En pidÃ¤ siitÃ¤.</span></td><td>æˆ‘ä¸å–œæ¬¢é‚£ä¸ªã€‚</td><td>âœ…</td></tr>
            <tr><td><span class="speakable-finnish">En syÃ¶ liian makeaa.</span></td><td>æˆ‘ä¸åƒå¤ªç”œçš„ã€‚</td><td>âœ…</td></tr>
            <tr><td><span class="speakable-finnish">Juon jotain makeaa.</span></td><td>æˆ‘å–ç‚¹ç”œçš„ã€‚</td><td>âœ…</td></tr>
            <tr><td><span class="speakable-finnish">SyÃ¶n jotain lÃ¤mmintÃ¤.</span></td><td>æˆ‘åƒç‚¹çƒ­çš„ã€‚</td><td>âœ…</td></tr>
            <tr><td><span class="speakable-finnish">Haluan jotain lÃ¤mmintÃ¤.</span></td><td>æˆ‘æƒ³è¦ç‚¹çƒ­çš„ã€‚</td><td>âœ…</td></tr>
            <tr><td><span class="speakable-finnish">PidÃ¤n tÃ¤stÃ¤.</span></td><td>æˆ‘å–œæ¬¢è¿™ä¸ªã€‚</td><td>âœ…</td></tr>
            <tr><td><span class="speakable-finnish">MinÃ¤ en halua enÃ¤Ã¤.</span></td><td>æˆ‘ä¸æƒ³è¦äº†ã€‚</td><td>âœ…</td></tr>
            <tr><td><span class="speakable-finnish">MinÃ¤ en tarvitse enÃ¤Ã¤.</span></td><td>æˆ‘ä¸éœ€è¦äº†ã€‚</td><td>âœ…</td></tr>
        </tbody>
    </table>
</section>

<hr>

<section class="final-summary">
    <h3><span class="speakable-finnish">ğŸ§  æ¨¡å—äºŒè®¤çŸ¥ç»‘å®šå®Œæˆè¿›åº¦ï¼š</span></h3>
    <p>ä½ å·²ç»æ„å»ºäº†ä¸€ä¸ªå®Œæ•´çš„ã€åŸºç¡€èŠ¬å…°è¯­ç”Ÿå­˜å®‡å®™ã€‘ï¼š</p>
    <ul>
        <li><span class="speakable-finnish">æ„æ„¿è¡¨è¾¾ â†’ Haluan</span></li>
        <li><span class="speakable-finnish">ç°å®éœ€æ±‚ â†’ Tarvitsen</span></li>
        <li><span class="speakable-finnish">å–œå¥½è¡¨è¾¾ â†’ PidÃ¤n</span></li>
        <li><span class="speakable-finnish">è¡Œä¸ºè¡¨è¾¾ â†’ Juon / SyÃ¶n</span></li>
        <li><span class="speakable-finnish">å¦å®šç³»ç»Ÿ â†’ En halua / En tarvitse / En pidÃ¤ / En juo / En syÃ¶</span></li>
    </ul>
</section>

<script>
/**
 * è°ƒè¯•è¾“å‡ºå‡½æ•°
 * @param {string} message - è¦æ˜¾ç¤ºçš„æ¶ˆæ¯
 */
function debugLog(message) {
    const output = document.getElementById('debug-output');
    if (output) {
        const time = new Date().toLocaleTimeString();
        output.innerHTML += `[${time}] ${message}<br>`;
        output.scrollTop = output.scrollHeight;
    }
    console.log(message);
}

function testBasicTTS() {
    debugLog('å¼€å§‹æµ‹è¯•åŸºæœ¬TTSåŠŸèƒ½...');
    if (!('speechSynthesis' in window)) {
        debugLog('âŒ é”™è¯¯ï¼šæµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆAPI');
        alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½ï¼Œè¯·å°è¯•ä½¿ç”¨Chromeã€Edgeæˆ–Firefoxçš„æœ€æ–°ç‰ˆæœ¬ã€‚');
        return;
    }
    debugLog('âœ… æµè§ˆå™¨æ”¯æŒè¯­éŸ³åˆæˆAPI');
    const utterance = new SpeechSynthesisUtterance('Hello World');
    utterance.onstart = () => debugLog('âœ… è‹±è¯­æµ‹è¯•å¼€å§‹æ’­æ”¾');
    utterance.onend = () => debugLog('âœ… è‹±è¯­æµ‹è¯•æ’­æ”¾å®Œæˆ');
    utterance.onerror = (event) => debugLog('âŒ è‹±è¯­æµ‹è¯•é”™è¯¯: ' + event.error);
    window.speechSynthesis.speak(utterance);
}

function testFinnishTTS() {
    debugLog('å¼€å§‹æµ‹è¯•èŠ¬å…°è¯­TTSåŠŸèƒ½...');
    const utterance = new SpeechSynthesisUtterance('Haluan kahvia, kiitos.'); // Example Finnish sentence
    utterance.lang = 'fi-FI';
    utterance.onstart = () => debugLog('âœ… èŠ¬å…°è¯­æµ‹è¯•å¼€å§‹æ’­æ”¾');
    utterance.onend = () => debugLog('âœ… èŠ¬å…°è¯­æµ‹è¯•æ’­æ”¾å®Œæˆ');
    utterance.onerror = (event) => debugLog('âŒ èŠ¬å…°è¯­æµ‹è¯•é”™è¯¯: ' + event.error);
    window.speechSynthesis.speak(utterance);
}

function listVoices() {
    debugLog('æ­£åœ¨è·å–å¯ç”¨è¯­éŸ³åˆ—è¡¨...');
    const voices = window.speechSynthesis.getVoices();
    if (voices.length === 0) {
        debugLog('âš ï¸ æœªæ‰¾åˆ°ä»»ä½•è¯­éŸ³ï¼Œè¯­éŸ³å¯èƒ½è¿˜åœ¨åŠ è½½ä¸­ã€‚è¯·ç¨åå†è¯•æˆ–æ£€æŸ¥æµè§ˆå™¨è®¾ç½®ã€‚');
        window.speechSynthesis.onvoiceschanged = () => {
            debugLog('è¯­éŸ³åˆ—è¡¨å·²æ›´æ–°ï¼Œé‡æ–°è·å–...');
            const updatedVoices = window.speechSynthesis.getVoices();
            if (updatedVoices.length === 0) {
                 debugLog('âš ï¸ æ›´æ–°åä»æœªæ‰¾åˆ°ä»»ä½•è¯­éŸ³ã€‚');
                 return;
            }
            logVoiceList(updatedVoices);
        };
        return;
    }
    logVoiceList(voices);
}

function logVoiceList(voices) {
    debugLog(`æ‰¾åˆ° ${voices.length} ä¸ªå¯ç”¨è¯­éŸ³:`);
    voices.forEach((voice, index) => {
        const isDefault = voice.default ? ' (é»˜è®¤)' : '';
        debugLog(`${index + 1}. ${voice.name} (${voice.lang})${isDefault}`);
    });
    const finnishVoices = voices.filter(voice => 
        voice.lang.toLowerCase().startsWith('fi') || 
        voice.name.toLowerCase().includes('finnish') ||
        voice.name.toLowerCase().includes('suomi')
    );
    if (finnishVoices.length > 0) {
        debugLog(`âœ… æ‰¾åˆ° ${finnishVoices.length} ä¸ªèŠ¬å…°è¯­è¯­éŸ³:`);
        finnishVoices.forEach(voice => {
            debugLog(`  - ${voice.name} (${voice.lang})`);
        });
    } else {
        debugLog('âŒ æœªæ‰¾åˆ°èŠ¬å…°è¯­è¯­éŸ³ã€‚TTSå¯èƒ½ä½¿ç”¨é»˜è®¤è¯­è¨€æˆ–æ— æ³•æ’­æ”¾èŠ¬å…°è¯­ã€‚');
    }
}

function removeDebugSection() {
    const debugSection = document.querySelector('.debug-section');
    if (debugSection) {
        debugSection.style.display = 'none';
        debugLog('è°ƒè¯•åŒºåŸŸå·²éšè—');
    }
}

let isSpeaking = false;

function speakText(text, lang) {
    debugLog(`å°è¯•æ’­æ”¾: "${text}" (è¯­è¨€: ${lang})`);
    if (!('speechSynthesis' in window)) {
        alert('æŠ±æ­‰ï¼Œæ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆã€‚');
        debugLog('âŒ è¯­éŸ³åˆæˆAPIä¸å¯ç”¨');
        return;
    }
    if (isSpeaking) {
        window.speechSynthesis.cancel();
        debugLog('â¹ï¸ åœæ­¢ä¹‹å‰çš„æ’­æ”¾');
        setTimeout(() => startSpeaking(text, lang), 100);
    } else {
        startSpeaking(text, lang);
    }
}

function startSpeaking(text, lang) {
    isSpeaking = true;
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = lang;
    utterance.rate = 0.85; 
    utterance.volume = 1.0;
    utterance.pitch = 1.0;

    const voices = window.speechSynthesis.getVoices();
    let selectedVoice = null;
    if (lang.toLowerCase().startsWith('fi')) {
        selectedVoice = voices.find(voice => voice.lang.toLowerCase() === 'fi-fi') ||
                        voices.find(voice => voice.lang.toLowerCase().startsWith('fi')) ||
                        voices.find(voice => voice.name.toLowerCase().includes('finnish') || voice.name.toLowerCase().includes('suomi'));
    }
    
    if (selectedVoice) {
        utterance.voice = selectedVoice;
       // debugLog(`ä½¿ç”¨è¯­éŸ³: ${selectedVoice.name} (${selectedVoice.lang})`);
    } else {
        debugLog(`âš ï¸ æœªæ‰¾åˆ°è¯­è¨€ ${lang} çš„ç‰¹å®šè¯­éŸ³ï¼Œä½¿ç”¨ç³»ç»Ÿé»˜è®¤è¯­éŸ³`);
    }
    
    utterance.onstart = () => debugLog(`â–¶ï¸ å¼€å§‹æ’­æ”¾: "${text}"`);
    utterance.onend = () => {
        debugLog(`âœ… æ’­æ”¾å®Œæˆ: "${text}"`);
        isSpeaking = false;
    };
    utterance.onerror = (event) => {
        debugLog(`âŒ æ’­æ”¾é”™è¯¯: ${event.error} (æ–‡æœ¬: "${text}")`);
        isSpeaking = false;
        if (event.error !== 'interrupted' && event.error !== 'canceled') {
            alert('è¯­éŸ³æ’­æ”¾å‡ºé”™: ' + event.error + '. è¯·ç¡®ä¿æ‚¨çš„æµè§ˆå™¨æ”¯æŒå¹¶å·²å¯ç”¨èŠ¬å…°è¯­TTSã€‚');
        }
    };
    window.speechSynthesis.speak(utterance);
}

function addTTSButton(element, textToSpeak, lang) {
    const headers = ['åŠ¨è¯', 'åŠŸèƒ½', 'ç»“æ„ (æ ¼)', 'ç¤ºä¾‹', 'èŠ¬å…°è¯­', 'ä¸­æ–‡ç¿»è¯‘', 'æ¨¡å—äºŒè¯­å—', 'ä¸­æ–‡æ˜ å°„', 'è¡¨è¾¾', 'ä½¿ç”¨é¢‘ç‡'];
    let cleanedTextToSpeak = textToSpeak.split('(')[0].trim(); // Remove parenthetical notes for TTS

    if (!cleanedTextToSpeak || cleanedTextToSpeak === '' || headers.includes(cleanedTextToSpeak) ) {
        return; 
    }
    if (element.querySelector('.tts-button')) return; // Avoid double-adding if already handled by speakable-finnish
    
    const button = document.createElement('button');
    button.className = 'tts-button';
    button.innerHTML = 'ğŸ”Š'; 
    button.title = 'æ’­æ”¾: ' + cleanedTextToSpeak;
    button.setAttribute('aria-label', 'æ’­æ”¾éŸ³é¢‘: ' + cleanedTextToSpeak);
    
    button.onclick = function(event) {
        event.preventDefault(); 
        event.stopPropagation(); 
        // debugLog(`ğŸ”Š æŒ‰é’®è¢«ç‚¹å‡»: "${cleanedTextToSpeak}" (è¯­è¨€: ${lang})`);
        speakText(cleanedTextToSpeak, lang);
        return false; 
    };
    
    // Append button carefully
    if (element.childNodes.length > 0 && (element.childNodes[0].nodeType === Node.TEXT_NODE || element.querySelector('.speakable-finnish'))) {
        let insertBeforeNode = null;
        for(let i=0; i < element.childNodes.length; i++) {
            if(element.childNodes[i].nodeType !== Node.TEXT_NODE && 
               element.childNodes[i].className !== 'note' && 
               element.childNodes[i].className !== 'tts-button' &&
               element.childNodes[i].className !== 'speakable-finnish') {
                insertBeforeNode = element.childNodes[i];
                break;
            }
        }
        if (insertBeforeNode) {
            element.insertBefore(button, insertBeforeNode);
        } else {
            const speakableSpan = element.querySelector('.speakable-finnish');
            if (speakableSpan && !speakableSpan.querySelector('.tts-button')) {
                 speakableSpan.appendChild(button);
            } else if (!speakableSpan) { // If no speakable span, append to the element itself
                 element.appendChild(button);
            }
        }
    } else {
        element.appendChild(button);
    }
}

function initializeTTSFunctionality() {
    debugLog('ğŸš€ å¼€å§‹åˆå§‹åŒ–TTSåŠŸèƒ½ (æ¨¡å—äºŒå¤ä¹ )...');
    const finnishLang = 'fi-FI';

    if (window.speechSynthesis.getVoices().length === 0) {
        window.speechSynthesis.onvoiceschanged = () => {
            debugLog("voices changed, now attaching buttons (æ¨¡å—äºŒå¤ä¹ )");
            attachAllTTSButtons(finnishLang);
        };
    } else {
        debugLog("voices already loaded, attaching buttons (æ¨¡å—äºŒå¤ä¹ )");
        attachAllTTSButtons(finnishLang);
    }
}

function attachAllTTSButtons(finnishLang) {
    debugLog('ğŸ“ å¼€å§‹æ·»åŠ TTSæŒ‰é’®åˆ°å„ä¸ªéƒ¨åˆ† (æ¨¡å—äºŒå¤ä¹ )...');

    // Priority 1: Elements with .speakable-finnish class
    document.querySelectorAll('.speakable-finnish').forEach(span => {
        if (!span.querySelector('.tts-button')) {
            addTTSButton(span, span.textContent, finnishLang);
        }
    });

    // Priority 2: Tables - First column of each row in specified tables
    const tableIdsForFirstColumnTTS = ['grammar-system-summary', 'scene-cafe', 'scene-restaurant', 'scene-post-office', 'language-transformer', 'survival-chunk-summary'];
    tableIdsForFirstColumnTTS.forEach(tableId => {
        const table = document.getElementById(tableId);
        if (table) {
            table.querySelectorAll('tbody tr').forEach(row => {
                const firstTd = row.cells[0];
                if (firstTd && !firstTd.querySelector('.speakable-finnish') && !firstTd.querySelector('.tts-button')) {
                    const text = firstTd.textContent.trim();
                     if (text.length > 1 && (text.match(/[Ã¤Ã¶Ã¥Ã„Ã–Ã…]/) || text.includes('.') || text.includes('!'))) { // Check for Finnish chars or sentence-like structure
                        addTTSButton(firstTd, text, finnishLang);
                    }
                }
            });
        }
    });
    
    // Priority 3: .speakable-block paragraphs and list items
     const speakableBlockSelectors = ['.speakable-block p', '.speakable-block li', '.final-summary ul li'];
     speakableBlockSelectors.forEach(selector => {
        document.querySelectorAll(selector).forEach(el => {
            if (!el.querySelector('.speakable-finnish') && !el.querySelector('.tts-button')) {
                let textContent = '';
                if (el.childNodes.length === 1 && el.childNodes[0].nodeType === Node.TEXT_NODE) {
                    textContent = el.childNodes[0].textContent.trim();
                } else {
                    let tempText = '';
                    el.childNodes.forEach(node => {
                        if (node.nodeType === Node.TEXT_NODE) {
                            tempText += node.textContent;
                        } else if (node.nodeType === Node.ELEMENT_NODE && !node.classList.contains('note') && !node.classList.contains('tts-button') && !node.classList.contains('speakable-finnish')) {
                            tempText += node.textContent;
                        }
                    });
                    textContent = tempText.trim();
                }
                // Remove Chinese parts like " â†’ è¯´ï¼š" or " â†’ å›åº”ï¼š" before sending to TTS
                textContent = textContent.split('â†’')[0].trim(); 
                textContent = textContent.replace(/^-\s*/, ''); // Remove leading "- " from list items
                
                if (textContent.length > 1 && (textContent.match(/[Ã¤Ã¶Ã¥Ã„Ã–Ã…]/) || textContent.includes('.') || textContent.includes('!'))) {
                     addTTSButton(el, textContent.split('(')[0].trim(), finnishLang);
                }
            }
        });
     });

    // Priority 4: Specific H3 titles within .scene-block (if any) or section H3s
    // This is more for completeness, as titles are usually not spoken, but if needed:
    document.querySelectorAll('h3').forEach(h3 => {
        // Check if it's a specific type of H3 you want to make speakable
        // For example, if they are within certain sections and contain Finnish
        const text = h3.textContent.trim();
        if (text.includes('ç¬¬') && text.includes('æ—¥') && (text.match(/[Ã¤Ã¶Ã¥Ã„Ã–Ã…]/) || text.split('ï¼š')[1]?.trim().length > 1) ) { // e.g., "ğŸ“† ç¬¬1æ—¥ï¼šå’–å•¡åº—æ¤å…¥å®éªŒ"
             const finnishPart = text.split('ï¼š')[1] ? text.split('ï¼š')[1].trim() : text; // Try to get text after "ï¼š"
             if (finnishPart.length > 1 && !h3.querySelector('.tts-button')){
                addTTSButton(h3, finnishPart, finnishLang);
             }
        } else if (h3.parentElement && h3.parentElement.classList.contains('final-summary') && !h3.querySelector('.tts-button')) {
             if (text.length > 1 && text.match(/[Ã¤Ã¶Ã¥Ã„Ã–Ã…]/)) {
                 addTTSButton(h3, text, finnishLang);
             }
        }
    });

    debugLog('âœ… TTSåŠŸèƒ½æŒ‰é’®æ·»åŠ å®Œæ¯• (æ¨¡å—äºŒå¤ä¹ )ï¼');
}

document.addEventListener('DOMContentLoaded', initializeTTSFunctionality);
</script>

</body>
</html>