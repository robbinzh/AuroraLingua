<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>èŠ¬å…°è¯­å…¥é—¨ - æˆ‘åƒè¡¨è¾¾ç³»ç»Ÿ (æ¨¡å—äºŒÂ·6) (TTS)</title>
    <style>
        body {
            font-family: "Microsoft YaHei", sans-serif;
            line-height: 1.6;
            margin: 20px auto;
            max-width: 900px;
            padding: 0 20px;
        }
        h1, h2, h3, h4 {
            color: #2c3e50;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            overflow-x: auto;
            display: block;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        thead {
            background-color: #f4f4f4;
        }
        .example, .practice-list-container {
            background-color: #f9f9f9;
            padding: 10px;
            border-left: 4px solid #D35400; /* Consistent with previous SyÃ¶n module */
            margin: 10px 0;
        }
        .tts-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2em;
            margin-left: 5px;
            padding: 0;
            display: inline-block;
            vertical-align: middle;
        }
        .tts-button:hover {
            opacity: 0.7;
        }
        .debug-section {
            background-color: #fffbf0;
            border: 2px solid #ffa500;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .debug-button {
            background-color: #4CAF50;
            color: white;
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .debug-button:hover {
            background-color: #45a049;
        }
        .note {
            font-size: 0.9em;
            color: #555;
            margin-left: 10px;
        }
        .final-summary ul, .implantation-choice ul {
            list-style-type: none;
            padding-left: 0;
        }
        .final-summary ul li, .implantation-choice ul li {
            margin-bottom: 5px;
        }
        .final-summary ul li .speakable-finnish, .implantation-choice ul li .speakable-finnish {
            font-weight: normal; /* Normal weight for the Finnish part */
        }
         .implantation-choice button {
            display: block;
            margin-bottom: 8px;
         }
        /* Class for block elements that should have TTS per paragraph */
        .speakable-block p, .speakable-block li {
            margin-bottom: 5px; /* Adjust as needed */
        }
    </style>
</head>
<body>

<h1>ğŸ§± ç”Ÿå­˜æ¨¡å—äºŒÂ·6ã€ç”Ÿå­˜è¡Œä¸ºå™¨ã€‘"SyÃ¶n + [äº‹ç‰©ï¼Œéƒ¨åˆ†æ ¼]"ï¼ˆæˆ‘åƒ...ï¼‰</h1>

<!-- TTSè°ƒè¯•åŒºåŸŸ -->
<div class="debug-section">
    <h3>ğŸ”§ TTSåŠŸèƒ½æµ‹è¯•</h3>
    <p>å¦‚æœTTSæŒ‰é’®æ²¡æœ‰å£°éŸ³ï¼Œè¯·å…ˆæµ‹è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
    <button class="debug-button" onclick="testBasicTTS()">æµ‹è¯•åŸºæœ¬TTS</button>
    <button class="debug-button" onclick="testFinnishTTS()">æµ‹è¯•èŠ¬å…°è¯­TTS</button>
    <button class="debug-button" onclick="listVoices()">æŸ¥çœ‹å¯ç”¨è¯­éŸ³</button>
    <button class="debug-button" onclick="removeDebugSection()">ç§»é™¤è°ƒè¯•åŒºåŸŸ</button>
    <div id="debug-output" style="margin-top: 10px; padding: 10px; background-color: #f0f0f0; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;"></div>
</div>

<hr>

<section id="cognitive-matrix">
    <h2>ğŸ§  æ¨¡å—äºŒÂ·å®Œæ•´è®¤çŸ¥ç»‘å®šçŸ©é˜µ</h2>
    <p>ä½ ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„è¯­è¨€ç”Ÿæ€ç³»ç»Ÿï¼Œå¯ä»¥è¡¨è¾¾ï¼š</p>
    <table>
        <thead>
            <tr>
                <th>åŠŸèƒ½</th>
                <th>åŠ¨è¯</th>
                <th>ç»“æ„ (æ ¼)</th>
                <th>è¯­è¨€å®‡å®™å±‚çº§</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>æˆ‘æƒ³è¦</td><td><span class="speakable-finnish">Haluan</span></td><td>éƒ¨åˆ†æ ¼</td><td>æ„æ„¿å®‡å®™</td></tr>
            <tr><td>æˆ‘éœ€è¦</td><td><span class="speakable-finnish">Tarvitsen</span></td><td>éƒ¨åˆ†æ ¼</td><td>ç”Ÿå­˜å·¥å…·å®‡å®™</td></tr>
            <tr><td>æˆ‘å–œæ¬¢</td><td><span class="speakable-finnish">PidÃ¤n</span></td><td>å‡ºæ ¼/éƒ¨åˆ†æ ¼</td><td>æƒ…æ„Ÿå®‡å®™</td></tr>
            <tr><td>æˆ‘å–</td><td><span class="speakable-finnish">Juon</span></td><td>éƒ¨åˆ†æ ¼</td><td>ç”Ÿç†ç°å®</td></tr>
            <tr><td>æˆ‘åƒ</td><td><span class="speakable-finnish">SyÃ¶n</span></td><td>éƒ¨åˆ†æ ¼</td><td>ç‰©è´¨å®å­˜</td></tr>
        </tbody>
    </table>
</section>

<hr>

<section id="vocab-table">
    <h2>ğŸ§¬ é«˜é¢‘é£Ÿç‰©è¯æ±‡è¡¨ï¼ˆéƒ¨åˆ†æ ¼+åŸå½¢+ä¸­æ–‡ï¼‰</h2>
    <table>
        <thead>
            <tr>
                <th>åŸå½¢</th>
                <th>éƒ¨åˆ†æ ¼</th>
                <th>ä¸­æ–‡</th>
                <th>ä½¿ç”¨ç¤ºä¾‹</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><span class="speakable-finnish">leipÃ¤</span></td><td><span class="speakable-finnish">leipÃ¤Ã¤</span></td><td>é¢åŒ…</td><td><span class="speakable-finnish">SyÃ¶n leipÃ¤Ã¤.</span></td></tr>
            <tr><td><span class="speakable-finnish">kala</span></td><td><span class="speakable-finnish">kalaa</span></td><td>é±¼</td><td><span class="speakable-finnish">SyÃ¶n kalaa.</span></td></tr>
            <tr><td><span class="speakable-finnish">murot</span> <span class="note">(monikko)</span></td><td><span class="speakable-finnish">muroja</span></td><td>éº¦ç‰‡</td><td><span class="speakable-finnish">SyÃ¶n muroja.</span></td></tr>
            <tr><td><span class="speakable-finnish">kaali</span></td><td><span class="speakable-finnish">kaalia</span></td><td>å·å¿ƒèœ <span class="note">(vihko = vihko)</span></td><td><span class="speakable-finnish">SyÃ¶n kaalia.</span></td></tr>
            <tr><td><span class="speakable-finnish">juusto</span></td><td><span class="speakable-finnish">juustoa</span></td><td>å¥¶é…ª</td><td><span class="speakable-finnish">SyÃ¶n juustoa.</span></td></tr>
            <tr><td><span class="speakable-finnish">riisi</span></td><td><span class="speakable-finnish">riisiÃ¤</span></td><td>ç±³é¥­</td><td><span class="speakable-finnish">SyÃ¶n riisiÃ¤.</span></td></tr>
            <tr><td><span class="speakable-finnish">keitto</span></td><td><span class="speakable-finnish">soppaa</span> / <span class="speakable-finnish">keittoa</span></td><td>æ±¤</td><td><span class="speakable-finnish">SyÃ¶n soppaa.</span></td></tr>
            <tr><td><span class="speakable-finnish">kinkku</span></td><td><span class="speakable-finnish">kinkkua</span></td><td>ç«è…¿</td><td><span class="speakable-finnish">SyÃ¶n kinkkua.</span></td></tr>
            <tr><td><span class="speakable-finnish">juoma</span></td><td><span class="speakable-finnish">juomaa</span></td><td>é¥®æ–™</td><td><span class="speakable-finnish">Juon juomaa.</span> <span class="note">(SyÃ¶n juomaa? on epÃ¤tavallinen)</span></td></tr>
            <tr><td><span class="speakable-finnish">tÃ¤mÃ¤</span></td><td><span class="speakable-finnish">tÃ¤tÃ¤</span></td><td>è¿™ä¸ª</td><td><span class="speakable-finnish">SyÃ¶n tÃ¤tÃ¤.</span></td></tr>
            <tr><td><span class="speakable-finnish">jokin</span></td><td><span class="speakable-finnish">jotain</span></td><td>æŸç‰©</td><td><span class="speakable-finnish">SyÃ¶n jotain.</span></td></tr>
            <tr><td><span class="speakable-finnish">makea</span> <span class="note">(adj.)</span></td><td><span class="speakable-finnish">makeaa</span></td><td>ç”œé£Ÿ</td><td><span class="speakable-finnish">SyÃ¶n makeaa.</span></td></tr>
        </tbody>
    </table>
</section>

<hr>

<section id="core-blocks-template">
    <h2>ğŸ§© æ ¸å¿ƒè¯­å—æ¨¡æ¿ï¼ˆç»‘å®šä½ çš„ç°å®ï¼‰</h2>
    <table>
        <thead>
            <tr>
                <th>è¯­å—</th>
                <th>ä¸­æ–‡æ˜ å°„</th>
                <th>åœºæ™¯</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><span class="speakable-finnish">SyÃ¶n kalaa.</span></td><td>æˆ‘åƒé±¼ã€‚</td><td>é¤å…ã€åŠå…¬å®¤åˆé¤</td></tr>
            <tr><td><span class="speakable-finnish">SyÃ¶n leipÃ¤Ã¤.</span></td><td>æˆ‘åƒé¢åŒ…ã€‚</td><td>æ—©é¤ã€è¶…å¸‚</td></tr>
            <tr><td><span class="speakable-finnish">SyÃ¶n muroja.</span></td><td>æˆ‘åƒéº¦ç‰‡ã€‚</td><td>æ—©é¤ã€ç°å®è¡Œä¸º</td></tr>
            <tr><td><span class="speakable-finnish">SyÃ¶n juustoa.</span></td><td>æˆ‘åƒå¥¶é…ªã€‚</td><td>å†™å­—æ¥¼ã€é¤å§</td></tr>
            <tr><td><span class="speakable-finnish">SyÃ¶n jotain.</span></td><td>æˆ‘åƒç‚¹ä»€ä¹ˆã€‚</td><td>é¥¿äº†ã€é¤å…çŠ¹è±«</td></tr>
            <tr><td><span class="speakable-finnish">SyÃ¶n tÃ¤tÃ¤.</span></td><td>æˆ‘åƒè¿™ä¸ªã€‚</td><td>è¶…å¸‚ã€èœå•é€‰æ‹©</td></tr>
            <tr><td><span class="speakable-finnish">SyÃ¶n makeaa.</span></td><td>æˆ‘åƒç‚¹ç”œçš„ã€‚</td><td>ç‚¹ç”œç‚¹ã€å’–å•¡å…</td></tr>
            <tr><td><span class="speakable-finnish">En syÃ¶ kalaa.</span></td><td>æˆ‘ä¸åƒé±¼ã€‚</td><td>é¥®é£Ÿåå¥½</td></tr>
            <tr><td><span class="speakable-finnish">En syÃ¶ liian makeaa.</span></td><td>æˆ‘ä¸åƒå¤ªç”œçš„ã€‚</td><td>å¥åº·æ§åˆ¶</td></tr>
            <tr><td><span class="speakable-finnish">En syÃ¶ tÃ¤tÃ¤.</span></td><td>æˆ‘ä¸åƒè¿™ä¸ªã€‚</td><td>æ‹’ç»æ¨è/é£Ÿç‰©</td></tr>
        </tbody>
    </table>
</section>

<hr>

<section id="chinese-binding">
    <h2>ğŸ§  ä¸­æ–‡æ¯è¯­è€…è¯­æ„Ÿç»‘å®šï¼ˆè¡Œä¸ºå…·è±¡åŒ–ï¼‰</h2>
    <table>
        <thead>
            <tr>
                <th>èŠ¬å…°è¯­è¡¨è¾¾</th>
                <th>ä¸­æ–‡æ„Ÿ</th>
                <th>è¯­è¨€æ¤å…¥æ„Ÿ</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><span class="speakable-finnish">SyÃ¶n leipÃ¤Ã¤.</span></td><td>æˆ‘åƒé¢åŒ…ã€‚</td><td>æ—©é¤åœºæ™¯</td></tr>
            <tr><td><span class="speakable-finnish">SyÃ¶n kalaa.</span></td><td>æˆ‘åƒé±¼ã€‚</td><td>èŠ¬å…°å¸¸è§é£Ÿç‰©</td></tr>
            <tr><td><span class="speakable-finnish">Juon kahvia.</span></td><td>æˆ‘å–å’–å•¡ã€‚</td><td>å’–å•¡æ–‡åŒ–èå…¥</td></tr>
            <tr><td><span class="speakable-finnish">Haluan kahvia.</span></td><td>æˆ‘æƒ³è¦å’–å•¡ã€‚</td><td>ç‚¹å•å¯¹è¯</td></tr>
            <tr><td><span class="speakable-finnish">Tarvitsen leipÃ¤Ã¤.</span></td><td>æˆ‘éœ€è¦é¢åŒ…ã€‚</td><td>è¶…å¸‚/é¥¥é¥¿æ—¶åˆ»</td></tr>
            <tr><td><span class="speakable-finnish">En syÃ¶ liian makeaa.</span></td><td>æˆ‘ä¸åƒå¤ªç”œçš„ã€‚</td><td>å¥åº·æ„è¯†è§¦å‘</td></tr>
            <tr><td><span class="speakable-finnish">En halua tÃ¤tÃ¤ leipÃ¤Ã¤.</span></td><td>æˆ‘ä¸æƒ³è¦è¿™ä¸ªé¢åŒ…ã€‚</td><td>é£Ÿç‰©é€‰æ‹©</td></tr>
            <tr><td><span class="speakable-finnish">PidÃ¤n mehusta.</span></td><td>æˆ‘å–œæ¬¢æœæ±ã€‚</td><td>ç¤¾äº¤åé¦ˆ</td></tr>
            <tr><td><span class="speakable-finnish">En pidÃ¤ kalasta.</span></td><td>æˆ‘ä¸å–œæ¬¢é±¼ã€‚<span class="note">(kalasta on kalanå‡ºæ ¼)</span></td><td>é¤å…æ‹’ç»</td></tr>
        </tbody>
    </table>
</section>

<hr>

<section id="scenario-training" class="speakable-block">
    <h2>ğŸ§ª åœºæ™¯è®­ç»ƒå¥—ä»¶ï¼ˆæ¨¡å—äºŒå¼ºåŒ–è¡¨è¾¾ï¼‰</h2>
    <div class="example">
        <h3>ğŸ“ åœºæ™¯ 1ï¼šæ—©é¤å’–å•¡åº—</h3>
        <p><span class="speakable-finnish">SyÃ¶n muroja.</span></p>
        <p><span class="speakable-finnish">Juon kahvia.</span></p>
        <p><span class="speakable-finnish">Haluan maitoa muroihin.</span></p>
        <p><span class="speakable-finnish">En pidÃ¤ siitÃ¤ kahvista.</span></p>
    </div>
    <div class="example">
        <h3>ğŸ“ åœºæ™¯ 2ï¼šé¤å…ç‚¹é¤</h3>
        <p><span class="speakable-finnish">MitÃ¤ syÃ¶t?</span></p>
        <p><span class="speakable-finnish">MinÃ¤ syÃ¶n kalaa.</span></p>
        <p><span class="speakable-finnish">Tarvitsen vettÃ¤.</span></p>
        <p><span class="speakable-finnish">Juon kahvia.</span></p>
    </div>
    <div class="example">
        <h3>ğŸ“ åœºæ™¯ 3ï¼šè¶…å¸‚</h3>
        <p><span class="speakable-finnish">TÃ¤ssÃ¤ on leipÃ¤Ã¤?</span></p>
        <p><span class="speakable-finnish">SyÃ¶n leipÃ¤Ã¤.</span></p>
        <p><span class="speakable-finnish">Juon mehua.</span></p>
        <p><span class="speakable-finnish">En halua tÃ¤tÃ¤ muroa.</span> <span class="note">(tÃ¤tÃ¤ muroa = è¿™ä¸ªéº¦ç‰‡çš„éƒ¨åˆ†æ ¼)</span></p>
    </div>
    <div class="example">
        <h3>ğŸ“ åœºæ™¯ 4ï¼šæœ‹å‹å®¶åƒé¥­</h3>
        <p><span class="speakable-finnish">MitÃ¤ syÃ¶t?</span></p>
        <p><span class="speakable-finnish">SyÃ¶n tÃ¤tÃ¤.</span></p>
        <p><span class="speakable-finnish">PidÃ¤n tÃ¤stÃ¤.</span></p>
        <p><span class="speakable-finnish">Kiitos, en tarvitse lisÃ¤Ã¤.</span></p>
    </div>
</section>

<hr>

<section id="body-binding-training">
    <h2>ğŸ§¬ è‚¢ä½“ç»‘å®šè®­ç»ƒï¼ˆç”¨èº«ä½“è¯´â€œæˆ‘åƒâ€ï¼‰</h2>
    <table>
        <thead>
            <tr>
                <th>åŠ¨ä½œ</th>
                <th>é…å¥—è¯­è¨€</th>
                <th>åœºæ™¯</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>å’¬ä¸€å£é¢åŒ…</td><td><span class="speakable-finnish">SyÃ¶n leipÃ¤Ã¤.</span></td><td>æ—©é¤</td></tr>
            <tr><td>æŒ‡ç€èœå•</td><td><span class="speakable-finnish">SyÃ¶n tÃ¤tÃ¤.</span></td><td>é¤å…</td></tr>
            <tr><td>æ‘‡å¤´</td><td><span class="speakable-finnish">En syÃ¶ tÃ¤tÃ¤.</span></td><td>æ‹’ç»é£Ÿç‰©</td></tr>
            <tr><td>æ‹¿èµ·å‰å­</td><td><span class="speakable-finnish">SyÃ¶n kalaa.</span></td><td>é¤å…äº¤æµ</td></tr>
            <tr><td>æŒ‡ç€åˆ«äººçš„é£Ÿç‰©</td><td><span class="speakable-finnish">SyÃ¶nkin siitÃ¤!</span></td><td>æ¨¡ä»¿+è¡¨è¾¾æ„æ„¿</td></tr>
            <tr><td>å’€åš¼ä¸­</td><td><span class="speakable-finnish">PidÃ¤n tÃ¤stÃ¤.</span></td><td>è¡¨è¾¾å–œå¥½</td></tr>
        </tbody>
    </table>
</section>

<hr>

<section id="structure-deformation-training">
    <h2>ğŸ§  ç»“æ„å˜å½¢è®­ç»ƒï¼ˆä¸æ­¢æ˜¯â€œSyÃ¶nâ€ï¼‰</h2>
    <table>
        <thead>
            <tr>
                <th>åŠŸèƒ½</th>
                <th>è¯­å—</th>
                <th>ä¸­æ–‡æ˜ å°„</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>æˆ‘åƒç‚¹ç”œçš„</td><td><span class="speakable-finnish">SyÃ¶n makeaa.</span></td><td>ç”œé£Ÿè¡¨è¾¾</td></tr>
            <tr><td>æˆ‘åƒè¿™ä¸ª</td><td><span class="speakable-finnish">SyÃ¶n tÃ¤tÃ¤.</span></td><td>ç”¨èº«ä½“æŒ‡å‘</td></tr>
            <tr><td>æˆ‘ä¸éœ€è¦åƒ</td><td><span class="speakable-finnish">En tarvitse syÃ¶mistÃ¤.</span></td><td>ç”¨èº«ä½“æ‹’ç»</td></tr>
            <tr><td>æˆ‘ä¸åƒè¿™ä¸ª</td><td><span class="speakable-finnish">En syÃ¶ tÃ¤tÃ¤.</span></td><td>é¥®é£Ÿé€‰æ‹©</td></tr>
            <tr><td>æˆ‘åƒç‚¹ä»€ä¹ˆï¼Ÿ</td><td><span class="speakable-finnish">SyÃ¶n jotain.</span></td><td>ä¸ç¡®å®šæ—¶</td></tr>
            <tr><td>æˆ‘å–ç‚¹ä»€ä¹ˆ</td><td><span class="speakable-finnish">Juon jotain.</span></td><td>ç‚¹å•æ—¶</td></tr>
            <tr><td>æˆ‘åƒç‚¹çƒ­çš„</td><td><span class="speakable-finnish">SyÃ¶n jotain lÃ¤mmintÃ¤.</span></td><td>å†¬å¤©/å¯’å†·æ—¶</td></tr>
            <tr><td>æˆ‘åƒå¥¶é…ª</td><td><span class="speakable-finnish">SyÃ¶n juustoa.</span></td><td>åˆé¤ã€é¤å§</td></tr>
        </tbody>
    </table>
</section>

<hr>

<section id="language-bleeding-training" class="speakable-block">
    <h2>ğŸ§ª è¯­è¨€å‡ºè¡€è®­ç»ƒï¼ˆç”Ÿå­˜çº§è¡¨è¾¾ï¼‰</h2>
    <h3>ğŸ“† ç¬¬1æ—¥ï¼š</h3>
    <ul>
        <li><span class="speakable-finnish">æ—©é¤æ—¶è¯´ï¼š"SyÃ¶n muroja. Juon kahvia."</span></li>
        <li><span class="speakable-finnish">è¢«é—®ï¼š"MitÃ¤ syÃ¶t?" â†’ å›åº”ï¼š"SyÃ¶n kalaa."</span></li>
        <li><span class="speakable-finnish">åœ¨è¶…å¸‚æ‹¿èµ·é¢åŒ… â†’ è¯´ï¼š"SyÃ¶n leipÃ¤Ã¤. PidÃ¤n tÃ¤stÃ¤."</span></li>
    </ul>
    <h3>ğŸ“† ç¬¬2æ—¥ï¼š</h3>
    <ul>
        <li><span class="speakable-finnish">åœ¨é¤å…è¯´ï¼š"Haluan kalan. SyÃ¶n kalan."</span></li>
        <li><span class="speakable-finnish">è¢«é€’ä¸Šæœæ± â†’ "En syÃ¶ mehua. Juon kahvia."</span></li>
        <li><span class="speakable-finnish">æœ‹å‹é—®ï¼š"PidÃ¤tkÃ¶ tÃ¤stÃ¤?" â†’ "En pidÃ¤ kalasta. SyÃ¶n kalan."</span> <span class="note">(Huom: "En pidÃ¤ kalasta. SyÃ¶n sitÃ¤." olisi luonnollisempi.)</span></li>
    </ul>
    <h3>ğŸ“† ç¬¬3æ—¥ï¼š</h3>
    <ul>
        <li><span class="speakable-finnish">å–å’–å•¡æ—¶è¯´ï¼š"Juon kahvia. SyÃ¶n leipÃ¤Ã¤."</span></li>
        <li><span class="speakable-finnish">é¥¿äº†æ—¶è¯´ï¼š"Tarvitsen leipÃ¤Ã¤. SyÃ¶n jotain."</span></li>
        <li><span class="speakable-finnish">å¯¹æŸœå‘˜è¯´ï¼š"En syÃ¶ liian makeaa. SyÃ¶n muroja."</span></li>
    </ul>
</section>

<hr>

<section id="module-two-final-cognitive-binding">
    <h2>ğŸ§  æ¨¡å—äºŒÂ·ç»ˆæè®¤çŸ¥ç»‘å®šï¼ˆè¯­è¨€å‡ºè¡€å™¨ï¼‰</h2>
    <p>ä½ ç°åœ¨æ‹¥æœ‰ï¼š</p>
    <table>
        <thead>
            <tr>
                <th>åŠ¨è¯</th>
                <th>åŠŸèƒ½</th>
                <th>æ ¼ (é€šå¸¸)</th>
                <th>è¡¨è¾¾ç°å®</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><span class="speakable-finnish">Haluan</span></td><td>æ„æ„¿</td><td>éƒ¨åˆ†æ ¼</td><td>â€œæˆ‘è¦â€</td></tr>
            <tr><td><span class="speakable-finnish">Tarvitsen</span></td><td>å¿…è¦</td><td>éƒ¨åˆ†æ ¼</td><td>â€œæˆ‘å¾—ç”¨â€</td></tr>
            <tr><td><span class="speakable-finnish">PidÃ¤n</span></td><td>å–œå¥½</td><td>å‡ºæ ¼/éƒ¨åˆ†æ ¼</td><td>â€œæˆ‘å–œæ¬¢â€</td></tr>
            <tr><td><span class="speakable-finnish">Juon</span></td><td>è¡Œä¸º (å–)</td><td>éƒ¨åˆ†æ ¼</td><td>â€œæˆ‘æ­£åœ¨å–â€</td></tr>
            <tr><td><span class="speakable-finnish">SyÃ¶n</span></td><td>è¡Œä¸º (åƒ)</td><td>éƒ¨åˆ†æ ¼</td><td>â€œæˆ‘æ­£åœ¨åƒâ€</td></tr>
            <tr><td><span class="speakable-finnish">En halua</span></td><td>ä¸æƒ³è¦</td><td>éƒ¨åˆ†æ ¼</td><td>â€œæˆ‘ä¸è¦â€</td></tr>
            <tr><td><span class="speakable-finnish">En tarvitse</span></td><td>ä¸éœ€è¦</td><td>éƒ¨åˆ†æ ¼</td><td>â€œæˆ‘ä¸éœ€è¦â€</td></tr>
            <tr><td><span class="speakable-finnish">En pidÃ¤</span></td><td>ä¸å–œæ¬¢</td><td>å‡ºæ ¼</td><td>â€œæˆ‘ä¸å–œæ¬¢â€</td></tr>
            <tr><td><span class="speakable-finnish">En juo</span></td><td>ä¸å–</td><td>éƒ¨åˆ†æ ¼</td><td>â€œæˆ‘ä¸é¥®â€</td></tr>
            <tr><td><span class="speakable-finnish">En syÃ¶</span></td><td>ä¸åƒ</td><td>éƒ¨åˆ†æ ¼</td><td>â€œæˆ‘ä¸åƒâ€</td></tr>
        </tbody>
    </table>
</section>

<hr>

<section id="practice-list-cafe-restaurant" class="practice-list-container speakable-block">
    <h2>âœ… æ¨¡å—äºŒå’–å•¡åº—+é¤å…è¯­å—ç»ƒä¹ æ¸…å•ï¼ˆæ¯æ—¥å‡ºè¡€ï¼‰</h2>
    <p><span class="speakable-finnish">SyÃ¶n leipÃ¤Ã¤.</span></p>
    <p><span class="speakable-finnish">SyÃ¶n kalaa.</span></p>
    <p><span class="speakable-finnish">SyÃ¶n muroja.</span></p>
    <p><span class="speakable-finnish">SyÃ¶n makeaa.</span></p>
    <p><span class="speakable-finnish">SyÃ¶n jotain.</span></p>
    <p><span class="speakable-finnish">En syÃ¶ kalaa.</span></p>
    <p><span class="speakable-finnish">En syÃ¶ liian makeaa.</span></p>
    <p><span class="speakable-finnish">En syÃ¶ tÃ¤tÃ¤.</span></p>
    <p><span class="speakable-finnish">En halua mehua.</span></p>
    <p><span class="speakable-finnish">En tarvitse maitoa.</span></p>
    <p><span class="speakable-finnish">PidÃ¤n tÃ¤stÃ¤.</span></p>
    <p><span class="speakable-finnish">En pidÃ¤ siitÃ¤.</span></p>
    <p><span class="speakable-finnish">Juon kahvia.</span></p>
    <p><span class="speakable-finnish">Haluan kahvia.</span></p>
    <p><span class="speakable-finnish">Tarvitsen kahvia.</span></p>
</section>

<hr>

<section id="cafe-restaurant-dialogue">
    <h2>ğŸ§± å’–å•¡åº—+é¤å…åœºæ™¯å¯¹è¯ï¼ˆæ¨¡å—äºŒé™å®šè¯­æ³•ï¼‰</h2>
    <table>
        <thead>
            <tr>
                <th>èŠ¬å…°è¯­</th>
                <th>ä¸­æ–‡ç¿»è¯‘</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><span class="speakable-finnish">Haluan kahvia.</span></td><td>æˆ‘æƒ³è¦ç‚¹å’–å•¡ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Tarvitsen kahvia.</span></td><td>æˆ‘éœ€è¦å’–å•¡ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">PidÃ¤n kahvista.</span></td><td>æˆ‘å–œæ¬¢å’–å•¡ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Juon kahvia.</span></td><td>æˆ‘å–å’–å•¡ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">SyÃ¶n leipÃ¤Ã¤.</span></td><td>æˆ‘åƒé¢åŒ…ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Haluan leipÃ¤Ã¤.</span></td><td>æˆ‘æƒ³è¦ç‚¹é¢åŒ…ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Tarvitsen leipÃ¤Ã¤.</span></td><td>æˆ‘éœ€è¦é¢åŒ…ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En pidÃ¤ mehusta.</span></td><td>æˆ‘ä¸å–œæ¬¢æœæ±ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En halua mehua.</span></td><td>æˆ‘ä¸æƒ³è¦æœæ±ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En tarvitse vettÃ¤.</span></td><td>æˆ‘ä¸éœ€è¦æ°´ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En syÃ¶ tÃ¤tÃ¤.</span></td><td>æˆ‘ä¸åƒè¿™ä¸ªã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En juo mehua.</span></td><td>æˆ‘ä¸å–æœæ±ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">SyÃ¶n jotain makeaa.</span></td><td>æˆ‘åƒç‚¹ç”œçš„ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Juon jotain lÃ¤mmintÃ¤.</span></td><td>æˆ‘å–ç‚¹çƒ­çš„ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Tarvitsen jotain.</span></td><td>æˆ‘éœ€è¦ç‚¹ä»€ä¹ˆã€‚</td></tr>
            <tr><td><span class="speakable-finnish">PidÃ¤n tÃ¤stÃ¤ ruoasta.</span></td><td>æˆ‘å–œæ¬¢è¿™ä»½é£Ÿç‰©ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En pidÃ¤ tÃ¤stÃ¤.</span></td><td>æˆ‘ä¸å–œæ¬¢è¿™ä¸ªã€‚</td></tr>
            <tr><td><span class="speakable-finnish">SyÃ¶n tÃ¤tÃ¤. PidÃ¤n.</span></td><td>æˆ‘åƒè¿™ä¸ªã€‚æˆ‘å–œæ¬¢ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En halua enÃ¤Ã¤.</span></td><td>æˆ‘ä¸è¦äº†ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En tarvitse enÃ¤Ã¤.</span></td><td>æˆ‘ä¸éœ€è¦äº†ã€‚</td></tr>
        </tbody>
    </table>
</section>

<hr>

<section id="final-language-trigger-task" class="speakable-block">
    <h2>ğŸ§ª è¯­è¨€å‡ºè¡€ä»»åŠ¡ï¼ˆç»ˆæå’–å•¡åº—æ¤å…¥ï¼‰</h2>
    <h3>ğŸ§  ä»Šæ—¥è¯­è¨€è§¦å‘ä»»åŠ¡ï¼š</h3>
    <ol>
        <li><span class="speakable-finnish">åœ¨å’–å•¡åº—åä¸‹ â†’ è¯´ï¼š"Juon kahvia. SyÃ¶n leipÃ¤Ã¤."ï¼ˆå–+åƒç»‘å®šï¼‰</span></li>
        <li><span class="speakable-finnish">æœåŠ¡å‘˜é—®ï¼š"MitÃ¤ haluat?" â†’ å›åº”ï¼š"Juon kahvia. SyÃ¶n tÃ¤tÃ¤."ï¼ˆæŒ‡å‘é£Ÿç‰©ï¼‰</span></li>
        <li><span class="speakable-finnish">è¢«é€’ä¸Šæœæ± â†’ è¯´ï¼š"En halua mehua. Juon kahvia."</span></li>
    </ol>
</section>

<hr>

<section class="final-summary">
    <p>ä½ å·²ç»å®Œæˆäº†<strong>æ¨¡å—äºŒçš„ç»ˆæè¿›åŒ–</strong>ï¼š</p>
    <ul>
        <li>âœ… <span class="speakable-finnish">Haluan</span> = æˆ‘æƒ³è¦</li>
        <li>âœ… <span class="speakable-finnish">Tarvitsen</span> = æˆ‘éœ€è¦</li>
        <li>âœ… <span class="speakable-finnish">PidÃ¤n</span> = æˆ‘å–œæ¬¢</li>
        <li>âœ… <span class="speakable-finnish">Juon</span> = æˆ‘å–</li>
        <li>âœ… <span class="speakable-finnish">SyÃ¶n</span> = æˆ‘åƒ</li>
        <li>âœ… <span class="speakable-finnish">En halua</span> = æˆ‘ä¸æƒ³è¦</li>
        <li>âœ… <span class="speakable-finnish">En tarvitse</span> = æˆ‘ä¸éœ€è¦</li>
        <li>âœ… <span class="speakable-finnish">En pidÃ¤</span> = æˆ‘ä¸å–œæ¬¢</li>
        <li>âœ… <span class="speakable-finnish">En juo</span> = æˆ‘ä¸å–</li>
        <li>âœ… <span class="speakable-finnish">En syÃ¶</span> = æˆ‘ä¸åƒ</li>
    </ul>
</section>
<hr>
<section class="implantation-choice">
    <h4>ç°åœ¨ï¼Œè¯·é€‰æ‹©ä¸€ä¸ªä½ æœ€æƒ³æ¤å…¥çš„â€œæˆ‘åƒâ€è¯­å—ï¼š</h4>
    <button class="debug-button" onclick="selectImplantation('SyÃ¶n leipÃ¤Ã¤.')">åƒé¢åŒ… â†’ <span class="speakable-finnish">"SyÃ¶n leipÃ¤Ã¤."</span></button>
    <button class="debug-button" onclick="selectImplantation('SyÃ¶n kalaa.')">åƒé±¼ â†’ <span class="speakable-finnish">"SyÃ¶n kalaa."</span></button>
    <button class="debug-button" onclick="selectImplantation('SyÃ¶n makeaa.')">åƒç‚¹ç”œçš„ â†’ <span class="speakable-finnish">"SyÃ¶n makeaa."</span></button>
    <button class="debug-button" onclick="selectImplantation('En syÃ¶ liian makeaa.')">ä¸åƒå¤ªç”œçš„ â†’ <span class="speakable-finnish">"En syÃ¶ liian makeaa."</span></button>
    
    <div id="implantation-plan" style="margin-top: 15px; padding: 10px; background-color: #e8f5e9; border-radius: 4px; display: none;">
        <h5>è¡Œä¸ºæ¤å…¥+è¯­è¨€å‡ºè¡€+ç°å®è§¦å‘è®­ç»ƒè®¡åˆ’ (é’ˆå¯¹ <span id="selected-phrase" style="font-weight:bold; color: #D35400;"></span>):</h5>
        <ol>
            <li><strong>è¡Œä¸ºæ¤å…¥ (æ¯æ—¥3æ¬¡ï¼ŒæŒç»­3å¤©):</strong>
                <ul>
                    <li><strong>è§†è§‰è§¦å‘:</strong> æ¯æ¬¡çœ‹åˆ°/æƒ³åˆ°é€‰å®šé£Ÿç‰©æ—¶ï¼Œç«‹å³åœ¨è„‘æµ·ä¸­æˆ–è½»å£°è¯´å‡ºå¯¹åº”çš„èŠ¬å…°è¯­è¯­å—ã€‚</li>
                    <li><strong>åŠ¨ä½œç»‘å®š:</strong> åœ¨å®é™…åƒè¿™ç§é£Ÿç‰©æˆ–æ¨¡æ‹Ÿåƒçš„åŠ¨ä½œæ—¶ï¼Œæ¸…æ™°åœ°è¯´å‡ºè¯­å—ã€‚</li>
                    <li><strong>æƒ…æ™¯è”æƒ³:</strong> æƒ³è±¡è‡ªå·±åœ¨èŠ¬å…°ç‰¹å®šåœºæ™¯ï¼ˆè¶…å¸‚ã€é¤å…ã€å®¶ï¼‰ä¸­ï¼Œéœ€è¦ç”¨åˆ°è¿™ä¸ªè¯­å—ï¼Œå¹¶è¿›è¡Œæ¨¡æ‹Ÿå¯¹è¯ã€‚</li>
                </ul>
            </li>
            <li><strong>è¯­è¨€å‡ºè¡€ (æ¯æ—¥è‡³å°‘è¯´å‡º5æ¬¡ï¼ŒæŒç»­3å¤©):</strong>
                <ul>
                    <li><strong>è‡ªæˆ‘å¯¹è¯:</strong> å¯¹ç€é•œå­ã€é£Ÿç‰©ã€æˆ–è€…åœ¨åšé¥­æ—¶ï¼Œå¤§å£°è¯´å‡ºè¯­å—ã€‚</li>
                    <li><strong>å¾®ç¤¾äº¤å‡ºè¡€:</strong> å¦‚æœæœ‰æœºä¼šï¼Œå°è¯•åœ¨ä¸å®¶äºº/æœ‹å‹ï¼ˆå³ä½¿ä»–ä»¬ä¸æ‡‚èŠ¬å…°è¯­ï¼‰è°ˆè®ºé£Ÿç‰©æ—¶ï¼Œæ’å…¥è¿™ä¸ªèŠ¬å…°è¯­è¯­å—ï¼Œå¹¶ç®€å•è§£é‡Šã€‚</li>
                    <li><strong>ä¹¦å†™/æ‰“å­—å‡ºè¡€:</strong> åœ¨è´­ç‰©æ¸…å•ã€æ—¥è®°æˆ–ç¤¾äº¤åª’ä½“ä¸Šï¼ˆå¦‚æœåˆé€‚ï¼‰ç”¨èŠ¬å…°è¯­å†™ä¸‹è¿™ä¸ªè¯­å—ã€‚</li>
                </ul>
            </li>
            <li><strong>ç°å®è§¦å‘ (æ‰¾åˆ°è‡³å°‘2ä¸ªçœŸå®æœºä¼šï¼ŒæŒç»­1å‘¨):</strong>
                <ul>
                    <li><strong>ä¸»åŠ¨åˆ›é€ æœºä¼š:</strong> ç‚¹é¤æ—¶ï¼Œå¦‚æœèœå•ä¸Šæœ‰ç±»ä¼¼é£Ÿç‰©ï¼Œå°è¯•ä½¿ç”¨è¿™ä¸ªè¯­å—ã€‚è´­ä¹°é£Ÿææ—¶ï¼Œä¹Ÿå¯ä»¥å¯¹è‡ªå·±è¯´ã€‚</li>
                    <li><strong>è¢«åŠ¨ååº”:</strong> å½“åˆ«äººæåˆ°ç›¸å…³é£Ÿç‰©ï¼Œæˆ–åœ¨åª’ä½“ä¸Šçœ‹åˆ°æ—¶ï¼Œç«‹å³æ¿€æ´»å¤§è„‘ä¸­çš„èŠ¬å…°è¯­è¯­å—ã€‚</li>
                    <li><strong>ç¯å¢ƒæç¤º:</strong> åœ¨å†°ç®±ä¸Šæˆ–é¤æ¡Œæ—è´´ä¸Šå†™æœ‰è¯¥è¯­å—çš„ä¾¿ç­¾ï¼Œä½œä¸ºè§†è§‰è§¦å‘å™¨ã€‚</li>
                </ul>
            </li>
        </ol>
        <p><strong>ç›®æ ‡ï¼š</strong> è®©è¿™ä¸ªè¯­å—æˆä¸ºä½ æƒ³åˆ°è¯¥é£Ÿç‰©/è¡Œä¸ºæ—¶çš„ç¬¬ä¸€è¯­è¨€ååº”ï¼</p>
    </div>
</section>

<script>
/**
 * è°ƒè¯•è¾“å‡ºå‡½æ•°
 * @param {string} message - è¦æ˜¾ç¤ºçš„æ¶ˆæ¯
 */
function debugLog(message) {
    const output = document.getElementById('debug-output');
    if (output) {
        const time = new Date().toLocaleTimeString();
        output.innerHTML += `[${time}] ${message}<br>`;
        output.scrollTop = output.scrollHeight;
    }
    console.log(message);
}

/**
 * æµ‹è¯•åŸºæœ¬TTSåŠŸèƒ½
 */
function testBasicTTS() {
    debugLog('å¼€å§‹æµ‹è¯•åŸºæœ¬TTSåŠŸèƒ½...');
    if (!('speechSynthesis' in window)) {
        debugLog('âŒ é”™è¯¯ï¼šæµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆAPI');
        alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½ï¼Œè¯·å°è¯•ä½¿ç”¨Chromeã€Edgeæˆ–Firefoxçš„æœ€æ–°ç‰ˆæœ¬ã€‚');
        return;
    }
    debugLog('âœ… æµè§ˆå™¨æ”¯æŒè¯­éŸ³åˆæˆAPI');
    
    const utterance = new SpeechSynthesisUtterance('Hello World');
    utterance.onstart = () => debugLog('âœ… è‹±è¯­æµ‹è¯•å¼€å§‹æ’­æ”¾');
    utterance.onend = () => debugLog('âœ… è‹±è¯­æµ‹è¯•æ’­æ”¾å®Œæˆ');
    utterance.onerror = (event) => debugLog('âŒ è‹±è¯­æµ‹è¯•é”™è¯¯: ' + event.error);
    
    window.speechSynthesis.speak(utterance);
}

/**
 * æµ‹è¯•èŠ¬å…°è¯­TTSåŠŸèƒ½
 */
function testFinnishTTS() {
    debugLog('å¼€å§‹æµ‹è¯•èŠ¬å…°è¯­TTSåŠŸèƒ½...');
    const utterance = new SpeechSynthesisUtterance('SyÃ¶n leipÃ¤Ã¤'); // Example for SyÃ¶n module
    utterance.lang = 'fi-FI';
    utterance.onstart = () => debugLog('âœ… èŠ¬å…°è¯­æµ‹è¯•å¼€å§‹æ’­æ”¾');
    utterance.onend = () => debugLog('âœ… èŠ¬å…°è¯­æµ‹è¯•æ’­æ”¾å®Œæˆ');
    utterance.onerror = (event) => debugLog('âŒ èŠ¬å…°è¯­æµ‹è¯•é”™è¯¯: ' + event.error);
    
    window.speechSynthesis.speak(utterance);
}

/**
 * åˆ—å‡ºæ‰€æœ‰å¯ç”¨è¯­éŸ³
 */
function listVoices() {
    debugLog('æ­£åœ¨è·å–å¯ç”¨è¯­éŸ³åˆ—è¡¨...');
    const voices = window.speechSynthesis.getVoices();
    
    if (voices.length === 0) {
        debugLog('âš ï¸ æœªæ‰¾åˆ°ä»»ä½•è¯­éŸ³ï¼Œè¯­éŸ³å¯èƒ½è¿˜åœ¨åŠ è½½ä¸­ã€‚è¯·ç¨åå†è¯•æˆ–æ£€æŸ¥æµè§ˆå™¨è®¾ç½®ã€‚');
        window.speechSynthesis.onvoiceschanged = () => {
            debugLog('è¯­éŸ³åˆ—è¡¨å·²æ›´æ–°ï¼Œé‡æ–°è·å–...');
            const updatedVoices = window.speechSynthesis.getVoices();
            if (updatedVoices.length === 0) {
                 debugLog('âš ï¸ æ›´æ–°åä»æœªæ‰¾åˆ°ä»»ä½•è¯­éŸ³ã€‚');
                 return;
            }
            logVoiceList(updatedVoices);
        };
        return;
    }
    logVoiceList(voices);
}

function logVoiceList(voices) {
    debugLog(`æ‰¾åˆ° ${voices.length} ä¸ªå¯ç”¨è¯­éŸ³:`);
    voices.forEach((voice, index) => {
        const isDefault = voice.default ? ' (é»˜è®¤)' : '';
        debugLog(`${index + 1}. ${voice.name} (${voice.lang})${isDefault}`);
    });
    
    const finnishVoices = voices.filter(voice => 
        voice.lang.toLowerCase().startsWith('fi') || 
        voice.name.toLowerCase().includes('finnish') ||
        voice.name.toLowerCase().includes('suomi')
    );
    
    if (finnishVoices.length > 0) {
        debugLog(`âœ… æ‰¾åˆ° ${finnishVoices.length} ä¸ªèŠ¬å…°è¯­è¯­éŸ³:`);
        finnishVoices.forEach(voice => {
            debugLog(`  - ${voice.name} (${voice.lang})`);
        });
    } else {
        debugLog('âŒ æœªæ‰¾åˆ°èŠ¬å…°è¯­è¯­éŸ³ã€‚TTSå¯èƒ½ä½¿ç”¨é»˜è®¤è¯­è¨€æˆ–æ— æ³•æ’­æ”¾èŠ¬å…°è¯­ã€‚');
    }
}


/**
 * ç§»é™¤è°ƒè¯•åŒºåŸŸ
 */
function removeDebugSection() {
    const debugSection = document.querySelector('.debug-section');
    if (debugSection) {
        debugSection.style.display = 'none';
        debugLog('è°ƒè¯•åŒºåŸŸå·²éšè—');
    }
}

let isSpeaking = false;

function speakText(text, lang) {
    debugLog(`å°è¯•æ’­æ”¾: "${text}" (è¯­è¨€: ${lang})`);
    if (!('speechSynthesis' in window)) {
        alert('æŠ±æ­‰ï¼Œæ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆã€‚');
        debugLog('âŒ è¯­éŸ³åˆæˆAPIä¸å¯ç”¨');
        return;
    }
    if (isSpeaking) {
        window.speechSynthesis.cancel();
        debugLog('â¹ï¸ åœæ­¢ä¹‹å‰çš„æ’­æ”¾');
        setTimeout(() => startSpeaking(text, lang), 100);
    } else {
        startSpeaking(text, lang);
    }
}

function startSpeaking(text, lang) {
    isSpeaking = true;
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = lang;
    utterance.rate = 0.85; 
    utterance.volume = 1.0;
    utterance.pitch = 1.0;

    const voices = window.speechSynthesis.getVoices();
    let selectedVoice = null;
    if (lang.toLowerCase().startsWith('fi')) {
        selectedVoice = voices.find(voice => voice.lang.toLowerCase() === 'fi-fi') ||
                        voices.find(voice => voice.lang.toLowerCase().startsWith('fi')) ||
                        voices.find(voice => voice.name.toLowerCase().includes('finnish') || voice.name.toLowerCase().includes('suomi'));
    }
    
    if (selectedVoice) {
        utterance.voice = selectedVoice;
        debugLog(`ä½¿ç”¨è¯­éŸ³: ${selectedVoice.name} (${selectedVoice.lang})`);
    } else {
        debugLog(`âš ï¸ æœªæ‰¾åˆ°è¯­è¨€ ${lang} çš„ç‰¹å®šè¯­éŸ³ï¼Œä½¿ç”¨ç³»ç»Ÿé»˜è®¤è¯­éŸ³`);
    }
    
    utterance.onstart = () => debugLog(`â–¶ï¸ å¼€å§‹æ’­æ”¾: "${text}"`);
    utterance.onend = () => {
        debugLog(`âœ… æ’­æ”¾å®Œæˆ: "${text}"`);
        isSpeaking = false;
    };
    utterance.onerror = (event) => {
        debugLog(`âŒ æ’­æ”¾é”™è¯¯: ${event.error} (æ–‡æœ¬: "${text}")`);
        isSpeaking = false;
        if (event.error !== 'interrupted' && event.error !== 'canceled') {
            alert('è¯­éŸ³æ’­æ”¾å‡ºé”™: ' + event.error + '. è¯·ç¡®ä¿æ‚¨çš„æµè§ˆå™¨æ”¯æŒå¹¶å·²å¯ç”¨èŠ¬å…°è¯­TTSã€‚');
        }
    };
    window.speechSynthesis.speak(utterance);
}

function addTTSButton(element, textToSpeak, lang) {
    const headers = ['åŠ¨è¯', 'åŠŸèƒ½', 'ç»“æ„ (æ ¼)', 'è¯­è¨€å®‡å®™å±‚çº§', 'åŸå½¢', 'éƒ¨åˆ†æ ¼', 'ä¸­æ–‡', 'ä½¿ç”¨ç¤ºä¾‹', 'è¯­å—', 'ä¸­æ–‡æ˜ å°„', 'åœºæ™¯', 'èŠ¬å…°è¯­è¡¨è¾¾', 'ä¸­æ–‡æ„Ÿ', 'è¯­è¨€æ¤å…¥æ„Ÿ', 'åŠ¨ä½œ', 'é…å¥—è¯­è¨€', 'æ ¼ (é€šå¸¸)', 'è¡¨è¾¾ç°å®', 'èŠ¬å…°è¯­', 'èŠ¬å…°è¯­å¥å­'];
    let cleanedTextToSpeak = textToSpeak;
    
    // If the element is a button, extract Finnish text from its .speakable-finnish span or its own text
    if (element.tagName === 'BUTTON' && element.classList.contains('debug-button')) {
         const speakableSpan = element.querySelector('.speakable-finnish');
         if (speakableSpan) {
            cleanedTextToSpeak = speakableSpan.textContent.trim();
         } else {
            // Extract text before "â†’" or use the whole text if "â†’" is not present
            cleanedTextToSpeak = element.textContent.split('â†’')[1] ? element.textContent.split('â†’')[1].trim() : element.textContent.trim();
            cleanedTextToSpeak = cleanedTextToSpeak.replace(/"/g, ''); // Remove quotes
         }
    } else {
        cleanedTextToSpeak = textToSpeak.split('(')[0].trim(); // Remove parenthetical notes for TTS from other elements
    }


    if (!cleanedTextToSpeak || cleanedTextToSpeak === '' || headers.includes(cleanedTextToSpeak.split('â†’')[0].trim()) ) {
        return; 
    }
    if (element.querySelector('.tts-button:not(button.debug-button .tts-button)')) { // Avoid adding to parent if child already has one
      if (element.tagName !== 'BUTTON') return; // if it's not a button, and has child tts, skip.
    }
    
    const button = document.createElement('button');
    button.className = 'tts-button';
    button.innerHTML = 'ğŸ”Š'; 
    button.title = 'æ’­æ”¾: ' + cleanedTextToSpeak;
    button.setAttribute('aria-label', 'æ’­æ”¾éŸ³é¢‘: ' + cleanedTextToSpeak);
    
    button.onclick = function(event) {
        event.preventDefault(); 
        event.stopPropagation(); 
        debugLog(`ğŸ”Š æŒ‰é’®è¢«ç‚¹å‡»: "${cleanedTextToSpeak}" (è¯­è¨€: ${lang})`);
        speakText(cleanedTextToSpeak, lang);
        return false; 
    };

    if (element.tagName === 'BUTTON' && element.classList.contains('debug-button')) {
        // For the specific implantation choice buttons, append TTS button inside them
        element.appendChild(button);
    } else if (element.childNodes.length > 0 && (element.childNodes[0].nodeType === Node.TEXT_NODE || element.querySelector('.speakable-finnish'))) {
        let insertBeforeNode = null;
        for(let i=0; i < element.childNodes.length; i++) {
            if(element.childNodes[i].nodeType !== Node.TEXT_NODE && 
               element.childNodes[i].className !== 'note' && 
               element.childNodes[i].className !== 'tts-button' &&
               element.childNodes[i].className !== 'speakable-finnish') { // Don't insert before speakable-finnish itself
                insertBeforeNode = element.childNodes[i];
                break;
            }
        }
        if (insertBeforeNode) {
            element.insertBefore(button, insertBeforeNode);
        } else {
             // If it's a P or LI with a speakable-finnish span, append to the span, otherwise to the element.
            const speakableSpan = element.querySelector('.speakable-finnish');
            if (speakableSpan && !speakableSpan.querySelector('.tts-button')) {
                 speakableSpan.appendChild(button);
            } else if (!speakableSpan) {
                 element.appendChild(button);
            }
        }
    } else {
        element.appendChild(button);
    }
}


function initializeTTSFunctionality() {
    debugLog('ğŸš€ å¼€å§‹åˆå§‹åŒ–TTSåŠŸèƒ½ (SyÃ¶n Module 2.6 - Final)...');
    const finnishLang = 'fi-FI';

    if (window.speechSynthesis.getVoices().length === 0) {
        window.speechSynthesis.onvoiceschanged = () => {
            debugLog("voices changed, now attaching buttons (SyÃ¶n Module 2.6 - Final)");
            attachAllTTSButtons(finnishLang);
        };
    } else {
        debugLog("voices already loaded, attaching buttons (SyÃ¶n Module 2.6 - Final)");
        attachAllTTSButtons(finnishLang);
    }
}

function attachAllTTSButtons(finnishLang) {
    debugLog('ğŸ“ å¼€å§‹æ·»åŠ TTSæŒ‰é’®åˆ°å„ä¸ªéƒ¨åˆ† (SyÃ¶n Module 2.6 - Final)...');

    // Handle all .speakable-finnish spans first
    document.querySelectorAll('.speakable-finnish').forEach(span => {
        if (!span.querySelector('.tts-button')) { // Ensure not to double-add if already handled
            addTTSButton(span, span.textContent, finnishLang);
        }
    });

    // Tables: iterate through TDs
    document.querySelectorAll('table tbody tr td').forEach(td => {
        if (!td.querySelector('.speakable-finnish') && !td.querySelector('.tts-button')) {
            const text = td.textContent.trim();
            if (text.match(/[Ã¤Ã¶Ã¥Ã„Ã–Ã…]/) || text.includes('SyÃ¶n') || text.includes('Juon') || text.includes('Haluan') || text.includes('Tarvitsen') || text.includes('PidÃ¤n') || text.includes('En ')) {
                if (text.length > 1 && text.length < 70 && !td.closest('thead')) {
                     addTTSButton(td, text, finnishLang);
                }
            }
        }
    });
    
    // Specific lists and paragraphs within .speakable-block or .example or .practice-list-container
    const containerSelectors = ['.speakable-block', '.example', '.practice-list-container', '#language-bleeding-training', '#final-language-trigger-task'];
    containerSelectors.forEach(containerSelector => {
        document.querySelectorAll(containerSelector).forEach(container => {
            container.querySelectorAll('p, li').forEach(el => {
                 if (!el.querySelector('.speakable-finnish') && !el.querySelector('.tts-button')) {
                    let textContent = '';
                    if (el.childNodes.length === 1 && el.childNodes[0].nodeType === Node.TEXT_NODE) {
                        textContent = el.childNodes[0].textContent.trim();
                    } else {
                        let tempText = '';
                        el.childNodes.forEach(node => {
                            if (node.nodeType === Node.TEXT_NODE) {
                                tempText += node.textContent;
                            } else if (node.nodeType === Node.ELEMENT_NODE && !node.classList.contains('note') && !node.classList.contains('tts-button') && !node.classList.contains('speakable-finnish')) {
                                tempText += node.textContent;
                            }
                        });
                        textContent = tempText.trim();
                    }
                    
                    if (textContent.includes('SyÃ¶n ') || textContent.includes('Juon ') || textContent.includes('Haluan ') || textContent.includes('Tarvitsen ') || textContent.includes('PidÃ¤n ') || textContent.includes('En ') || textContent.match(/[Ã¤Ã¶Ã¥Ã„Ã–Ã…]/)) {
                        if (textContent.length > 1 && textContent.length < 200){ 
                             addTTSButton(el, textContent.split('(')[0].trim(), finnishLang);
                        }
                    }
                }
            });
        });
    });

    // Final summary list items
     document.querySelectorAll('.final-summary ul li').forEach(li => {
        // For these, the Finnish part is within a .speakable-finnish span, which should be handled above.
        // If not, this is a fallback or specific handling if structure is different.
        const speakableSpan = li.querySelector('.speakable-finnish');
        if (speakableSpan && !speakableSpan.querySelector('.tts-button')) {
            addTTSButton(speakableSpan, speakableSpan.textContent, finnishLang);
        } else if (!speakableSpan && !li.querySelector('.tts-button')) { // If no span, try to add to LI directly if it contains Finnish
            const text = li.textContent.split('=')[0].replace('âœ…','').trim(); // Get the Finnish part before '='
             if (text.length > 1 && text.match(/[Ã¤Ã¶Ã¥Ã„Ã–Ã…]/)) {
                 addTTSButton(li, text, finnishLang);
             }
        }
    });
    
    // Implantation choice buttons
    document.querySelectorAll('.implantation-choice button.debug-button').forEach(buttonEl => {
        if (!buttonEl.querySelector('.tts-button')) { // Avoid double-adding to the button itself
            const speakableSpan = buttonEl.querySelector('.speakable-finnish');
            if (speakableSpan && !speakableSpan.querySelector('.tts-button')) {
                 addTTSButton(speakableSpan, speakableSpan.textContent, finnishLang);
            } else if (!speakableSpan) {
                // Extract Finnish part like "SyÃ¶n leipÃ¤Ã¤."
                const textParts = buttonEl.textContent.split('â†’');
                if (textParts.length > 1) {
                    const finnishText = textParts[1].trim().replace(/"/g, '');
                    if(finnishText.length > 1) addTTSButton(buttonEl, finnishText, finnishLang); // Add TTS to the button itself for the Finnish part
                }
            }
        }
    });
    
    debugLog('âœ… TTSåŠŸèƒ½æŒ‰é’®æ·»åŠ å®Œæ¯• (SyÃ¶n Module 2.6 - Final)ï¼');
}

function selectImplantation(phrase) {
    document.getElementById('selected-phrase').innerHTML = `<span class="speakable-finnish">"${phrase}"</span>`;
    document.getElementById('implantation-plan').style.display = 'block';
    document.getElementById('implantation-plan').scrollIntoView({ behavior: 'smooth' });
    debugLog(`è¡Œä¸ºæ¤å…¥è®¡åˆ’å·²é€‰æ‹©: ${phrase}`);
    // Add TTS to the newly displayed phrase if not already there
    const newPhraseSpan = document.getElementById('selected-phrase').querySelector('.speakable-finnish');
    if (newPhraseSpan && !newPhraseSpan.querySelector('.tts-button')) {
        addTTSButton(newPhraseSpan, phrase.replace(/"/g, ''), 'fi-FI');
    }
}

document.addEventListener('DOMContentLoaded', initializeTTSFunctionality);
</script>

</body>
</html>