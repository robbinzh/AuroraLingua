<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>èŠ¬å…°è¯­æ¨¡å—ä¸‰Â·ç»´åº¦å››ï¼šæ„ŸçŸ¥â€œæ–¹å‘â€ç©ºé—´ (åœ°å›¾æœ€ç»ˆä¼˜åŒ–TTS)</title>
    <style>
        body { font-family: "Microsoft YaHei", sans-serif; line-height: 1.7; margin: 20px auto; max-width: 900px; padding: 0 20px; color: #333; background-color: #f9f9f9; }
        h1, h2, h3, h4 { color: #2c3e50; }
        h1 { text-align: center; margin-bottom: 35px; font-size: 2.2em; }
        h2 { border-bottom: 2px solid #9b59b6; padding-bottom: 12px; margin-top: 45px; font-size: 1.8em; color: #9b59b6; } /* Dimension 4 color */
        h3 { margin-top: 30px; font-size: 1.5em; color: #8e44ad; } 
        h4 { font-size: 1.3em; color: #c39bd3; margin-top:25px; margin-bottom:15px; }
        table.directions-table, table.vocab-list-table { width: 100%; border-collapse: collapse; margin-bottom: 25px; display: table; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .directions-table th, .directions-table td, .vocab-list-table th, .vocab-list-table td { border: 1px solid #ddd; padding: 10px; text-align: left; vertical-align: top;}
        .directions-table thead, .vocab-list-table thead { background-color: #e9ecef; }
        .directions-table td:first-child, .vocab-list-table td:first-child { font-weight: bold; width: 20%; }
        .directions-table td { font-size: 0.95em;}

        .task-card, .example, .summary-card, .new-vocab-section, .direction-card {
            background-color: #fff; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 30px; box-shadow: 0 4px 10px rgba(0,0,0,0.08);
        }
        .example { border-left: 6px solid #9b59b6 !important; }
        .direction-card h4 { color: #8e44ad; margin-top: 0; font-size: 1.3em; border-bottom: 1px dashed #c39bd3; padding-bottom: 8px; margin-bottom: 15px; }
        .direction-card-content p { margin: 5px 0; font-size: 1.1em; }
        .direction-card img { width: 100px; height: 100px; object-fit: contain; margin-right: 15px; border-radius: 4px; float: left; margin-bottom:10px;}

        .finnish-phrase { font-weight: bold; color: #8e44ad; font-size: 1.1em; }
        .example-sentence .finnish-phrase { font-size: 1.05em; }
        .chinese-sense, .note { font-size: 0.9em; color: #555; font-style: italic; }
        .tts-button { background: none; border: none; cursor: pointer; font-size: 1.2em; margin-left: 8px; padding: 0; display: inline-block; vertical-align: middle; color: #8e44ad; }
        .tts-button:hover { color: #7d3c98; opacity: 0.8; }
        .debug-section, .interactive-map-container { 
            background-color: #fdfefe; border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; margin: 20px 0;
        }
        .debug-button { background-color: #4CAF50; color: white; padding: 8px 16px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .debug-button:hover { background-color: #45a049; }
        .highlight { color: #c0392b; font-weight: bold; }
        hr { border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0,0,0,0), rgba(155,89,182,0.3), rgba(0,0,0,0)); margin: 40px 0; }
        
        .task-list { list-style-type: none; padding-left: 0; }
        .task-list > li { margin-bottom: 15px; }
        .task-list h5 { margin-top:0; color: #2c3e50; font-size: 1.15em; }
        .task-list ul { list-style-type: disc; padding-left: 25px; margin-top: 5px; }
        .task-list ul li { font-size: 1em; margin-bottom: 8px; }
        
        .final-summary-list { list-style-type: none; padding-left:0; }
        .final-summary-list li { margin-bottom: 10px; font-size: 1.1em;}
        .final-summary-list .finnish-phrase { font-weight: normal;}
        .action-button { background-color: #9b59b6; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; margin-top:10px; font-size: 1em; }
        .action-button:hover { background-color: #8e44ad; }

        .feedback-area { margin-top: 15px; padding: 12px; border-radius: 5px; text-align:center; font-size: 1.1em; min-height: 1.5em; }
        .correct { background-color: #e8f8f5; color: #27ae60; border: 1px solid #a3e4d7;}
        .incorrect { background-color: #fdedec; color: #c0392b; border: 1px solid #f5b7b1; }
        .concept-map { text-align: center; margin: 25px 0; padding: 15px; background-color: #f5eef8; border: 1px dashed #d7bde2; border-radius: 6px; }
        .concept-map p { margin: 8px 0; font-size: 1.15em; }
        .map-legend { margin-top: 10px; font-size: 0.9em; text-align: center;}
    </style>
</head>
<body>

    <h1>æ¨¡å—ä¸‰ï¼šã€ç©ºé—´å®šä½å™¨ã€‘ â€“ ç»´åº¦å››ï¼šæ„ŸçŸ¥â€œæ–¹å‘â€ç©ºé—´ (ä¸œå—è¥¿åŒ— - åœ°å›¾æœ€ç»ˆä¼˜åŒ–)</h1>

    <!-- TTSè°ƒè¯•åŒºåŸŸ -->
    <div class="debug-section">
        <h3>ğŸ”§ TTSåŠŸèƒ½æµ‹è¯• (æ¨¡å—ä¸‰Â·ç»´åº¦å›› æ–¹å‘ç©ºé—´ - åœ°å›¾æœ€ç»ˆä¼˜åŒ–)</h3>
        <p>å¦‚æœTTSæŒ‰é’®æ²¡æœ‰å£°éŸ³ï¼Œè¯·å…ˆæµ‹è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
        <button class="debug-button" onclick="testBasicTTS()">æµ‹è¯•åŸºæœ¬TTS</button>
        <button class="debug-button" onclick="testFinnishTTSModule3_Dim4_MapFinal()">æµ‹è¯•èŠ¬å…°è¯­TTS (æ¨¡å—3.4åœ°å›¾æœ€ç»ˆ)</button>
        <button class="debug-button" onclick="listVoices()">æŸ¥çœ‹å¯ç”¨è¯­éŸ³</button>
        <button class="debug-button" onclick="removeDebugSection()">ç§»é™¤è°ƒè¯•åŒºåŸŸ</button>
        <div id="debug-output" style="margin-top: 10px; padding: 10px; background-color: #f0f0f0; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;"></div>
    </div>

    <hr>

    <section id="intro-dimension4">
        <h2>ğŸš€ ç»´åº¦å››å¼•å…¥ï¼šè¶…è¶Šè‡ªæˆ‘ï¼Œæ‹¥æŠ±ä¸–ç•Œâ€”â€”ä¸œå—è¥¿åŒ—çš„å¬å”¤ï¼</h2>
        <div class="example">
            <p><span class="speakable-finnish">Hienosti olet edennyt!</span> (ä½ è¿›æ­¥ç¥é€Ÿï¼)</p>
            <p>åœ¨ä¹‹å‰çš„ç»´åº¦é‡Œï¼Œæˆ‘ä»¬å­¦ä¼šäº†å¦‚ä½•ä»¥â€œæˆ‘â€æˆ–â€œä½ â€ä¸ºä¸­å¿ƒæ¥æè¿°â€œå‰é¢â€ã€â€œå·¦è¾¹â€ç­‰ç›¸å¯¹ä½ç½®ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¯´å¤ªé˜³ä»å“ªä¸ªæ–¹å‘å‡èµ·ï¼Œæˆ–è€…èŠ¬å…°çš„é¦–éƒ½åœ¨å“ªä¸ªå¤§æ–¹å‘ï¼Œè¿™äº›â€œèº«ä½“åæ ‡â€å°±ä¸å¤Ÿç”¨äº†ã€‚</p>
            <p>ä¸–ç•Œæœ¬èº«æœ‰å®ƒå›ºå®šçš„ã€å®¢è§‚çš„æ–¹å‘ï¼š**ä¸œã€å—ã€è¥¿ã€åŒ—**ã€‚è¿™ä¸€ç»´åº¦ï¼Œæˆ‘ä»¬å°±æ¥ä¸€èµ·æ¢ç´¢èŠ¬å…°è¯­æ˜¯å¦‚ä½•æç»˜è¿™äº›â€œå®‡å®™çº§â€çš„åæ ‡è½´çš„ã€‚æ›´æœ‰è¶£çš„æ˜¯ï¼Œä½ ä¼šå‘ç°ï¼ŒèŠ¬å…°è¯­åœ¨è¡¨è¾¾è¿™äº›å¤§æ–¹å‘æ—¶ï¼Œç«Ÿç„¶ç”¨åˆ°äº†å’Œæˆ‘ä»¬æè¿°â€œåœ¨<span class="highlight">æˆ¿å­é‡Œ</span>â€æˆ–â€œå»<span class="highlight">å•†åº—é‡Œ</span>â€æ—¶éå¸¸ç›¸ä¼¼çš„â€œå£°éŸ³æ„Ÿè§‰â€ï¼</p>
            <p>å‡†å¤‡å¥½ç”¨ä½ çš„èŠ¬å…°è¯­â€œæŒ‡å—é’ˆâ€æ¥å®šä½æ•´ä¸ªä¸–ç•Œäº†å—ï¼Ÿ</p>
        </div>
        <div class="concept-map">
            <p><strong>ä»â€œæˆ‘çš„ä¸–ç•Œâ€åˆ°â€œä¸–ç•Œçš„ä¸–ç•Œâ€ï¼š</strong> <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7c/Compass_rose_pale.svg/100px-Compass_rose_pale.svg.png" alt="æŒ‡å—é’ˆ" style="vertical-align: middle; width:50px; height:50px;"> (æŒ‡å—é’ˆ)</p>
            <p><strong>èŠ¬å…°è¯­æ„ŸçŸ¥ï¼š</strong> å½“ä½ å¬åˆ°åƒ <span class="finnish-phrase speakable-finnish">pohjoisessa</span> è¿™æ ·çš„è¯´æ³•ï¼Œå®ƒå°±åœ¨å‘Šè¯‰ä½ æŸä¸ªäº‹ç‰©å¤„äºâ€œåŒ—æ–¹â€è¿™ä¸ªå¤§æ–¹å‘çš„â€œé‡Œé¢â€æˆ–â€œåŒºåŸŸâ€ã€‚</p>
        </div>
    </section>

    <hr>

    <section id="cardinal-directions-focus">
        <h3>ğŸ§­ã€è®¤çŸ¥å‡ºè¡€ç»“æ„ã€‘æ–¹å‘ä¸ç©ºé—´çš„èåˆï¼šä¸–ç•Œæ–¹å‘å¦‚ä½•ä¸ä½ çš„æ„ŸçŸ¥äº’åŠ¨ï¼Ÿ</h3>
        <div class="task-card"> 
            <p>æˆ‘ä»¬å°†é€šè¿‡ä¸‹é¢çš„è¡¨æ ¼ï¼Œé›†ä¸­å­¦ä¹ â€œä¸œã€å—ã€è¥¿ã€åŒ—â€è¿™å››ä¸ªåŸºæœ¬æ–¹å‘ã€‚è¯·ç‰¹åˆ«æ³¨æ„ï¼Œå½“èŠ¬å…°è¯­è¯´åˆ°â€œåœ¨æŸä¸ªæ–¹å‘â€ã€â€œå»å¾€æŸä¸ªæ–¹å‘â€æˆ–â€œä»æŸä¸ªæ–¹å‘æ¥â€çš„æ—¶å€™ï¼Œè¿™äº›æ–¹å‘è¯çš„â€œå°¾å·´éŸ³â€æ˜¯å¦‚ä½•å˜åŒ–çš„ã€‚è¯•ç€å°†è¿™äº›â€œå°¾å·´éŸ³â€å’Œä½ å·²ç»ç†Ÿæ‚‰çš„â€œå®¹å™¨æ„Ÿâ€ï¼ˆåœ¨é‡Œé¢/è¿›å»/å‡ºæ¥ï¼‰å’Œâ€œè¡¨é¢æ„Ÿâ€ï¼ˆåœ¨ä¸Šé¢/åˆ°ä¸Šé¢å»/ä»ä¸Šé¢ç¦»å¼€ï¼‰è”ç³»èµ·æ¥ï¼</p>
            <table class="directions-table">
                <thead>
                    <tr>
                        <th>ä¸–ç•Œæ–¹å‘<br>(<span class="speakable-finnish">Maailman suunta</span>)</th>
                        <th>â€œåœ¨â€è¯¥æ–¹å‘çš„åŒºåŸŸ<span class="highlight">é‡Œ</span><br>(<span class="finnish-phrase speakable-finnish">-ssa/-ssÃ¤</span> â€œå®¹å™¨â€æ„Ÿ)</th>
                        <th>â€œå»<span class="highlight">å¾€</span>â€è¯¥æ–¹å‘<br>(<span class="finnish-phrase speakable-finnish">-Vn/-seen</span> â€œè¿›å…¥â€æ„Ÿ)</th>
                        <th>â€œä»â€è¯¥æ–¹å‘<span class="highlight">æ¥</span><br>(<span class="finnish-phrase speakable-finnish">-sta/-stÃ¤</span> â€œé‡Šæ”¾â€æ„Ÿ)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>åŒ—æ–¹</strong><br>(<span class="speakable-finnish">Pohjoinen</span>)</td>
                        <td><span class="speakable-finnish">MinÃ¤ olen <span class="finnish-phrase">pohjoisessa</span>.</span><br><span class="note speakable-finnish">(SinÃ¤ asut <span class="finnish-phrase">pohjoisessa</span>.)</span></td>
                        <td><span class="speakable-finnish">MinÃ¤ menen <span class="finnish-phrase">pohjoiseen</span>.</span><br><span class="note speakable-finnish">(SinÃ¤ matkustat <span class="finnish-phrase">pohjoiseen</span>.)</span></td>
                        <td><span class="speakable-finnish">MinÃ¤ tulen <span class="finnish-phrase">pohjoisesta</span>.</span><br><span class="note speakable-finnish">(Tuuli tulee <span class="finnish-phrase">pohjoisesta</span>.)</span></td>
                    </tr>
                    <tr>
                        <td><strong>ä¸œæ–¹</strong><br>(<span class="speakable-finnish">ItÃ¤</span>)</td>
                        <td><span class="speakable-finnish">Aurinko on <span class="finnish-phrase">idÃ¤ssÃ¤</span>.</span><br><span class="note speakable-finnish">(Minun koti on <span class="finnish-phrase">idÃ¤ssÃ¤</span>.)</span></td>
                        <td><span class="speakable-finnish">MinÃ¤ katson <span class="finnish-phrase">itÃ¤Ã¤n</span>.</span><br><span class="note speakable-finnish">(SinÃ¤ kÃ¤Ã¤nnyt <span class="finnish-phrase">itÃ¤Ã¤n</span>.)</span></td>
                        <td><span class="speakable-finnish">Valo tulee <span class="finnish-phrase">idÃ¤stÃ¤</span>.</span><br><span class="note speakable-finnish">(SinÃ¤ tulet <span class="finnish-phrase">idÃ¤stÃ¤</span>.)</span></td>
                    </tr>
                    <tr>
                        <td><strong>å—æ–¹</strong><br>(<span class="speakable-finnish">EtelÃ¤</span>)</td>
                        <td><span class="speakable-finnish">Minun koulu on <span class="finnish-phrase">etelÃ¤ssÃ¤</span>.</span><br><span class="note speakable-finnish">(LÃ¤mpÃ¶ on <span class="finnish-phrase">etelÃ¤ssÃ¤</span>.)</span></td>
                        <td><span class="speakable-finnish">MinÃ¤ menen <span class="finnish-phrase">etelÃ¤Ã¤n</span>.</span><br><span class="note speakable-finnish">(SinÃ¤ haluat mennÃ¤ <span class="finnish-phrase">etelÃ¤Ã¤n</span>.)</span></td>
                        <td><span class="speakable-finnish">MinÃ¤ tulen <span class="finnish-phrase">etelÃ¤stÃ¤</span>.</span><br><span class="note speakable-finnish">(Lintu lentÃ¤Ã¤ <span class="finnish-phrase">etelÃ¤stÃ¤</span>.)</span></td>
                    </tr>
                    <tr>
                        <td><strong>è¥¿æ–¹</strong><br>(<span class="speakable-finnish">LÃ¤nsi</span>)</td>
                        <td><span class="speakable-finnish">Minun tyÃ¶paikka on <span class="finnish-phrase">lÃ¤nnessÃ¤</span>.</span><br><span class="note speakable-finnish">(Aurinko laskee <span class="finnish-phrase">lÃ¤nnessÃ¤</span>.)</span></td>
                        <td><span class="speakable-finnish">MinÃ¤ kÃ¤velen <span class="finnish-phrase">lÃ¤nteen</span>.</span><br><span class="note speakable-finnish">(SinÃ¤ ajat autolla <span class="finnish-phrase">lÃ¤nteen</span>.)</span></td>
                        <td><span class="speakable-finnish">MinÃ¤ tulen <span class="finnish-phrase">lÃ¤nnestÃ¤</span>.</span><br><span class="note speakable-finnish">(Sade tulee <span class="finnish-phrase">lÃ¤nnestÃ¤</span>.)</span></td>
                    </tr>
                </tbody>
            </table>
            <div class="usage-example">
                <h4>ğŸ§  ä¸­æ–‡æ¯è¯­è€…æ„ŸçŸ¥æ³¨å…¥ï¼š</h4>
                <p>ä½ ä¸æ˜¯åœ¨å•çº¯åœ°â€œæŒ‡æ–¹å‘â€ï¼Œä½ æ˜¯åœ¨æ„Ÿå—èŠ¬å…°è¯­å¦‚ä½•å°†â€œæ–¹å‘â€ä¹Ÿè§†ä¸ºä¸€ç§å¯ä»¥â€œè¿›å…¥â€ã€â€œåœ¨å…¶ä¸­â€æˆ–â€œä»ä¸­å‡ºæ¥â€çš„**æ¦‚å¿µç©ºé—´**ï¼</p>
                <ul>
                    <li>å¬åˆ°â€œ<span class="finnish-phrase speakable-finnish">pohjoise<span class="highlight">ssa</span></span>â€ï¼Œæ˜¯ä¸æ˜¯è®©ä½ æƒ³èµ·äº†â€œåœ¨æˆ¿å­<span class="highlight">é‡Œ</span>â€(<span class="finnish-phrase speakable-finnish">talossa</span>)é‚£ç§è¢«â€œåŒ…è£¹â€çš„æ„Ÿè§‰ï¼Ÿâ€”â€” å¯¹ï¼ŒèŠ¬å…°è¯­ç”¨åŒæ ·çš„æ–¹å¼æ¥è¡¨è¾¾â€œåœ¨åŒ—æ–¹è¿™ä¸ªå¤§åŒºåŸŸ<span class="highlight">é‡Œ</span>â€ï¼</li>
                    <li>å¬åˆ°â€œ<span class="finnish-phrase speakable-finnish">it<span class="highlight">Ã¤Ã¤n</span></span>â€ï¼Œæ˜¯ä¸æ˜¯è®©ä½ æƒ³èµ·äº†â€œå»å•†åº—<span class="highlight">é‡Œ</span>â€(<span class="finnish-phrase speakable-finnish">kauppa<span class="highlight">an</span></span>)é‚£ç§â€œè¿›å…¥â€çš„æ„Ÿè§‰ï¼Ÿâ€”â€” æ²¡é”™ï¼Œè¿™ä¹Ÿæ˜¯è¡¨è¾¾â€œå»<span class="highlight">å¾€</span>ä¸œæ–¹é‚£ä¸ªæ–¹å‘â€ï¼</li>
                    <li>å¬åˆ°â€œ<span class="finnish-phrase speakable-finnish">etelÃ¤<span class="highlight">stÃ¤</span></span>â€ï¼Œæ˜¯ä¸æ˜¯è®©ä½ æƒ³èµ·äº†â€œä»å£è¢‹<span class="highlight">é‡Œ</span>å‡ºæ¥â€(<span class="finnish-phrase speakable-finnish">tasku<span class="highlight">sta</span></span>)é‚£ç§â€œç¦»å¼€â€çš„æ„Ÿè§‰ï¼Ÿâ€”â€” å®Œå…¨æ­£ç¡®ï¼Œè¿™ä¹Ÿæ˜¯è¡¨è¾¾â€œä»å—æ–¹é‚£ä¸ªæ–¹å‘<span class="highlight">æ¥</span>â€ï¼</li>
                </ul>
                <p>èŠ¬å…°è¯­çš„è¿™ç§ä¸€è‡´æ€§æ˜¯ä¸æ˜¯å¾ˆé…·ï¼Ÿç”¨ä½ å·²ç»ç†Ÿæ‚‰çš„â€œå£°éŸ³æ„Ÿè§‰â€å»ç†è§£æ–°çš„æ¦‚å¿µï¼</p>
            </div>
        </div>
    </section>

    <hr>

    <section id="cognitive-task1-body-compass">
        <h3>ğŸ§ªã€è®¤çŸ¥å‡ºè¡€ä»»åŠ¡ä¸€ã€‘ä½ çš„èº«ä½“å°±æ˜¯æŒ‡å—é’ˆ (æ„ŸçŸ¥ä¸è¡¨è¾¾)</h3>
        <div class="task-card">
            <h4><span class="speakable-finnish">TehtÃ¤vÃ¤: Minun kehoni kompassina</span> (ä»»åŠ¡ï¼šæˆ‘çš„èº«ä½“ä½œä¸ºæŒ‡å—é’ˆ)</h4>
            <p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç”¨è‡ªå·±çš„èº«ä½“æ¥æ„Ÿå—å’Œè¡¨è¾¾è¿™äº›æ–¹å‘ã€‚æ‰¾ä¸€ä¸ªä½ èƒ½è¾¨åˆ«æ–¹å‘çš„åœ°æ–¹ï¼ˆæ¯”å¦‚èƒ½çœ‹åˆ°æ—¥å‡ºæ—¥è½çš„çª—è¾¹ï¼Œæˆ–è€…ä½ çŸ¥é“å“ªä¸ªæ–¹å‘æ˜¯åŒ—ï¼‰ã€‚</p>
            <ul class="task-list">
                <li>
                    <h5>1. é¢å¯¹å¤ªé˜³å‡èµ·çš„æ–¹å‘ï¼ˆä¸œæ–¹ - <span class="speakable-finnish">ItÃ¤</span>ï¼‰:</h5>
                    <ul>
                        <li><span class="speakable-finnish">Sano Ã¤Ã¤neen: "MinÃ¤ katson <span class="finnish-phrase">itÃ¤Ã¤n</span>."</span></li>
                        <li><span class="speakable-finnish">Ajattele: "Aurinko on <span class="finnish-phrase">idÃ¤ssÃ¤</span>."</span></li>
                        <li><span class="speakable-finnish">Tunne: MiltÃ¤ tuntuu katsoa <span class="finnish-phrase">itÃ¤Ã¤n</span>?</span></li>
                    </ul>
                </li>
                <li>
                    <h5>2. æƒ³è±¡ä½ è¦å»åŒ—æ–¹æ—…è¡Œï¼ˆåŒ—æ–¹ - <span class="speakable-finnish">Pohjoinen</span>ï¼‰:</h5>
                    <ul>
                        <li><span class="speakable-finnish">Sano Ã¤Ã¤neen: "MinÃ¤ haluan mennÃ¤ <span class="finnish-phrase">pohjoiseen</span>."</span></li>
                        <li><span class="speakable-finnish">Ajattele: "<span class="finnish-phrase">Pohjoisessa</span> on kylmÃ¤."</span></li>
                        <li><span class="speakable-finnish">Tunne: MiltÃ¤ tuntuu ajatella matkaa <span class="finnish-phrase">pohjoiseen</span>?</span></li>
                    </ul>
                </li>
                <li>
                    <h5>3. è½¬èº«ï¼Œè®©ä½ çš„èƒŒåæ˜¯å—æ–¹ï¼ˆå—æ–¹ - <span class="speakable-finnish">EtelÃ¤</span>ï¼‰:</h5>
                    <ul>
                        <li><span class="speakable-finnish">Sano Ã¤Ã¤neen: "Minun <span class="finnish-phrase">takana</span> on <span class="finnish-phrase">etelÃ¤</span>."</span></li>
                        <li><span class="speakable-finnish">Ajattele: "LÃ¤mpÃ¶ tulee <span class="finnish-phrase">etelÃ¤stÃ¤</span>."</span></li>
                    </ul>
                </li>
                 <li>
                    <h5>4. æƒ³è±¡å¤ªé˜³æ­£åœ¨è½ä¸‹ï¼ˆè¥¿æ–¹ - <span class="speakable-finnish">LÃ¤nsi</span>ï¼‰:</h5>
                    <ul>
                        <li><span class="speakable-finnish">Sano Ã¤Ã¤neen: "Aurinko laskee <span class="finnish-phrase">lÃ¤nnessÃ¤</span>. MinÃ¤ katson <span class="finnish-phrase">lÃ¤nteen</span>."</span></li>
                    </ul>
                </li>
            </ul>
            <p class="note">ğŸ§  èº«ä½“å‡ºè¡€æç¤ºï¼šæŠŠè¿™äº›æ–¹å‘å’Œä½ çš„çœŸå®ä½“éªŒè”ç³»èµ·æ¥ï¼â€œ<span class="speakable-finnish">idÃ¤ssÃ¤</span>â€ å°±æ˜¯ä½ æ—©ä¸Šçœ‹åˆ°å¤ªé˜³çš„åœ°æ–¹ï¼›å¦‚æœä½ çŸ¥é“ä½ å®¶çª—æˆ·æœåŒ—ï¼Œé‚£â€œ<span class="speakable-finnish">pohjoisessa</span>â€ å°±æ˜¯çª—å¤–çš„æ–¹å‘ã€‚</p>
        </div>
    </section>

    <hr>

     <section id="cognitive-task2-direction-spatial-nesting">
        <h3>ğŸŒã€è®¤çŸ¥å‡ºè¡€ä»»åŠ¡äºŒã€‘æ–¹å‘åµŒå¥—ä¸‰ç©ºé—´å‡ºè¡€ (èåˆç»ƒä¹ )</h3>
        <div class="task-card">
            <h4><span class="speakable-finnish">TehtÃ¤vÃ¤: Suunnat ja tilat yhdessÃ¤</span> (ä»»åŠ¡ï¼šæ–¹å‘ä¸ç©ºé—´ç›¸ç»“åˆ)</h4>
            <p>ä½ å·²ç»å­¦ä¼šäº†æè¿°â€œå°é—­å®¹å™¨â€ï¼ˆç»´åº¦ä¸€ï¼‰ã€â€œç‰©ä½“è¡¨é¢â€ï¼ˆç»´åº¦äºŒï¼‰å’Œâ€œç»å¯¹æ–¹å‘â€ï¼ˆç»´åº¦å››ï¼‰ã€‚ç°åœ¨æˆ‘ä»¬æ¥è¯•ç€æŠŠå®ƒä»¬å·§å¦™åœ°ç»“åˆèµ·æ¥ï¼ä»”ç»†å¬ä¸‹é¢çš„å¥å­ï¼Œæ„Ÿå—èŠ¬å…°è¯­æ˜¯å¦‚ä½•åœ¨åŒä¸€ä¸ªæƒ³æ³•é‡Œè¡¨è¾¾å¤šä¸ªç©ºé—´ä¿¡æ¯çš„ã€‚</p>
            <div class="example">
                <p><span class="speakable-finnish">MinÃ¤ olen <span class="finnish-phrase">pohjoisessa</span>, minun <span class="finnish-phrase">talossa</span>.</span> <span class="note">(æˆ‘åœ¨<span class="highlight">åŒ—æ–¹</span>ï¼Œåœ¨æˆ‘çš„æˆ¿å­<span class="highlight">é‡Œ</span>ã€‚)</span></p>
                <p><span class="speakable-finnish">SinÃ¤ laitat kirjan <span class="finnish-phrase">pÃ¶ydÃ¤lle</span>. PÃ¶ytÃ¤ on huoneen <span class="finnish-phrase">itÃ¤Ã¤n</span> pÃ¤in.</span> <span class="note">(ä½ æŠŠä¹¦æ”¾åˆ°æ¡Œå­<span class="highlight">ä¸Š</span>ã€‚æ¡Œå­æœæˆ¿é—´çš„<span class="highlight">ä¸œ</span>è¾¹ã€‚)</span></p>
                <p><span class="speakable-finnish">Minun auto on <span class="finnish-phrase">kadulla</span>. Katu on talon <span class="finnish-phrase">etelÃ¤puolella</span>.</span> <span class="note">(æˆ‘çš„è½¦åœ¨è¡—é“<span class="highlight">ä¸Š</span>ã€‚è¡—é“åœ¨æˆ¿å­çš„å—<span class="highlight">è¾¹</span>ã€‚)</span></p>
                <p><span class="speakable-finnish">SinÃ¤ tulet <span class="finnish-phrase">lÃ¤nnestÃ¤</span> ja menet suoraan <span class="finnish-phrase">kotiin</span>.</span> <span class="note">(ä½ ä»è¥¿è¾¹<span class="highlight">æ¥</span>ï¼Œç„¶åç›´æ¥å›å®¶<span class="highlight">é‡Œ</span>ã€‚)</span></p>
                <p><span class="speakable-finnish">Minun kahvikuppi on <span class="finnish-phrase">pÃ¶ydÃ¤llÃ¤</span>. PÃ¶ytÃ¤ on <span class="finnish-phrase">ikkunan edessÃ¤</span>, ja ikkuna on <span class="finnish-phrase">etelÃ¤Ã¤n</span>.</span> <span class="note">(æˆ‘çš„å’–å•¡æ¯åœ¨æ¡Œå­<span class="highlight">ä¸Š</span>ã€‚æ¡Œå­åœ¨çª—æˆ·<span class="highlight">å‰</span>ï¼Œå¹¶ä¸”çª—æˆ·æœ<span class="highlight">å—</span>ã€‚)</span></p>
            </div>
            <p class="note">ğŸ§  ä¸­æ–‡æ¯è¯­è€…æ³¨å…¥ï¼šè¿™ä¸åªæ˜¯åœ¨è¯´â€œæ–¹å‘â€æˆ–â€œä½ç½®â€ï¼Œè¿™æ˜¯åœ¨ç”¨èŠ¬å…°è¯­æ„å»ºä¸€ä¸ªæ›´ä¸°å¯Œçš„â€œç©ºé—´åœºæ™¯â€ï¼è¯•ç€åœ¨è„‘æµ·é‡Œç”»å‡ºè¿™äº›ç”»é¢ã€‚</p>
        </div>
    </section>

    <hr>
    
    <section id="cognitive-task3-map-training">
        <h3>ğŸ§­ã€è®¤çŸ¥å‡ºè¡€ä»»åŠ¡ä¸‰ã€‘æ–¹å‘ç©ºé—´åœ°å›¾è®­ç»ƒ (ç®€å•äº’åŠ¨)</h3>
        <div class="task-card">
            <h4><span class="speakable-finnish">TehtÃ¤vÃ¤: Karttaharjoitus</span> (ä»»åŠ¡ï¼šåœ°å›¾ç»ƒä¹ )</h4>
            <p>çœ‹ä¸‹é¢çš„ç®€åŒ–åœ°å›¾ã€‚å¬æˆ–è¯»èŠ¬å…°è¯­æè¿°ï¼Œç„¶åæŒ‡å‡ºæˆ–è¯´å‡ºå¯¹åº”çš„ä¿¡æ¯ã€‚ç”¨ä½ çš„èº«ä½“å»â€œæ„Ÿåº”â€è¿™äº›æ–¹å‘ï¼</p>
            <div class="interactive-map-container">
                <svg width="350" height="250" viewBox="0 0 120 80" style="border:1px solid #ccc; background-color: #f0f8ff;">
                    <!-- Compass Rose -->
                    <line x1="15" y1="10" x2="15" y2="30" stroke="#555" stroke-width="0.7"/> <text x="15" y1="7" font-size="5" fill="#333" text-anchor="middle" class="speakable-finnish">P</text> <polygon points="15,8 13,13 17,13" fill="red"/>
                    <line x1="15" y1="20" x2="35" y2="20" stroke="#555" stroke-width="0.7"/> <text x="38" y1="21.5" font-size="5" fill="#333" text-anchor="start" class="speakable-finnish">I</text> <polygon points="35,20 30,18 30,22" fill="#555"/>
                    <line x1="15" y1="20" x2="15" y2="40" stroke="#555" stroke-width="0.7"/> <text x="15" y1="45" font-size="5" fill="#333" text-anchor="middle" class="speakable-finnish">E</text> <polygon points="15,42 13,37 17,37" fill="#555"/>
                    <line x1="15" y1="20" x2="-5" y2="20" stroke="#555" stroke-width="0.7"/> <text x="-8" y1="21.5" font-size="5" fill="#333" text-anchor="end" class="speakable-finnish">L</text> <polygon points="-5,20 0,18 0,22" fill="#555"/>
                    <text x="15" y1="5" font-size="3" fill="grey" text-anchor="middle" class="speakable-finnish">Kompassi</text>
                    <!-- Locations -->
                    <rect id="Koti_A_Map" x="40" y="50" width="15" height="10" fill="#AED6F1" stroke="black" stroke-width="0.5"/> <text x="47.5" y="57" font-size="6" text-anchor="middle" fill="black">A</text> 
                    <rect id="Kauppa_B_Map" x="70" y="15" width="15" height="10" fill="#F5B7B1" stroke="black" stroke-width="0.5"/> <text x="77.5" y="22" font-size="6" text-anchor="middle" fill="black">B</text>
                    <circle id="Puisto_C_Map" cx="50" cy="20" r="7" fill="#ABEBC6" stroke="black" stroke-width="0.5"/> <text x="50" y="21.5" font-size="6" text-anchor="middle" fill="black">C</text>
                </svg>
                <p class="map-legend"><span class="speakable-finnish">Kartalla: A on Koti (<span class="finnish-phrase">koti</span>), B on Kauppa (<span class="finnish-phrase">kauppa</span>), C on Puisto (<span class="finnish-phrase">puisto</span>). P on Pohjoinen, I on ItÃ¤, E on EtelÃ¤, L on LÃ¤nsi.</span></p>
            </div>
            <div id="map-question-area">
                <!-- Map questions will appear here -->
            </div>
            <div style="text-align:center; margin-top:10px;">
                <button class="action-button" onclick="nextMapQuestion()">Seuraava karttatehtÃ¤vÃ¤</button>
            </div>
        </div>
    </section>

    <hr>

    <section id="dim4-summary-and-next">
        <h2>ğŸŒŸ ç»´åº¦å››æ„ŸçŸ¥å°ç»“ï¼šä½ æ‹¥æœ‰äº†â€œä¸–ç•Œåæ ‡â€çš„è¯­è¨€ï¼(å«æœ¯è¯­é”šå®š)</h2>
        <div class="summary-card">
            <p><span class="speakable-finnish">Uskomatonta! Osaat nyt puhua ilmansuunnista!</span> (éš¾ä»¥ç½®ä¿¡ï¼ä½ ç°åœ¨ä¼šè¯´åŸºæœ¬æ–¹å‘äº†ï¼)</p>
            <p>ä½ å·²ç»å¯¹èŠ¬å…°è¯­å¦‚ä½•è¡¨è¾¾â€œä¸œã€å—ã€è¥¿ã€åŒ—â€è¿™äº›ç»å¯¹æ–¹å‘æœ‰äº†åˆæ­¥çš„æ„ŸçŸ¥ï¼</p>
            <p>ä½ å¯èƒ½å·²ç»å†æ¬¡æ³¨æ„åˆ°ï¼Œå½“æè¿°â€œåœ¨æŸä¸ªæ–¹å‘â€ã€â€œå»æŸä¸ªæ–¹å‘â€æˆ–â€œä»æŸä¸ªæ–¹å‘æ¥â€æ—¶ï¼Œè¿™äº›æ–¹å‘è¯ï¼ˆæ¯”å¦‚ <span class="speakable-finnish">Pohjoinen</span> - åŒ—æ–¹ï¼‰çš„â€œå°¾å·´éŸ³â€ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè€Œä¸”è¿™äº›å˜åŒ–å¬èµ·æ¥éå¸¸åƒæˆ‘ä»¬ç»´åº¦ä¸€å­¦ä¹ â€œå°é—­å®¹å™¨â€æ—¶çš„æ„Ÿè§‰ï¼š</p>
            <ul style="list-style-type: disc; padding-left: 20px;">
                <li>åœ¨åŒ—æ–¹ï¼š<span class="finnish-phrase speakable-finnish">pohjoise<span class="highlight">ssa</span></span> ï¼ˆæ˜¯ä¸æ˜¯å¾ˆåƒ <span class="finnish-phrase speakable-finnish">talo<span class="highlight">ssa</span></span>ï¼Ÿï¼‰<span class="note">è¿™å¯¹åº”ç€æˆ‘ä»¬ä¹‹å‰é‡åˆ°çš„ **<span class="speakable-finnish">inessiivi</span> (Inessive case)** çš„æ„Ÿè§‰ã€‚</span></li>
                <li>å‘åŒ—æ–¹å»ï¼š<span class="finnish-phrase speakable-finnish">pohjoise<span class="highlight">en</span></span> ï¼ˆæ˜¯ä¸æ˜¯å¾ˆåƒ <span class="finnish-phrase speakable-finnish">taloo<span class="highlight">n</span></span>ï¼Ÿï¼‰<span class="note">è¿™å¯¹åº”ç€ **<span class="speakable-finnish">illatiivi</span> (Illative case)** çš„æ„Ÿè§‰ã€‚</span></li>
                <li>ä»åŒ—æ–¹æ¥ï¼š<span class="finnish-phrase speakable-finnish">pohjoise<span class="highlight">sta</span></span> ï¼ˆæ˜¯ä¸æ˜¯å¾ˆåƒ <span class="finnish-phrase speakable-finnish">talo<span class="highlight">sta</span></span>ï¼Ÿï¼‰<span class="note">è¿™å¯¹åº”ç€ **<span class="speakable-finnish">elatiivi</span> (Elative case)** çš„æ„Ÿè§‰ã€‚</span></li>
            </ul>
            <p class="note speakable-finnish">JÃ¤lleen kerran, nÃ¤mÃ¤ kielioppitermit ovat vain lisÃ¤tietoa. TÃ¤rkeintÃ¤ on se, ettÃ¤ tunnistat ja kÃ¤ytÃ¤t nÃ¤itÃ¤ muotoja oikeissa yhteyksissÃ¤! (å†è¯´ä¸€æ¬¡ï¼Œè¿™äº›è¯­æ³•æœ¯è¯­åªæ˜¯é™„åŠ ä¿¡æ¯ã€‚æœ€é‡è¦çš„æ˜¯ä½ èƒ½è®¤å‡ºå¹¶åœ¨æ­£ç¡®çš„è¯­å¢ƒä¸­ä½¿ç”¨è¿™äº›å½¢å¼ï¼)</p>
            <p>èŠ¬å…°è¯­å°±æ˜¯è¿™ä¹ˆæœ‰è§„å¾‹åˆå……æ»¡â€œå£°éŸ³é­”æ³•â€ï¼ä½ æ­£åœ¨é€šè¿‡æ„Ÿå—è¿™äº›æ¨¡å¼ï¼Œè€Œä¸æ˜¯æ­»è®°ç¡¬èƒŒï¼Œæ¥çœŸæ­£ç†è§£å®ƒã€‚</p>
            <p><strong>ä¸‹ä¸€ç»´åº¦ï¼š</strong> æˆ‘ä»¬å°†æ¢ç´¢ç‰©ä½“ä¸ç‰©ä½“ä¹‹é—´çš„æ›´å¤šç²¾ç¡®ä½ç½®å…³ç³»ï¼Œæ¯”å¦‚â€œåœ¨...<span class="highlight">æ—è¾¹</span>â€ã€â€œåœ¨...<span class="highlight">ä¸­é—´</span>â€ã€â€œåœ¨...<span class="highlight">ä¸Šæ–¹/ä¸‹æ–¹</span>ï¼ˆä¸æ¥è§¦çš„é‚£ç§ï¼‰â€ï¼Œè¿›å…¥ã€ä½ç½®å…³ç³»ã€‘çš„ç²¾å½©ä¸–ç•Œï¼</p>
        </div>
    </section>

    <hr>
    <section id="new-vocabulary-list-m3p4" class="new-vocab-section">
        <h3>ğŸ“š æœ¬ç»´åº¦æ–°æœ‹å‹ï¼šè¯æ±‡ç§¯ç´¯ (èšç„¦æ ¸å¿ƒæ–¹å‘è¯å’Œé«˜é¢‘è¾…åŠ©è¯)</h3>
        <p>ä»¥ä¸‹æ˜¯æœ¬ç»´åº¦ï¼ˆæ¨¡å—ä¸‰Â·ç»´åº¦å››ï¼‰æˆ‘ä»¬é‡ç‚¹æ¥è§¦å’Œæ„ŸçŸ¥çš„æ ¸å¿ƒâ€œæ–¹å‘åè¯â€ï¼Œä»¥åŠä¸€äº›æ„æˆä¾‹å¥å¿…éœ€çš„ç®€å•é«˜é¢‘è¯æ±‡ã€‚æˆ‘ä»¬ä¾ç„¶ä¸»è¦åœ¨ç¬¬ä¸€å’Œç¬¬äºŒäººç§°çš„ç®€å•å¥å­ä¸­ä½¿ç”¨å®ƒä»¬ã€‚</p>
        <table class="vocab-list-table">
            <thead>
                <tr>
                    <th>èŠ¬å…°è¯­æ–°è¯ (åŸå½¢)</th>
                    <th>ä¸­æ–‡æ„æ€</th>
                    <th>ä½ æœ€å¸¸å¬åˆ°çš„â€œåœ¨/å»/ä»â€å½¢å¼</th>
                </tr>
            </thead>
            <tbody>
                <tr><td><span class="speakable-finnish">Pohjoinen</span></td><td>åŒ—æ–¹</td><td><span class="speakable-finnish">pohjoisessa, pohjoiseen, pohjoisesta</span></td></tr>
                <tr><td><span class="speakable-finnish">EtelÃ¤</span></td><td>å—æ–¹</td><td><span class="speakable-finnish">etelÃ¤ssÃ¤, etelÃ¤Ã¤n, etelÃ¤stÃ¤</span></td></tr>
                <tr><td><span class="speakable-finnish">ItÃ¤</span></td><td>ä¸œæ–¹</td><td><span class="speakable-finnish">idÃ¤ssÃ¤, itÃ¤Ã¤n, idÃ¤stÃ¤</span></td></tr>
                <tr><td><span class="speakable-finnish">LÃ¤nsi</span></td><td>è¥¿æ–¹</td><td><span class="speakable-finnish">lÃ¤nnessÃ¤, lÃ¤nteen, lÃ¤nnestÃ¤</span></td></tr>
                <tr><td><span class="speakable-finnish">aurinko</span></td><td>å¤ªé˜³</td><td>-</td></tr>
                <tr><td><span class="speakable-finnish">tuuli</span></td><td>é£</td><td>-</td></tr>
                <tr><td><span class="speakable-finnish">valo</span></td><td>å…‰</td><td>-</td></tr>
                <tr><td><span class="speakable-finnish">kartta</span></td><td>åœ°å›¾</td><td>-</td></tr>
                <tr><td><span class="speakable-finnish">kaupunki</span></td><td>åŸå¸‚</td><td>-</td></tr>
                <tr><td><span class="speakable-finnish">loma</span></td><td>å‡æœŸ</td><td>-</td></tr>
                <tr><td><span class="speakable-finnish">ilma</span></td><td>ç©ºæ°”</td><td>-</td></tr>
                <tr><td><span class="speakable-finnish">raja</span></td><td>è¾¹ç•Œ</td><td>-</td></tr>
                <tr><td><span class="speakable-finnish">huone</span></td><td>æˆ¿é—´</td><td>-</td></tr>
                <tr><td><span class="speakable-finnish">suunta</span></td><td>æ–¹å‘</td><td>-</td></tr>
                <tr><td><span class="speakable-finnish">tyÃ¶paikka</span></td><td>å·¥ä½œåœ°ç‚¹</td><td>-</td></tr>
                <tr><td><span class="speakable-finnish">sade</span></td><td>é›¨</td><td>-</td></tr>
                <tr><td><span class="speakable-finnish">kylmÃ¤</span></td><td>å†·çš„ (å½¢å®¹è¯)</td><td>-</td></tr>
                <tr><td><span class="speakable-finnish">lÃ¤mmin</span></td><td>æš–å’Œçš„ (å½¢å®¹è¯)</td><td>-</td></tr>
                <tr><td><span class="speakable-finnish">matkustaa</span></td><td>æ—…è¡Œ</td><td><span class="speakable-finnish">minÃ¤ matkustan, sinÃ¤ matkustat</span></td></tr>
                <tr><td><span class="speakable-finnish">asua</span></td><td>å±…ä½</td><td><span class="speakable-finnish">minÃ¤ asun, sinÃ¤ asut</span></td></tr>
                <tr><td><span class="speakable-finnish">nousta</span></td><td>å‡èµ·; èµ·åºŠ</td><td><span class="note">(aurinko nousee)</span></td></tr>
                <tr><td><span class="speakable-finnish">laskea</span></td><td>è½ä¸‹; è®¡ç®—</td><td><span class="note">(aurinko laskee)</span></td></tr>
                <tr><td><span class="speakable-finnish">kÃ¤Ã¤ntyÃ¤</span></td><td>è½¬å¼¯</td><td><span class="speakable-finnish">minÃ¤ kÃ¤Ã¤nnyn, sinÃ¤ kÃ¤Ã¤nnyt</span></td></tr>
                <tr><td><span class="speakable-finnish">puhaltaa</span></td><td>å¹ (é£)</td><td><span class="note">(tuuli puhaltaa)</span></td></tr>
                <tr><td><span class="speakable-finnish">virrata</span></td><td>æµåŠ¨</td><td><span class="note">(ilma virtaa)</span></td></tr>
                 <tr><td><span class="speakable-finnish">sanoa</span></td><td>è¯´</td><td><span class="speakable-finnish">minÃ¤ sanon, sinÃ¤ sanot</span></td></tr>
                <tr><td><span class="speakable-finnish">pitÃ¤Ã¤</span></td><td>å¿…é¡» (+åŠ¨è¯åŸºæœ¬å‹)</td><td><span class="note">(minun pitÃ¤Ã¤ mennÃ¤)</span></td></tr>
                <tr><td><span class="speakable-finnish">katsoa</span></td><td>çœ‹</td><td><span class="speakable-finnish">minÃ¤ katson, sinÃ¤ katsot</span></td></tr>
                <tr><td><span class="speakable-finnish">itÃ¤Ã¤npÃ¤in</span></td><td>æœä¸œæ–¹å‘åœ° (å‰¯è¯)</td><td>-</td></tr>
                <tr><td><span class="speakable-finnish">pohjoispuoli</span></td><td>åŒ—è¾¹ (åè¯)</td><td><span class="note speakable-finnish">(esim. pÃ¶ydÃ¤n pohjoispuolella)</span></td></tr>
                <tr><td><span class="speakable-finnish">etelÃ¤puoli</span></td><td>å—è¾¹ (åè¯)</td><td><span class="note speakable-finnish">(esim. talon etelÃ¤puolella)</span></td></tr>
                <tr><td><span class="speakable-finnish">lÃ¤nsipuoli</span></td><td>è¥¿è¾¹ (åè¯)</td><td><span class="note speakable-finnish">(esim. ikkunan lÃ¤nsipuolella)</span></td></tr>
                <tr><td><span class="speakable-finnish">itÃ¤puoli</span></td><td>ä¸œè¾¹ (åè¯)</td><td><span class="note speakable-finnish">(esim. puiston itÃ¤puolella)</span></td></tr>
            </tbody>
        </table>
    </section>

<script>
    const finnishLang = 'fi-FI';

    function debugLog(message) {
        const output = document.getElementById('debug-output');
        if (output && output.innerHTML !== undefined) {
            const time = new Date().toLocaleTimeString();
            output.innerHTML += `[${time}] ${message}<br>`;
            output.scrollTop = output.scrollHeight;
        }
    }

    function testBasicTTS() {
        debugLog('å¼€å§‹æµ‹è¯•åŸºæœ¬TTSåŠŸèƒ½...');
        if (!('speechSynthesis' in window)) {
            debugLog('âŒ é”™è¯¯ï¼šæµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆAPI');
            alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½ã€‚');
            return;
        }
        debugLog('âœ… æµè§ˆå™¨æ”¯æŒè¯­éŸ³åˆæˆAPI');
        const utterance = new SpeechSynthesisUtterance('Hello World');
        utterance.onstart = () => debugLog('âœ… è‹±è¯­æµ‹è¯•å¼€å§‹æ’­æ”¾');
        utterance.onend = () => debugLog('âœ… è‹±è¯­æµ‹è¯•æ’­æ”¾å®Œæˆ');
        utterance.onerror = (event) => debugLog('âŒ è‹±è¯­æµ‹è¯•é”™è¯¯: ' + event.error);
        window.speechSynthesis.speak(utterance);
    }

    function testFinnishTTSModule3_Dim4_MapFinal() { 
        debugLog('å¼€å§‹æµ‹è¯•èŠ¬å…°è¯­TTSåŠŸèƒ½ (æ¨¡å—3.4åœ°å›¾æœ€ç»ˆ)...');
        const utterance = new SpeechSynthesisUtterance('MinÃ¤ asun pohjoisessa.');
        utterance.lang = finnishLang;
        utterance.onstart = () => debugLog('âœ… èŠ¬å…°è¯­(M3 D4 MapFinal)æµ‹è¯•å¼€å§‹æ’­æ”¾');
        utterance.onend = () => debugLog('âœ… èŠ¬å…°è¯­(M3 D4 MapFinal)æµ‹è¯•æ’­æ”¾å®Œæˆ');
        utterance.onerror = (event) => debugLog('âŒ èŠ¬å…°è¯­(M3 D4 MapFinal)æµ‹è¯•é”™è¯¯: ' + event.error);
        window.speechSynthesis.speak(utterance);
    }
     function listVoices() {
        debugLog('æ­£åœ¨è·å–å¯ç”¨è¯­éŸ³åˆ—è¡¨...');
        const voices = window.speechSynthesis.getVoices();
        if (voices.length === 0) {
            debugLog('âš ï¸ æœªæ‰¾åˆ°ä»»ä½•è¯­éŸ³ï¼Œè¯­éŸ³å¯èƒ½è¿˜åœ¨åŠ è½½ä¸­ã€‚');
            window.speechSynthesis.onvoiceschanged = () => {
                debugLog('è¯­éŸ³åˆ—è¡¨å·²æ›´æ–°ï¼Œé‡æ–°è·å–...');
                const updatedVoices = window.speechSynthesis.getVoices();
                if (updatedVoices.length === 0 && voices.length === 0) { 
                    debugLog('âš ï¸ æ›´æ–°åä»æœªæ‰¾åˆ°ä»»ä½•è¯­éŸ³ã€‚'); return;
                }
                if (updatedVoices.length > 0) logVoiceList(updatedVoices);
            };
            if (navigator.userAgent.toLowerCase().indexOf('firefox') > -1 || (navigator.userAgent.toLowerCase().indexOf('safari') > -1 && navigator.userAgent.toLowerCase().indexOf('chrome') === -1) ) {
                setTimeout(() => { if(window.speechSynthesis.getVoices().length > 0) listVoices(); }, 500);
            }
            return;
        }
        logVoiceList(voices);
    }
     function logVoiceList(voices) {
        debugLog(`æ‰¾åˆ° ${voices.length} ä¸ªå¯ç”¨è¯­éŸ³:`);
        voices.forEach((voice, index) => {
            const isDefault = voice.default ? ' (é»˜è®¤)' : '';
            debugLog(`${index + 1}. ${voice.name} (${voice.lang})${isDefault}`);
        });
        const finnishVoices = voices.filter(voice =>
            voice.lang.toLowerCase().startsWith('fi') ||
            voice.name.toLowerCase().includes('finnish') ||
            voice.name.toLowerCase().includes('suomi')
        );
        if (finnishVoices.length > 0) {
            debugLog(`âœ… æ‰¾åˆ° ${finnishVoices.length} ä¸ªèŠ¬å…°è¯­è¯­éŸ³:`);
            finnishVoices.forEach(voice => {
                debugLog(`  - ${voice.name} (${voice.lang})`);
            });
        } else {
            debugLog('âŒ æœªæ‰¾åˆ°èŠ¬å…°è¯­è¯­éŸ³ã€‚');
        }
    }

    function removeDebugSection() {
        const debugSection = document.querySelector('.debug-section');
        if (debugSection) {
            debugSection.style.display = 'none';
            debugLog('è°ƒè¯•åŒºåŸŸå·²éšè—');
        }
    }

    let isSpeaking = false;
    function speakText(text, lang = finnishLang) {
        if (!('speechSynthesis' in window)) return;
        if (isSpeaking) {
            window.speechSynthesis.cancel();
            setTimeout(() => startSpeaking(text, lang), 50);
        } else {
            startSpeaking(text, lang);
        }
    }

    function startSpeaking(text, lang) {
        isSpeaking = true;
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = lang;
        utterance.rate = 0.9;
        utterance.pitch = 1.0;
        utterance.volume = 1.0;
        const voices = window.speechSynthesis.getVoices();
        let selectedVoice = null;
        if (lang.toLowerCase().startsWith('fi')) {
            selectedVoice = voices.find(voice => voice.lang.toLowerCase() === 'fi-fi') ||
                            voices.find(voice => voice.lang.toLowerCase().startsWith('fi')) ||
                            voices.find(voice => voice.name.toLowerCase().includes('finnish') || voice.name.toLowerCase().includes('suomi'));
        }
        if (selectedVoice) utterance.voice = selectedVoice;
        utterance.onend = () => { isSpeaking = false; };
        utterance.onerror = (event) => {
            debugLog(`âŒ æ’­æ”¾é”™è¯¯: ${event.error} (æ–‡æœ¬: "${text}")`);
            isSpeaking = false;
        };
        window.speechSynthesis.speak(utterance);
    }

    function addTTSButton(element, textToSpeak) {
        let cleanedText = textToSpeak.replace(/\s*\(.*?\)\s*/g, '').trim(); 
        cleanedText = cleanedText.replace(/ï¼ˆ.*?ï¼‰/g, '').trim();
        cleanedText = cleanedText.replace(/\[.*?\]/g, '').trim();

        if (!cleanedText || cleanedText === '') return;
        
        const existingButton = Array.from(element.childNodes).find(node => node.nodeType === Node.ELEMENT_NODE && node.classList.contains('tts-button') && node.title === 'æ’­æ”¾: ' + cleanedText);
        if (existingButton) return;

        const button = document.createElement('button');
        button.className = 'tts-button';
        button.innerHTML = 'ğŸ”Š';
        button.title = 'æ’­æ”¾: ' + cleanedText;
        button.setAttribute('aria-label', 'æ’­æ”¾éŸ³é¢‘: ' + cleanedText);
        button.onclick = (event) => {
            event.preventDefault();
            event.stopPropagation();
            speakText(cleanedText);
        };
        
        if (element.tagName === 'SPAN' && (element.classList.contains('speakable-finnish') || element.classList.contains('finnish-phrase'))) {
            if (!element.querySelector('.tts-button')) {
                element.appendChild(button);
            }
        } else {
            let insertBeforeNode = null;
            for (let i = 0; i < element.childNodes.length; i++) {
                const child = element.childNodes[i];
                if (child.nodeType === Node.ELEMENT_NODE && (child.classList.contains('note') || child.classList.contains('chinese-sense'))) {
                    insertBeforeNode = child;
                    break;
                }
            }
            if (insertBeforeNode) {
                element.insertBefore(button, insertBeforeNode);
            } else {
                element.appendChild(button);
            }
        }
    }
    
    function initializeTTSForPage() {
        debugLog('ğŸš€ åˆå§‹åŒ–é¡µé¢TTSæŒ‰é’® (æ¨¡å—ä¸‰Â·ç»´åº¦å›› æ–¹å‘ç©ºé—´ - åœ°å›¾æœ€ç»ˆä¼˜åŒ–)...');
        
        document.querySelectorAll('.speakable-finnish, .finnish-phrase').forEach(span => {
            const text = span.textContent.trim();
            if (text && !span.querySelector('.tts-button')) {
                 addTTSButton(span, text);
            }
        });

        const sentenceLevelContainers = [
            ...document.querySelectorAll('.direction-card-content p.example-sentence'),
            ...document.querySelectorAll('.usage-example p'), 
            ...document.querySelectorAll('.task-card ul li'),
            ...document.querySelectorAll('.task-card ul ul li'), 
            ...document.querySelectorAll('.interactive-map-container text.speakable-finnish'), 
            ...document.querySelectorAll('.directions-table td'),
            ...document.querySelectorAll('.new-vocab-section .vocab-list-table td:first-child'),
            ...document.querySelectorAll('.new-vocab-section .vocab-list-table td:nth-child(3)'),
            ...document.querySelectorAll('#intro-dimension4 .example p'),
            ...document.querySelectorAll('#intro-dimension4 .concept-map p'),
            ...document.querySelectorAll('#dim4-summary-and-next .summary-card p'),
            ...document.querySelectorAll('#dim4-summary-and-next .summary-card ul li'),
            ...document.querySelectorAll('#map-question-area p') 
        ];

        sentenceLevelContainers.forEach(el => {
            if (el.classList.contains('speakable-finnish') || el.classList.contains('finnish-phrase')) return;
            if (el.querySelector('.tts-button')) { 
                let hasOwnButton = false;
                for(let child of el.childNodes){
                    if(child.nodeType === Node.ELEMENT_NODE && child.classList.contains('tts-button')){
                        hasOwnButton = true;
                        break;
                    }
                }
                if(hasOwnButton || el.querySelector('.speakable-finnish .tts-button')) return;
            }
            if (el.closest('thead')) return;

            let textToSpeak = "";
            Array.from(el.childNodes).forEach(node => {
                if (node.nodeType === Node.TEXT_NODE) {
                    textToSpeak += node.textContent;
                } else if (node.nodeType === Node.ELEMENT_NODE &&
                           !node.classList.contains('note') &&
                           !node.classList.contains('chinese-sense') &&
                           !node.classList.contains('tts-button') &&
                           !node.classList.contains('speakable-finnish') && 
                           !node.classList.contains('finnish-phrase') &&
                           !node.classList.contains('highlight') &&
                           node.tagName !== 'IMG' && node.tagName !== 'svg'
                           ) {
                    textToSpeak += node.textContent; 
                }
            });
            textToSpeak = textToSpeak.trim();
            
            if (textToSpeak.length > 1 && textToSpeak.match(/[Ã¤Ã¶Ã¥Ã„Ã–Ã…]/i)) { 
                addTTSButton(el, textToSpeak);
            }
        });
        
        document.querySelectorAll('.direction-card h4 .speakable-finnish, .task-card h4 .speakable-finnish, .task-list h5 .speakable-finnish').forEach(el => {
             if(!el.querySelector('.tts-button')) addTTSButton(el, el.textContent);
        });
        
        document.querySelectorAll('#intro-dimension4 h2, #cardinal-directions-focus h3, #cognitive-task1-body-compass h3, #cognitive-task2-direction-spatial-nesting h3, #cognitive-task3-map-training h3, #language-bleeding-plan-dim4 h2, #dim4-summary-and-next h2, #new-vocabulary-list-m3p4 h3').forEach(h => {
            if (!h.querySelector('.tts-button')) { 
                const text = h.textContent.split('(')[0].trim();
                if (text.length > 1 && text.match(/[Ã¤Ã¶Ã¥Ã„Ã–Ã…]/i)) {
                    addTTSButton(h, text);
                }
            }
        });

        debugLog('âœ… é¡µé¢TTSæŒ‰é’®åˆå§‹åŒ–å®Œæ¯• (æ¨¡å—ä¸‰Â·ç»´åº¦å›› æ–¹å‘ç©ºé—´ - åœ°å›¾æœ€ç»ˆä¼˜åŒ–)');
    }
    
    // --- Interactive Map Quiz Logic for Dimension 4 (Map with Letters - Corrected) ---
    const mapQuestions = [
        {
            instruction_fi: "Katso karttaa. Kohde C (<span class='speakable-finnish'>Puisto</span>) on kohteen A (<span class='speakable-finnish'>Koti</span>) <span class='speakable-finnish'>pohjoispuolella</span>. Osoita kohde C kartalla.",
            instruction_zh: "çœ‹åœ°å›¾ã€‚ç›®æ ‡Cï¼ˆå…¬å›­ï¼‰åœ¨ç›®æ ‡Aï¼ˆå®¶ï¼‰çš„åŒ—è¾¹ã€‚è¯·åœ¨åœ°å›¾ä¸ŠæŒ‡å‡ºç›®æ ‡Cã€‚",
            correct_answer_for_tts_feedback: "Kohde C, Puisto, on kartan ylÃ¤osassa, Koti A:n ylÃ¤puolella."
        },
        {
            instruction_fi: "SinÃ¤ olet kohteessa C (<span class='speakable-finnish'>Puisto</span>). Kohde B (<span class='speakable-finnish'>Kauppa</span>) on sinun <span class='speakable-finnish'>itÃ¤puolella</span>si. Mihin suuntaan sinÃ¤ menet kohteeseen B?",
            instruction_zh: "ä½ åœ¨ç›®æ ‡Cï¼ˆå…¬å›­ï¼‰ã€‚ç›®æ ‡Bï¼ˆå•†åº—ï¼‰åœ¨ä½ çš„ä¸œè¾¹ã€‚ä½ å‘å“ªä¸ªæ–¹å‘å»ç›®æ ‡Bï¼Ÿ",
            correct_answer_for_tts_feedback: "MinÃ¤ menen itÃ¤Ã¤n."
        },
        {
            instruction_fi: "Jos aurinko paistaa <span class='speakable-finnish'>idÃ¤stÃ¤</span> (kartan oikealta puolelta), ja sinÃ¤ seisot kohteessa A (<span class='speakable-finnish'>Koti</span>) ja katsot kohdetta C (<span class='speakable-finnish'>Puisto</span>), missÃ¤ suunnassa aurinko on sinuun nÃ¤hden?",
            instruction_zh: "å¦‚æœå¤ªé˜³ä»ä¸œæ–¹ï¼ˆåœ°å›¾çš„å³è¾¹ï¼‰ç…§è¿‡æ¥ï¼Œä½ ç«™åœ¨ç›®æ ‡Aï¼ˆå®¶ï¼‰çœ‹ç€ç›®æ ‡Cï¼ˆå…¬å›­ï¼‰ï¼Œå¤ªé˜³ç›¸å¯¹äºä½ åœ¨å“ªä¸ªæ–¹å‘ï¼Ÿ",
            correct_answer_for_tts_feedback: "Aurinko on minun oikealla puolellani."
        },
        {
            instruction_fi: "SinÃ¤ tulet kohteesta B (<span class='speakable-finnish'>Kauppa</span>) ja kÃ¤velet suoraan <span class='speakable-finnish'>lÃ¤nteen</span>. MinkÃ¤ kohteen <span class='speakable-finnish'>lÃ¤helle</span> sinÃ¤ tulet ensin?",
            instruction_zh: "ä½ ä»ç›®æ ‡Bï¼ˆå•†åº—ï¼‰å‡ºæ¥ï¼Œç„¶åå¾„ç›´å‘è¥¿èµ°ã€‚ä½ ä¼šé¦–å…ˆåˆ°è¾¾å“ªä¸ªç›®æ ‡çš„é™„è¿‘ï¼Ÿ",
            correct_answer_for_tts_feedback: "MinÃ¤ tulen Puiston (C) lÃ¤helle."
        },
        {
            instruction_fi: "Jos sinÃ¤ olet kohteessa A (<span class='speakable-finnish'>Koti</span>) ja haluat mennÃ¤ kohteeseen B (<span class='speakable-finnish'>Kauppa</span>), sinun tÃ¤ytyy mennÃ¤ ensin <span class='speakable-finnish'>pohjoiseen</span> ja sitten <span class='speakable-finnish'>itÃ¤Ã¤n</span>. Onko tÃ¤mÃ¤ totta vai ei?",
            instruction_zh: "å¦‚æœä½ åœ¨ç›®æ ‡Aï¼ˆå®¶ï¼‰å¹¶ä¸”æƒ³å»ç›®æ ‡Bï¼ˆå•†åº—ï¼‰ï¼Œä½ å¿…é¡»å…ˆå‘åŒ—èµ°ç„¶åå†å‘ä¸œèµ°ã€‚è¿™æ˜¯å¯¹çš„è¿˜æ˜¯ä¸å¯¹çš„ï¼Ÿ",
            correct_answer_for_tts_feedback: "KyllÃ¤, se on totta."
        }
    ];
    let currentMapQuestionIndex = 0;
    const mapQuestionArea = document.getElementById('map-question-area');

    function displayMapQuestion() {
        if (!mapQuestionArea) return;
        const q = mapQuestions[currentMapQuestionIndex];
        // Create a temporary div to parse the instruction_fi and add TTS to speakable parts
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = q.instruction_fi;
        tempDiv.querySelectorAll('.speakable-finnish').forEach(span => {
            if (!span.querySelector('.tts-button')) { // Avoid double-adding if already has one
                addTTSButton(span, span.textContent);
            }
        });
        
        mapQuestionArea.innerHTML = `<p class="example-sentence">${tempDiv.innerHTML} <span class="note">(${q.instruction_zh})</span></p>`;
        // Add TTS to the entire P if it doesn't have one from a span
        const questionP = mapQuestionArea.querySelector('p.example-sentence');
        if (questionP && !questionP.querySelector('.tts-button') && !questionP.querySelector('span.speakable-finnish .tts-button')) {
            let textToSpeak = "";
            Array.from(questionP.childNodes).forEach(node => {
                if (node.nodeType === Node.TEXT_NODE) textToSpeak += node.textContent;
                else if (node.nodeType === Node.ELEMENT_NODE && (node.classList.contains('speakable-finnish') || node.classList.contains('finnish-phrase'))) textToSpeak += node.textContent;
            });
             if(textToSpeak.trim().length > 0) addTTSButton(questionP, textToSpeak.trim());
        }

        mapQuestionArea.innerHTML += `<button class="action-button" style="font-size:0.9em; padding: 5px 10px; margin-top:5px;" onclick="speakText('${q.correct_answer_for_tts_feedback.replace(/'/g, "\\'").replace(/"/g, '\\"')}')"><span class="speakable-finnish">Kuuntele esimerkkivastaus</span> (å¬ç­”æ¡ˆç¤ºä¾‹)</button>`;
        const newActionButton = mapQuestionArea.querySelector('.action-button');
        if (newActionButton) {
             const btnSpeakable = newActionButton.querySelector('.speakable-finnish');
             if (btnSpeakable && !btnSpeakable.querySelector('.tts-button')) addTTSButton(btnSpeakable, btnSpeakable.textContent);
        }
    }

    function nextMapQuestion() {
        currentMapQuestionIndex = (currentMapQuestionIndex + 1) % mapQuestions.length;
        displayMapQuestion();
    }


    document.addEventListener('DOMContentLoaded', () => {
        if (window.speechSynthesis.getVoices().length === 0) {
            window.speechSynthesis.onvoiceschanged = initializeTTSForPage;
        } else {
            initializeTTSForPage();
        }
        setTimeout(initializeTTSForPage, 200); 
        if (document.getElementById('map-question-area')) {
             displayMapQuestion(); 
        }
    });
</script>
</body>
</html>