<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>èŠ¬å…°è¯­å…¥é—¨ - æˆ‘å–è¡¨è¾¾ç³»ç»Ÿ (æ¨¡å—äºŒÂ·5) (TTS)</title>
    <style>
        body {
            font-family: "Microsoft YaHei", sans-serif;
            line-height: 1.6;
            margin: 20px auto;
            max-width: 900px;
            padding: 0 20px;
        }
        h1, h2, h3, h4 {
            color: #2c3e50;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            overflow-x: auto;
            display: block;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        thead {
            background-color: #f4f4f4;
        }
        .example { /* Default for non-specific sections if any */
            background-color: #fdfefe;
            padding: 10px;
            border-left: 4px solid #A9CCE3; /* A general light blue for examples */
            margin: 10px 0;
        }
        .tts-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2em;
            margin-left: 5px;
            padding: 0;
            display: inline-block;
            vertical-align: middle;
        }
        .tts-button:hover {
            opacity: 0.7;
        }
        .debug-section {
            background-color: #fffbf0;
            border: 2px solid #ffa500;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .debug-button {
            background-color: #4CAF50;
            color: white;
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .debug-button:hover {
            background-color: #45a049;
        }
        .note {
            font-size: 0.9em;
            color: #555;
            margin-left: 10px;
        }
        .final-summary ul {
            list-style-type: none;
            padding-left: 0;
        }
        .final-summary ul li {
            margin-bottom: 5px;
            font-weight: bold;
        }
        .final-summary ul li .speakable-finnish { /* Ensure speakable-finnish in lists are normal weight */
            font-weight: normal;
        }
        /* Section-specific example box colors */
        #modular-generator .example, #practice-list .example {
             border-left-color: #8E44AD; /* Purple for Juon specific examples */
        }
        #scenario-training .example {
            border-left-color: #1ABC9C; /* Teal for scenario training */
        }
        #implantation-choice .example {
            border-left-color: #F1C40F; /* Yellow for implantation choice */
        }

    </style>
</head>
<body>

<h1>ğŸ§± æ¨¡å—äºŒÂ·5ï¼šã€è¡Œä¸ºæ¿€æ´»å™¨ã€‘"Juon + [äº‹ç‰©ï¼Œéƒ¨åˆ†æ ¼]"ï¼ˆæˆ‘å–...ï¼‰</h1>

<!-- TTSè°ƒè¯•åŒºåŸŸ -->
<div class="debug-section">
    <h3>ğŸ”§ TTSåŠŸèƒ½æµ‹è¯•</h3>
    <p>å¦‚æœTTSæŒ‰é’®æ²¡æœ‰å£°éŸ³ï¼Œè¯·å…ˆæµ‹è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
    <button class="debug-button" onclick="testBasicTTS()">æµ‹è¯•åŸºæœ¬TTS</button>
    <button class="debug-button" onclick="testFinnishTTS('Juon kahvia.')">æµ‹è¯•èŠ¬å…°è¯­TTS (Juon kahvia)</button>
    <button class="debug-button" onclick="listVoices()">æŸ¥çœ‹å¯ç”¨è¯­éŸ³</button>
    <button class="debug-button" onclick="removeDebugSection()">ç§»é™¤è°ƒè¯•åŒºåŸŸ</button>
    <div id="debug-output" style="margin-top: 10px; padding: 10px; background-color: #f0f0f0; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;"></div>
</div>

<hr>

<section id="cognitive-core">
    <h2>ğŸ§  è®¤çŸ¥ç»‘å®šæ ¸å¿ƒï¼š</h2>
    <p><strong>â€œ<span class="speakable-finnish">Haluan</span>â€æ˜¯æ„æ„¿ï¼Œâ€œ<span class="speakable-finnish">Tarvitsen</span>â€æ˜¯å¿…è¦ï¼Œâ€œ<span class="speakable-finnish">Juon</span>â€æ˜¯ç°å®ã€‚</strong></p>
    <p>ä½ å·²ç»å¯ä»¥è¡¨è¾¾ä½ æƒ³/éœ€è¦ä»€ä¹ˆï¼Œ ç°åœ¨ä½ å°†æ¿€æ´»ä¸€ä¸ª<strong>æ–°çš„è¯­è¨€å±‚</strong>ï¼šä½ æ­£åœ¨<strong>åšå®ƒ</strong>ã€‚</p>
    <table>
        <thead>
            <tr>
                <th>åŠ¨è¯</th>
                <th>åŠŸèƒ½</th>
                <th>åœºæ™¯</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><span class="speakable-finnish">Haluan</span></td><td>æ„æ„¿ â†’ â€œæˆ‘è¦ç‚¹å•¥ã€‚â€</td><td>ç‚¹å•ã€è¯¢é—®</td></tr>
            <tr><td><span class="speakable-finnish">Tarvitsen</span></td><td>å¿…è¦ â†’ â€œæˆ‘å¾—ç”¨ã€‚â€</td><td>ç”Ÿå­˜ã€æ—¥å¸¸éœ€æ±‚</td></tr>
            <tr><td><span class="speakable-finnish">Juon</span></td><td>è¡Œä¸º â†’ â€œæˆ‘åœ¨å–ã€‚â€</td><td>çœŸå®è¡Œä¸ºæè¿°ã€ç¤¾äº¤</td></tr>
            <tr><td><span class="speakable-finnish">En juo</span></td><td>å¦å®šè¡Œä¸º â†’ â€œæˆ‘ä¸å–ã€‚â€</td><td>å¥åº·/æ–‡åŒ–è¡¨è¾¾</td></tr>
        </tbody>
    </table>
</section>

<hr>

<section id="vocab-table">
    <h2>ğŸ§¬ é«˜é¢‘é¥®å“è¯æ±‡è¡¨ï¼ˆéƒ¨åˆ†æ ¼ + åŸå½¢ + ä¸­æ–‡ï¼‰</h2>
    <table>
        <thead>
            <tr>
                <th>åŸå½¢</th>
                <th>éƒ¨åˆ†æ ¼</th>
                <th>ä¸­æ–‡</th>
                <th>ä½¿ç”¨ç¤ºä¾‹</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><span class="speakable-finnish">kahvi</span></td><td><span class="speakable-finnish">kahvia</span></td><td>å’–å•¡</td><td><span class="speakable-finnish">Juon kahvia.</span></td></tr>
            <tr><td><span class="speakable-finnish">vesi</span></td><td><span class="speakable-finnish">vettÃ¤</span></td><td>æ°´</td><td><span class="speakable-finnish">Juon vettÃ¤.</span></td></tr>
            <tr><td><span class="speakable-finnish">maito</span></td><td><span class="speakable-finnish">maitoa</span></td><td>ç‰›å¥¶</td><td><span class="speakable-finnish">Juon maitoa.</span></td></tr>
            <tr><td><span class="speakable-finnish">olut</span></td><td><span class="speakable-finnish">olutta</span></td><td>å•¤é…’</td><td><span class="speakable-finnish">Juon olutta.</span></td></tr>
            <tr><td><span class="speakable-finnish">mehu</span></td><td><span class="speakable-finnish">mehua</span></td><td>æœæ±</td><td><span class="speakable-finnish">Juon mehua.</span></td></tr>
            <tr><td><span class="speakable-finnish">limsa</span></td><td><span class="speakable-finnish">limsaa</span></td><td>è½¯é¥®æ–™</td><td><span class="speakable-finnish">Juon limsaa.</span></td></tr>
            <tr><td><span class="speakable-finnish">tee</span></td><td><span class="speakable-finnish">teetÃ¤</span></td><td>èŒ¶</td><td><span class="speakable-finnish">Juon teetÃ¤.</span></td></tr>
            <tr><td><span class="speakable-finnish">virvoitusjuoma</span></td><td><span class="speakable-finnish">virvoitusjuomaa</span></td><td>è‹æ‰“æ°´/æ°”æ³¡æ°´</td><td><span class="speakable-finnish">Juon virvoitusjuomaa.</span></td></tr>
            <tr><td><span class="speakable-finnish">kalsaripesÃ¤</span> <span class="note">(å£è¯­)</span></td><td><span class="speakable-finnish">kalsaripesÃ¤Ã¤</span></td><td>å•¤é…’æ¯ï¼ˆä¿šè¯­ï¼Œç‰¹æŒ‡0.5Lï¼‰</td><td><span class="speakable-finnish">Juon kalsaripesÃ¤Ã¤.</span> <span class="note">(éæ­£å¼åœºåˆ)</span></td></tr>
        </tbody>
    </table>
</section>

<hr>

<section id="modular-generator">
    <h2>ğŸ§© æ¨¡å—åŒ–è¯­å—ç”Ÿæˆå™¨ï¼ˆç»‘å®šè¡Œä¸ºå’Œç°å®ï¼‰</h2>
    <div class="example">
        <p><span class="speakable-finnish">Juon kahvia.</span></p>
        <p><span class="speakable-finnish">Juon vettÃ¤.</span></p>
        <p><span class="speakable-finnish">Juon maitoa.</span></p>
        <p><span class="speakable-finnish">Juon tÃ¤tÃ¤.</span></p>
        <p><span class="speakable-finnish">Juon jotain makeaa.</span></p>
        <p><span class="speakable-finnish">Juon jotain kylmÃ¤Ã¤.</span> <span class="note">(kylmÃ¤Ã¤ = å‡‰çš„ (éƒ¨åˆ†æ ¼))</span></p>
    </div>

    <h4>ä½ å¯ä»¥æ­é…ä½¿ç”¨ï¼š</h4>
    <table>
        <thead>
            <tr>
                <th>è¡Œä¸º</th>
                <th>è¡¨è¾¾</th>
                <th>ä¸­æ–‡æ˜ å°„</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>å–å’–å•¡</td><td><span class="speakable-finnish">Juon kahvia.</span></td><td>å’–å•¡æ˜¯æ—¥å¸¸</td></tr>
            <tr><td>å–æ°´</td><td><span class="speakable-finnish">Juon vettÃ¤.</span></td><td>å¥åº·é€‰æ‹©</td></tr>
            <tr><td>å–è½¯é¥®</td><td><span class="speakable-finnish">Juon limsaa.</span></td><td>è½»æ¾é¥®æ–™</td></tr>
            <tr><td>å–æœæ±</td><td><span class="speakable-finnish">Juon mehua.</span></td><td>æ—©é¤/å¥åº·</td></tr>
            <tr><td>å–ç‚¹çƒ­çš„</td><td><span class="speakable-finnish">Juon jotain lÃ¤mmintÃ¤.</span></td><td>å†¬å­£/é¥­é¦†</td></tr>
            <tr><td>å–ç‚¹ç”œçš„</td><td><span class="speakable-finnish">Juon jotain makeaa.</span></td><td>ç”œé¥®éœ€æ±‚</td></tr>
        </tbody>
    </table>
</section>

<hr>

<section id="chinese-binding">
    <h2>ğŸ§  ä¸­æ–‡è¯­æ„Ÿç»‘å®šï¼šJuon = â€œæˆ‘å–/é¥®/é¥®ä¸‹...â€</h2>
    <p>ä¸­æ–‡æ¯è¯­è€…å¯¹â€œ<span class="speakable-finnish">juoda</span>â€åŠ¨è¯å·²ç»éå¸¸ç†Ÿæ‚‰ï¼ˆæˆ‘è¦å–ç‚¹ä»€ä¹ˆï¼‰ã€‚<br>
    â€œ<span class="speakable-finnish">Juon</span>â€æ˜¯å®ƒçš„â€œç°å®æ€â€ â€”â€” <strong>â€œæˆ‘ç°åœ¨é¥®ä¸‹å®ƒâ€</strong>ã€‚</p>
    <table>
        <thead>
            <tr>
                <th>ä¸­æ–‡ â†’ èŠ¬å…°è¯­</th>
                <th>è¯­è¨€ç»‘å®š</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>æˆ‘å–å’–å•¡ã€‚ï¼ˆæˆ‘é¥®ä¸‹ï¼‰</td><td><span class="speakable-finnish">Juon kahvia.</span></td></tr>
            <tr><td>æˆ‘å–ç‚¹æ°´ã€‚ï¼ˆæˆ‘é¥®ä¸‹ä¸€ç‚¹ï¼‰</td><td><span class="speakable-finnish">Juon vettÃ¤.</span></td></tr>
            <tr><td>æˆ‘å–æœæ±ã€‚ï¼ˆæˆ‘é¥®ä¸‹ï¼‰</td><td><span class="speakable-finnish">Juon mehua.</span></td></tr>
            <tr><td>æˆ‘å–ç‰›å¥¶ã€‚ï¼ˆæˆ‘é¥®ä¸‹ï¼‰</td><td><span class="speakable-finnish">Juon maitoa.</span></td></tr>
            <tr><td>æˆ‘å–è½¯é¥®æ–™ã€‚ï¼ˆæˆ‘é¥®ä¸‹ï¼‰</td><td><span class="speakable-finnish">Juon limsaa.</span></td></tr>
            <tr><td>æˆ‘å–ç‚¹çƒ­çš„ã€‚ï¼ˆæˆ‘é¥®ä¸‹ï¼‰</td><td><span class="speakable-finnish">Juon jotain lÃ¤mmintÃ¤.</span></td></tr>
        </tbody>
    </table>
</section>

<hr>

<section id="scenario-training">
    <h2>ğŸ§ª åœºæ™¯è®­ç»ƒå¥—ä»¶ï¼ˆä½¿ç”¨æ¨¡å—äºŒå…¨éƒ¨ç»“æ„ï¼‰</h2>
    <div class="example">
        <h3>ğŸ“ åœºæ™¯ 1ï¼šåœ¨å’–å•¡åº—</h3>
        <p><span class="speakable-finnish">Haluan kahvia, kiitos.</span></p>
        <p><span class="speakable-finnish">Juon kahvia.</span></p>
        <p><span class="speakable-finnish">En pidÃ¤ tÃ¤stÃ¤ kahvista.</span></p>
        <p><span class="speakable-finnish">Tarvitsen vÃ¤hÃ¤n aikaa.</span></p>
    </div>
    <div class="example">
        <h3>ğŸ“ åœºæ™¯ 2ï¼šæœ‹å‹é—®ä½ å–ä»€ä¹ˆ</h3>
        <p>æœ‹å‹: <span class="speakable-finnish">MitÃ¤ juot?</span></p>
        <p>ä½ : <span class="speakable-finnish">Juon kahvia.</span></p>
        <p>ä½ : <span class="speakable-finnish">PidÃ¤n kahvista.</span></p>
        <p>ä½ : <span class="speakable-finnish">En halua mehua.</span></p>
    </div>
    <div class="example">
        <h3>ğŸ“ åœºæ™¯ 3ï¼šé¤å…æˆ–é¥­é¦†</h3>
        <p><span class="speakable-finnish">Juon jotain lÃ¤mmintÃ¤.</span></p>
        <p><span class="speakable-finnish">Tarvitsen juomaa.</span></p>
        <p><span class="speakable-finnish">Haluan kahvia.</span></p>
        <p><span class="speakable-finnish">En tarvitse olutta.</span></p>
    </div>
    <div class="example">
        <h3>ğŸ“ åœºæ™¯ 4ï¼šè‡ªæˆ‘å¯¹è¯ï¼ˆè¯­è¨€æ¤å…¥ï¼‰</h3>
        <p><span class="speakable-finnish">Juon kahvia.</span></p>
        <p><span class="speakable-finnish">Tarvitsen lisÃ¤Ã¤.</span></p>
        <p><span class="speakable-finnish">PidÃ¤n tÃ¤stÃ¤.</span></p>
        <p><span class="speakable-finnish">En halua lopettaa.</span></p>
    </div>
</section>

<hr>

<section id="reality-implantation-challenge">
    <h2>ğŸ§¬ ç°å®æ¤å…¥æŒ‘æˆ˜ï¼ˆä¸‰æ—¥è®¡åˆ’ï¼‰</h2>
    <h3>ğŸ“† ç¬¬1æ—¥ï¼š</h3>
    <ul>
        <li><span class="speakable-finnish">åä¸‹å’–å•¡åº— â†’ è¯´ï¼š"Juon kahvia. Tarvitsen kahvia."</span></li>
        <li><span class="speakable-finnish">å–æ°´æ—¶ â†’ è¯´ï¼š"Juon vettÃ¤. PidÃ¤n vedestÃ¤."</span></li>
        <li><span class="speakable-finnish">å¯¹æœåŠ¡å‘˜è¯´ï¼š"En halua mehua."</span></li>
    </ul>
    <h3>ğŸ“† ç¬¬2æ—¥ï¼š</h3>
    <ul>
        <li><span class="speakable-finnish">åœ¨èœå•å‰ â†’ æŒ‡ï¼š"Juon tÃ¤tÃ¤."ï¼ˆæŒ‡ä»»æ„é¥®å“ï¼‰</span></li>
        <li><span class="speakable-finnish">è¢«é—®ï¼š"MitÃ¤ haluat?" â†’ è¯´ï¼š"En halua, kiitos. Juon kahvia."</span> <span class="note">(è¿™é‡ŒåŸæ–‡æ²¡æœ‰ myÃ¶hemmin, ä¿æŒåŸæ ·)</span></li>
        <li><span class="speakable-finnish">è¢«é—®ï¼š"Miten pidÃ¤t tÃ¤stÃ¤?" â†’ è¯´ï¼š"PidÃ¤n tÃ¤stÃ¤. Juon lisÃ¤Ã¤."</span></li>
    </ul>
    <h3>ğŸ“† ç¬¬3æ—¥ï¼š</h3>
    <ul>
        <li><span class="speakable-finnish">æœ‹å‹é—®ï¼š"Haluatko mehua?" â†’ è¯´ï¼š"En halua mehua. Juon kahvia."</span></li>
        <li><span class="speakable-finnish">è¢«é€’ä¸Šæœæ± â†’ è¯´ï¼š"En pidÃ¤ mehusta. Juon kahvia."</span> <span class="note">(è¿™é‡ŒåŸæ–‡æ²¡æœ‰ mieluummin, ä¿æŒåŸæ ·)</span></li>
        <li><span class="speakable-finnish">åœ¨é•œå­å‰å–å’–å•¡ â†’ è¯´ï¼š"Juon kahvia. Haluan lisÃ¤Ã¤. Tarvitsen kahvia."</span></li>
    </ul>
</section>

<hr>

<section id="cognitive-binding-summary">
    <h2>ğŸ§  è®¤çŸ¥ç»‘å®šï¼šæ¨¡å—äºŒå››å¤§åŠ¨è¯ç³»ç»Ÿ</h2>
    <p>ä½ ç°åœ¨æ‹¥æœ‰ï¼š</p>
    <table>
        <thead>
            <tr>
                <th>åŠ¨è¯</th>
                <th>åŠŸèƒ½</th>
                <th>æ ¼</th>
                <th>è¯­è¨€å®‡å®™çš„å±‚é¢</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><span class="speakable-finnish">Haluan</span></td><td>æ„æ„¿</td><td>éƒ¨åˆ†æ ¼</td><td>â€œæˆ‘æƒ³è¦â€</td></tr>
            <tr><td><span class="speakable-finnish">Tarvitsen</span></td><td>å¿…è¦</td><td>éƒ¨åˆ†æ ¼</td><td>â€œæˆ‘éœ€è¦â€</td></tr>
            <tr><td><span class="speakable-finnish">PidÃ¤n</span></td><td>å–œå¥½</td><td>å‡ºæ ¼</td><td>â€œæˆ‘å–œæ¬¢â€</td></tr>
            <tr><td><span class="speakable-finnish">Juon</span></td><td>è¡Œä¸º</td><td>éƒ¨åˆ†æ ¼</td><td>â€œæˆ‘æ­£åœ¨â€ <span class="note">(åº”ä¸ºâ€œæˆ‘æ­£åœ¨å–â€)</span></td></tr>
        </tbody>
    </table>
</section>

<hr>

<section id="practice-list">
    <h2>âœ… é«˜é¢‘é¥®å“è¯­å—ç»ƒä¹ æ¸…å•ï¼ˆæ¨¡å—äºŒé™å®šï¼‰</h2>
    <div class="example">
        <p><span class="speakable-finnish">Juon kahvia.</span></p>
        <p><span class="speakable-finnish">Juon vettÃ¤.</span></p>
        <p><span class="speakable-finnish">Juon maitoa.</span></p>
        <p><span class="speakable-finnish">Juon mehua.</span></p>
        <p><span class="speakable-finnish">Juon limsaa.</span></p>
        <p><span class="speakable-finnish">Juon jotain makeaa.</span></p>
        <p><span class="speakable-finnish">Juon jotain lÃ¤mmintÃ¤.</span></p>
        <p><span class="speakable-finnish">En juo olutta.</span></p>
        <p><span class="speakable-finnish">En juo mehua.</span></p>
        <p><span class="speakable-finnish">En juo liian makeaa.</span></p>
    </div>
    <p>æ¯å¤©é€‰å…¶ä¸­3å¥ï¼Œå’ŒåŠ¨ä½œç»‘å®šç»ƒï¼š</p>
    <ul>
        <li>å¯¹ç€æ¯å­è¯´</li>
        <li>åœ¨å’–å•¡åº—è¯´å‡º</li>
        <li>åœ¨è¶…å¸‚è´§æ¶è¯´å‡º</li>
        <li>å’Œæœ‹å‹æ¨¡æ‹Ÿå¯¹è¯</li>
    </ul>
</section>

<hr>

<section id="language-bleeding-task">
    <h2>ğŸ§± è¯­è¨€å‡ºè¡€ä»»åŠ¡ï¼ˆå’–å•¡åº—ä»Šæ—¥å®æˆ˜ï¼‰</h2>
    <p>è¯·å®Œæˆä»¥ä¸‹ä¸‰é¡¹ï¼š</p>
    <ol>
        <li><span class="speakable-finnish">åä¸‹å’–å•¡åº— â†’ è‡ªè¨€è‡ªè¯­ï¼š"Juon kahvia."ï¼ˆç”¨å˜´å”‡å–çš„åŠ¨ä½œï¼‰</span></li>
        <li><span class="speakable-finnish">è¢«é€’ä¸Šæœæ± â†’ è¯´ï¼š"En halua mehua. Juon kahvia."</span></li>
        <li><span class="speakable-finnish">æœ‹å‹é—®ï¼š"MitÃ¤ pidÃ¤t tÃ¤stÃ¤?" â†’ å›åº”ï¼š"PidÃ¤n, mutta en pidÃ¤ mehusta."</span></li>
    </ol>
</section>

<hr>

<section id="cafe-expression-toolkit">
    <h2>ğŸ§ª æ¨¡å—äºŒå’–å•¡åº—ç»ˆæè¡¨è¾¾å™¨ï¼ˆæ¨¡å—äºŒé™å®šå¥å‹ï¼‰</h2>
    <table>
        <thead>
            <tr>
                <th>èŠ¬å…°è¯­å¥å­</th>
                <th>ä¸­æ–‡ç¿»è¯‘</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><span class="speakable-finnish">Haluan kahvia.</span></td><td>æˆ‘æƒ³è¦ç‚¹å’–å•¡ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Tarvitsen kahvia.</span></td><td>æˆ‘éœ€è¦å’–å•¡ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">PidÃ¤n kahvista.</span></td><td>æˆ‘å–œæ¬¢å’–å•¡ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Juon kahvia.</span></td><td>æˆ‘å–å’–å•¡ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En halua mehua.</span></td><td>æˆ‘ä¸æƒ³è¦æœæ±ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En tarvitse maitoa.</span></td><td>æˆ‘ä¸éœ€è¦ç‰›å¥¶ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En pidÃ¤ mehusta.</span></td><td>æˆ‘ä¸å–œæ¬¢æœæ±ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En juo mehua.</span></td><td>æˆ‘ä¸å–æœæ±ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Haluan jotain lÃ¤mmintÃ¤.</span></td><td>æˆ‘æƒ³è¦ç‚¹çƒ­çš„ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Juon jotain makeaa.</span></td><td>æˆ‘å–ç‚¹ç”œçš„ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Tarvitsen vettÃ¤.</span></td><td>æˆ‘éœ€è¦æ°´ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">En pidÃ¤ siitÃ¤.</span></td><td>æˆ‘ä¸å–œæ¬¢é‚£ä¸ªã€‚</td></tr>
            <tr><td><span class="speakable-finnish">PidÃ¤n tÃ¤stÃ¤.</span></td><td>æˆ‘å–œæ¬¢è¿™ä¸ªã€‚</td></tr>
            <tr><td><span class="speakable-finnish">Juon kahvia, kiitos.</span></td><td>æˆ‘å–å’–å•¡ï¼Œè°¢è°¢ã€‚</td></tr>
            <tr><td><span class="speakable-finnish">MissÃ¤ on kahvia?</span></td><td>å’–å•¡åœ¨å“ªï¼Ÿ<span class="note">(è¯¢é—®æ˜¯å¦æœ‰å’–å•¡æä¾›)</span></td></tr>
            <tr><td><span class="speakable-finnish">TÃ¤ssÃ¤ on hyvÃ¤Ã¤?</span></td><td>è¿™ä¸ªå¥½å—ï¼Ÿ<span class="note">(æ›´å£è¯­åŒ–)</span></td></tr>
        </tbody>
    </table>
</section>

<hr>

<section class="final-summary">
    <p>ä½ å·²ç»æ„å»ºäº†ä¸€ä¸ªå®Œæ•´çš„ã€å’–å•¡åº—è¯­è¨€å®‡å®™ã€‘ï¼Œä½¿ç”¨çš„æ˜¯ä½ åœ¨ã€æ¨¡å—äºŒã€‘ä¸­æ¤å…¥çš„ï¼š</p>
    <ul>
        <li><span class="speakable-finnish">Haluan</span> = æˆ‘æƒ³è¦</li>
        <li><span class="speakable-finnish">Tarvitsen</span> = æˆ‘éœ€è¦</li>
        <li><span class="speakable-finnish">PidÃ¤n</span> = æˆ‘å–œæ¬¢</li>
        <li><span class="speakable-finnish">Juon</span> = æˆ‘æ­£åœ¨å–</li>
        <li><span class="speakable-finnish">En halua</span> = æˆ‘ä¸æƒ³è¦</li>
        <li><span class="speakable-finnish">En tarvitse</span> = æˆ‘ä¸éœ€è¦</li>
        <li><span class="speakable-finnish">En pidÃ¤</span> = æˆ‘ä¸å–œæ¬¢</li>
        <li><span class="speakable-finnish">En juo</span> = æˆ‘ä¸å–</li>
    </ul>
</section>
<hr>
<section id="implantation-choice" class="example">
    <h4>ç°åœ¨ï¼Œè¯·é€‰æ‹©ä¸€ä¸ªä½ æœ€æƒ³æ¤å…¥çš„â€œæˆ‘å–â€è¯­å—ï¼š</h4>
    <p>
        <button class="debug-button" onclick="selectImplantation('Juon kahvia.')">å–å’–å•¡ â†’ <span class="speakable-finnish">"Juon kahvia."</span></button><br>
        <button class="debug-button" onclick="selectImplantation('Juon mehua.')">å–æœæ± â†’ <span class="speakable-finnish">"Juon mehua."</span></button><br>
        <button class="debug-button" onclick="selectImplantation('Juon jotain makeaa.')">å–ç‚¹ç”œçš„ â†’ <span class="speakable-finnish">"Juon jotain makeaa."</span></button><br>
        <button class="debug-button" onclick="selectImplantation('Juon jotain lÃ¤mmintÃ¤.')">å–ç‚¹çƒ­çš„ â†’ <span class="speakable-finnish">"Juon jotain lÃ¤mmintÃ¤."</span></button>
    </p>
    <div id="implantation-plan-juon" style="margin-top: 15px; padding: 10px; background-color: #f0e6f6; border-radius: 4px; display: none;">
        <h5>è¡Œä¸ºæ¤å…¥+è¯­è¨€å‡ºè¡€+ç°å®è§¦å‘è®­ç»ƒè®¡åˆ’ (é’ˆå¯¹ <span id="selected-phrase-juon" style="font-weight:bold;"></span>):</h5>
        <ol>
            <li><strong>è¡Œä¸ºæ¤å…¥ (æ¯æ—¥3æ¬¡ï¼ŒæŒç»­3å¤©):</strong>
                <ul>
                    <li><strong>è§†è§‰/ä½“æ„Ÿè§¦å‘:</strong> æ¯æ¬¡çœ‹åˆ°/æƒ³åˆ°/æ‹¿èµ·é€‰å®šçš„é¥®å“æ—¶ï¼Œç«‹å³åœ¨è„‘æµ·ä¸­æˆ–è½»å£°è¯´å‡ºå¯¹åº”çš„èŠ¬å…°è¯­è¯­å—ã€‚</li>
                    <li><strong>åŠ¨ä½œç»‘å®š:</strong> åœ¨å®é™…å–è¿™ç§é¥®å“æˆ–æ¨¡æ‹Ÿå–çš„åŠ¨ä½œæ—¶ï¼Œæ¸…æ™°åœ°è¯´å‡ºè¯­å—ã€‚</li>
                    <li><strong>æƒ…æ™¯è”æƒ³:</strong> æƒ³è±¡è‡ªå·±åœ¨èŠ¬å…°ç‰¹å®šåœºæ™¯ï¼ˆå’–å•¡é¦†ã€å®¶ã€èšä¼šï¼‰ä¸­ï¼Œéœ€è¦ç”¨åˆ°è¿™ä¸ªè¯­å—ï¼Œå¹¶è¿›è¡Œæ¨¡æ‹Ÿå¯¹è¯ã€‚</li>
                </ul>
            </li>
            <li><strong>è¯­è¨€å‡ºè¡€ (æ¯æ—¥è‡³å°‘è¯´å‡º5æ¬¡ï¼ŒæŒç»­3å¤©):</strong>
                <ul>
                    <li><strong>è‡ªæˆ‘å¯¹è¯:</strong> å¯¹ç€æ¯å­ã€æˆ–è€…åœ¨å€’é¥®æ–™æ—¶ï¼Œå¤§å£°è¯´å‡ºè¯­å—ã€‚</li>
                    <li><strong>å¾®ç¤¾äº¤å‡ºè¡€:</strong> å¦‚æœæœ‰æœºä¼šï¼Œå°è¯•åœ¨ä¸å®¶äºº/æœ‹å‹è°ˆè®ºé¥®å“æ—¶ï¼Œæ’å…¥è¿™ä¸ªèŠ¬å…°è¯­è¯­å—ï¼Œå¹¶ç®€å•è§£é‡Šã€‚</li>
                    <li><strong>â€œå†…å¿ƒç‹¬ç™½â€å‡ºè¡€:</strong> åœ¨å–é€‰å®šé¥®å“æ—¶ï¼Œç”¨èŠ¬å…°è¯­è¿›è¡Œå†…å¿ƒç‹¬ç™½ï¼Œä¾‹å¦‚ï¼š"<span class="speakable-finnish">Juon kahvia. TÃ¤mÃ¤ kahvi on hyvÃ¤Ã¤. Haluan lisÃ¤Ã¤.</span>"</li>
                </ul>
            </li>
            <li><strong>ç°å®è§¦å‘ (æ‰¾åˆ°è‡³å°‘2ä¸ªçœŸå®æœºä¼šï¼ŒæŒç»­1å‘¨):</strong>
                <ul>
                    <li><strong>ä¸»åŠ¨åˆ›é€ æœºä¼š:</strong> ç‚¹å•æ—¶ï¼Œå¦‚æœèœå•ä¸Šæœ‰ç±»ä¼¼é¥®å“ï¼Œå°è¯•ä½¿ç”¨è¿™ä¸ªè¯­å—ã€‚è´­ä¹°é¥®å“æ—¶ï¼Œä¹Ÿå¯ä»¥å¯¹è‡ªå·±è¯´ã€‚</li>
                    <li><strong>è¢«åŠ¨ååº”:</strong> å½“åˆ«äººæåˆ°ç›¸å…³é¥®å“ï¼Œæˆ–åœ¨åª’ä½“ä¸Šçœ‹åˆ°æ—¶ï¼Œç«‹å³æ¿€æ´»å¤§è„‘ä¸­çš„èŠ¬å…°è¯­è¯­å—ã€‚</li>
                    <li><strong>ç¯å¢ƒæç¤º:</strong> åœ¨æ°´æ¯æ—æˆ–å†°ç®±ä¸Šè´´ä¸Šå†™æœ‰è¯¥è¯­å—çš„ä¾¿ç­¾ï¼Œä½œä¸ºè§†è§‰è§¦å‘å™¨ã€‚</li>
                </ul>
            </li>
        </ol>
        <p><strong>ç›®æ ‡ï¼š</strong> è®©è¿™ä¸ªè¯­å—æˆä¸ºä½ æƒ³åˆ°è¯¥é¥®å“/è¡Œä¸ºæ—¶çš„ç¬¬ä¸€è¯­è¨€ååº”ï¼</p>
    </div>
</section>

<script>
/**
 * è°ƒè¯•è¾“å‡ºå‡½æ•°
 * @param {string} message - è¦æ˜¾ç¤ºçš„æ¶ˆæ¯
 */
function debugLog(message) {
    const output = document.getElementById('debug-output');
    if (output) {
        const time = new Date().toLocaleTimeString();
        output.innerHTML += `[${time}] ${message}<br>`;
        output.scrollTop = output.scrollHeight;
    }
    console.log(message);
}

/**
 * æµ‹è¯•åŸºæœ¬TTSåŠŸèƒ½
 */
function testBasicTTS() {
    debugLog('å¼€å§‹æµ‹è¯•åŸºæœ¬TTSåŠŸèƒ½...');
    if (!('speechSynthesis' in window)) {
        debugLog('âŒ é”™è¯¯ï¼šæµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆAPI');
        alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½ï¼Œè¯·å°è¯•ä½¿ç”¨Chromeã€Edgeæˆ–Firefoxçš„æœ€æ–°ç‰ˆæœ¬ã€‚');
        return;
    }
    debugLog('âœ… æµè§ˆå™¨æ”¯æŒè¯­éŸ³åˆæˆAPI');
    
    const utterance = new SpeechSynthesisUtterance('Hello World');
    utterance.onstart = () => debugLog('âœ… è‹±è¯­æµ‹è¯•å¼€å§‹æ’­æ”¾');
    utterance.onend = () => debugLog('âœ… è‹±è¯­æµ‹è¯•æ’­æ”¾å®Œæˆ');
    utterance.onerror = (event) => debugLog('âŒ è‹±è¯­æµ‹è¯•é”™è¯¯: ' + event.error);
    
    window.speechSynthesis.speak(utterance);
}

/**
 * æµ‹è¯•èŠ¬å…°è¯­TTSåŠŸèƒ½
 * @param {string} textToTest - è¦æµ‹è¯•çš„èŠ¬å…°è¯­æ–‡æœ¬
 */
function testFinnishTTS(textToTest = 'Juon kahvia.') { // Default test text
    debugLog(`å¼€å§‹æµ‹è¯•èŠ¬å…°è¯­TTSåŠŸèƒ½: "${textToTest}"`);
    if (!('speechSynthesis' in window)) {
        debugLog('âŒ é”™è¯¯ï¼šæµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆAPI');
        return;
    }
    const utterance = new SpeechSynthesisUtterance(textToTest);
    utterance.lang = 'fi-FI';
    utterance.onstart = () => debugLog(`âœ… èŠ¬å…°è¯­æµ‹è¯• "${textToTest}" å¼€å§‹æ’­æ”¾`);
    utterance.onend = () => debugLog(`âœ… èŠ¬å…°è¯­æµ‹è¯• "${textToTest}" æ’­æ”¾å®Œæˆ`);
    utterance.onerror = (event) => debugLog(`âŒ èŠ¬å…°è¯­æµ‹è¯• "${textToTest}" é”™è¯¯: ` + event.error);
    
    window.speechSynthesis.speak(utterance);
}


/**
 * åˆ—å‡ºæ‰€æœ‰å¯ç”¨è¯­éŸ³
 */
function listVoices() {
    debugLog('æ­£åœ¨è·å–å¯ç”¨è¯­éŸ³åˆ—è¡¨...');
    const voices = window.speechSynthesis.getVoices();
    
    if (voices.length === 0) {
        debugLog('âš ï¸ æœªæ‰¾åˆ°ä»»ä½•è¯­éŸ³ï¼Œè¯­éŸ³å¯èƒ½è¿˜åœ¨åŠ è½½ä¸­ã€‚è¯·ç¨åå†è¯•æˆ–æ£€æŸ¥æµè§ˆå™¨è®¾ç½®ã€‚');
        window.speechSynthesis.onvoiceschanged = () => {
            debugLog('è¯­éŸ³åˆ—è¡¨å·²æ›´æ–°ï¼Œé‡æ–°è·å–...');
            const updatedVoices = window.speechSynthesis.getVoices();
            if (updatedVoices.length === 0) {
                 debugLog('âš ï¸ æ›´æ–°åä»æœªæ‰¾åˆ°ä»»ä½•è¯­éŸ³ã€‚');
                 return;
            }
            logVoiceList(updatedVoices);
        };
        return;
    }
    logVoiceList(voices);
}

function logVoiceList(voices) {
    debugLog(`æ‰¾åˆ° ${voices.length} ä¸ªå¯ç”¨è¯­éŸ³:`);
    voices.forEach((voice, index) => {
        const isDefault = voice.default ? ' (é»˜è®¤)' : '';
        debugLog(`${index + 1}. ${voice.name} (${voice.lang})${isDefault}`);
    });
    
    const finnishVoices = voices.filter(voice => 
        voice.lang.toLowerCase().startsWith('fi') || 
        voice.name.toLowerCase().includes('finnish') ||
        voice.name.toLowerCase().includes('suomi')
    );
    
    if (finnishVoices.length > 0) {
        debugLog(`âœ… æ‰¾åˆ° ${finnishVoices.length} ä¸ªèŠ¬å…°è¯­è¯­éŸ³:`);
        finnishVoices.forEach(voice => {
            debugLog(`  - ${voice.name} (${voice.lang})`);
        });
    } else {
        debugLog('âŒ æœªæ‰¾åˆ°èŠ¬å…°è¯­è¯­éŸ³ã€‚TTSå¯èƒ½ä½¿ç”¨é»˜è®¤è¯­è¨€æˆ–æ— æ³•æ’­æ”¾èŠ¬å…°è¯­ã€‚');
    }
}


/**
 * ç§»é™¤è°ƒè¯•åŒºåŸŸ
 */
function removeDebugSection() {
    const debugSection = document.querySelector('.debug-section');
    if (debugSection) {
        debugSection.style.display = 'none';
        debugLog('è°ƒè¯•åŒºåŸŸå·²éšè—');
    }
}

let isSpeaking = false;

function speakText(text, lang) {
    debugLog(`å°è¯•æ’­æ”¾: "${text}" (è¯­è¨€: ${lang})`);
    if (!('speechSynthesis' in window)) {
        alert('æŠ±æ­‰ï¼Œæ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆã€‚');
        debugLog('âŒ è¯­éŸ³åˆæˆAPIä¸å¯ç”¨');
        return;
    }
    if (isSpeaking) {
        window.speechSynthesis.cancel();
        debugLog('â¹ï¸ åœæ­¢ä¹‹å‰çš„æ’­æ”¾');
        setTimeout(() => startSpeaking(text, lang), 100);
    } else {
        startSpeaking(text, lang);
    }
}

function startSpeaking(text, lang) {
    isSpeaking = true;
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = lang;
    utterance.rate = 0.85; 
    utterance.volume = 1.0;
    utterance.pitch = 1.0;

    const voices = window.speechSynthesis.getVoices();
    let selectedVoice = null;
    if (lang.toLowerCase().startsWith('fi')) {
        selectedVoice = voices.find(voice => voice.lang.toLowerCase() === 'fi-fi') ||
                        voices.find(voice => voice.lang.toLowerCase().startsWith('fi')) ||
                        voices.find(voice => voice.name.toLowerCase().includes('finnish') || voice.name.toLowerCase().includes('suomi'));
    }
    
    if (selectedVoice) {
        utterance.voice = selectedVoice;
        debugLog(`ä½¿ç”¨è¯­éŸ³: ${selectedVoice.name} (${selectedVoice.lang})`);
    } else {
        debugLog(`âš ï¸ æœªæ‰¾åˆ°è¯­è¨€ ${lang} çš„ç‰¹å®šè¯­éŸ³ï¼Œä½¿ç”¨ç³»ç»Ÿé»˜è®¤è¯­éŸ³`);
    }
    
    utterance.onstart = () => debugLog(`â–¶ï¸ å¼€å§‹æ’­æ”¾: "${text}"`);
    utterance.onend = () => {
        debugLog(`âœ… æ’­æ”¾å®Œæˆ: "${text}"`);
        isSpeaking = false;
    };
    utterance.onerror = (event) => {
        debugLog(`âŒ æ’­æ”¾é”™è¯¯: ${event.error} (æ–‡æœ¬: "${text}")`);
        isSpeaking = false;
        if (event.error !== 'interrupted' && event.error !== 'canceled') {
            alert('è¯­éŸ³æ’­æ”¾å‡ºé”™: ' + event.error + '. è¯·ç¡®ä¿æ‚¨çš„æµè§ˆå™¨æ”¯æŒå¹¶å·²å¯ç”¨èŠ¬å…°è¯­TTSã€‚');
        }
    };
    window.speechSynthesis.speak(utterance);
}

function addTTSButton(element, textToSpeak, lang) {
    const headers = ['åŠ¨è¯', 'åŠŸèƒ½', 'åœºæ™¯', 'æ ¼', 'è¯­è¨€å®‡å®™çš„å±‚é¢', 'åŸå½¢', 'éƒ¨åˆ†æ ¼', 'ä¸­æ–‡', 'ä½¿ç”¨ç¤ºä¾‹', 'è¡Œä¸º', 'è¡¨è¾¾', 'ä¸­æ–‡æ˜ å°„', 'ä¸­æ–‡ â†’ èŠ¬å…°è¯­', 'è¯­è¨€ç»‘å®š', 'èŠ¬å…°è¯­å¥å­', 'èŠ¬å…°è¯­'];
    const cleanedTextToSpeak = textToSpeak.split('(')[0].trim().replace(/[â†’"âœ…]/g, '').trim(); // Remove arrows, quotes, checks

    if (!cleanedTextToSpeak || cleanedTextToSpeak === '' || headers.includes(cleanedTextToSpeak) ) {
        return; 
    }
    if (element.querySelector('.tts-button')) return;
    
    const button = document.createElement('button');
    button.className = 'tts-button';
    button.innerHTML = 'ğŸ”Š'; 
    button.title = 'æ’­æ”¾: ' + cleanedTextToSpeak;
    button.setAttribute('aria-label', 'æ’­æ”¾éŸ³é¢‘: ' + cleanedTextToSpeak);
    
    button.onclick = function(event) {
        event.preventDefault(); 
        event.stopPropagation(); 
        debugLog(`ğŸ”Š æŒ‰é’®è¢«ç‚¹å‡»: "${cleanedTextToSpeak}" (è¯­è¨€: ${lang})`);
        speakText(cleanedTextToSpeak, lang);
        return false; 
    };

    // Append button carefully
    if (element.matches('td, th')) { // If it's a table cell, a simple append should be fine.
        element.appendChild(button);
    } else if (element.childNodes.length > 0) {
        // Try to insert before any .note or existing .tts-button, or at the end of text content
        let inserted = false;
        for (let i = 0; i < element.childNodes.length; i++) {
            const child = element.childNodes[i];
            if (child.nodeType === Node.ELEMENT_NODE && (child.classList.contains('note') || child.classList.contains('tts-button'))) {
                element.insertBefore(button, child);
                inserted = true;
                break;
            }
        }
        if (!inserted) {
            element.appendChild(button);
        }
    } else {
        element.appendChild(button);
    }
}


function initializeTTSFunctionality() {
    debugLog('ğŸš€ å¼€å§‹åˆå§‹åŒ–TTSåŠŸèƒ½ (Juon Module 2.5)...');
    const finnishLang = 'fi-FI';

    if (window.speechSynthesis.getVoices().length === 0) {
        window.speechSynthesis.onvoiceschanged = () => {
            debugLog("voices changed, now attaching buttons (Juon Module 2.5)");
            attachAllTTSButtons(finnishLang);
        };
    } else {
        debugLog("voices already loaded, attaching buttons (Juon Module 2.5)");
        attachAllTTSButtons(finnishLang);
    }
}

function attachAllTTSButtons(finnishLang) {
    debugLog('ğŸ“ å¼€å§‹æ·»åŠ TTSæŒ‰é’®åˆ°å„ä¸ªéƒ¨åˆ† (Juon Module 2.5)...');

    // General .speakable-finnish class
    document.querySelectorAll('.speakable-finnish').forEach(span => {
        addTTSButton(span, span.textContent, finnishLang);
    });

    // Tables: Iterate through TDs that don't already have a .speakable-finnish or .tts-button
    // This targets the first column of most tables if it's Finnish text
    document.querySelectorAll('table tbody tr td:not(:last-child)').forEach(td => { // Avoid adding to the last column if it's "ä¸­æ–‡æ˜ å°„" or similar
        if (!td.querySelector('.speakable-finnish') && !td.querySelector('.tts-button')) {
            const text = td.textContent.trim();
            // Heuristic for Finnish: contains Ã¤, Ã¶, or common Finnish words/structures
            if (text.match(/[Ã¤Ã¶Ã¥Ã„Ã–Ã…]/) || text.includes('Juon') || text.includes('Haluan') || text.includes('Tarvitsen') || text.includes('PidÃ¤n') || text.includes('kahvia') || text.includes('vettÃ¤')) {
                if (text.length > 1 && text.length < 70 && !td.closest('thead')) {
                     addTTSButton(td, text, finnishLang);
                }
            }
        }
    });
     // Specifically target "ä½¿ç”¨ç¤ºä¾‹" column if it contains speakable Finnish
    document.querySelectorAll('#vocab-table table tbody tr td:nth-child(4)').forEach(td => {
        if (!td.querySelector('.speakable-finnish') && !td.querySelector('.tts-button')) {
            const text = td.textContent.trim();
            if (text.startsWith("Juon ")) { // If it starts with "Juon "
                addTTSButton(td, text, finnishLang);
            }
        }
    });


    // Specific lists and example paragraphs
    const selectors = [
        '#modular-generator .example p',
        '#scenario-training .example p',
        '#reality-implantation-challenge ul li',
        '#practice-list .example p',
        '#language-bleeding-task ol li',
        '#cafe-expression-toolkit table tbody tr td:first-child', // Finnish sentences in the final table
        '.final-summary ul li', // For the checklist
        '#implantation-choice .example p button .speakable-finnish' // For buttons in implantation choice
    ];

    selectors.forEach(selector => {
        document.querySelectorAll(selector).forEach(el => {
            if (!el.querySelector('.speakable-finnish') && !el.querySelector('.tts-button')) {
                let textContent = '';
                if (el.childNodes.length === 1 && el.childNodes[0].nodeType === Node.TEXT_NODE) {
                    textContent = el.childNodes[0].textContent.trim();
                } else {
                    let tempText = '';
                    el.childNodes.forEach(node => {
                        if (node.nodeType === Node.TEXT_NODE) {
                            tempText += node.textContent;
                        } else if (node.nodeType === Node.ELEMENT_NODE && !node.classList.contains('note') && !node.classList.contains('tts-button')) {
                             // If it's a button, get its text content excluding children like .speakable-finnish if any (though they are handled separately)
                            if(node.tagName === 'BUTTON') {
                                node.childNodes.forEach(childNode => {
                                    if(childNode.nodeType === Node.TEXT_NODE) tempText += childNode.textContent;
                                });
                            } else {
                                tempText += node.textContent;
                            }
                        }
                    });
                    textContent = tempText.trim().replace(/â†’.*$/, "").trim(); // Clean up arrows and trailing text
                }
                
                if (textContent.includes('Juon ') || textContent.includes('Haluan ') || textContent.includes('Tarvitsen ') || textContent.includes('PidÃ¤n ') || textContent.includes('En ') || textContent.match(/[Ã¤Ã¶Ã¥Ã„Ã–Ã…]/)) {
                    if (textContent.length > 1 && textContent.length < 200){ 
                         addTTSButton(el, textContent.split('(')[0].trim(), finnishLang);
                    }
                }
            }
        });
    });
    
    debugLog('âœ… TTSåŠŸèƒ½æŒ‰é’®æ·»åŠ å®Œæ¯• (Juon Module 2.5)ï¼');
}

function selectImplantation(phrase) {
    const cleanPhrase = phrase.replace(/"/g, ''); // Remove quotes for display
    document.getElementById('selected-phrase-juon').innerHTML = `<span class="speakable-finnish">"${cleanPhrase}"</span>`;
    // Ensure the new speakable span within the plan also gets a TTS button if it doesn't have one
    const newSpeakableSpan = document.getElementById('selected-phrase-juon').querySelector('.speakable-finnish');
    if (newSpeakableSpan && !newSpeakableSpan.querySelector('.tts-button')) {
        addTTSButton(newSpeakableSpan, cleanPhrase, 'fi-FI');
    }

    document.getElementById('implantation-plan-juon').style.display = 'block';
    document.getElementById('implantation-plan-juon').scrollIntoView({ behavior: 'smooth' });
    debugLog(`è¡Œä¸ºæ¤å…¥è®¡åˆ’å·²é€‰æ‹©: ${phrase}`);
}


document.addEventListener('DOMContentLoaded', initializeTTSFunctionality);
</script>

</body>
</html>