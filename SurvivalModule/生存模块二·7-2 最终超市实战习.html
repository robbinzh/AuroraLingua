<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>èŠ¬å…°è¯­å…¥é—¨ - è¶…å¸‚è´­ç‰©å®æˆ˜ (æ¨¡å—äºŒé™å®š) (TTS)</title>
    <style>
        body {
            font-family: "Microsoft YaHei", sans-serif;
            line-height: 1.6;
            margin: 20px auto;
            max-width: 900px;
            padding: 0 20px;
        }
        h1, h2, h3, h4 {
            color: #2c3e50; /* Dark blue-grey for headings */
        }
        table {
            width: 100%;
            border-collapse: collapse;
            overflow-x: auto; /* For responsive tables */
            display: block;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd; /* Light grey border */
            padding: 10px; /* Increased padding */
            text-align: left;
        }
        thead {
            background-color: #f4f4f4; /* Lighter grey for table header */
        }
        .tts-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2em;
            margin-left: 5px;
            padding: 0;
            display: inline-block;
            vertical-align: middle;
        }
        .tts-button:hover {
            opacity: 0.7;
        }
        .debug-section {
            background-color: #fffbf0; /* Light yellow for debug */
            border: 2px solid #ffa500; /* Orange border */
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .debug-button {
            background-color: #4CAF50; /* Green */
            color: white;
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .debug-button:hover {
            background-color: #45a049; /* Darker green */
        }
        .note {
            font-size: 0.9em;
            color: #555; /* Darker grey for notes */
            margin-left: 10px;
        }
        .final-summary ul {
            list-style-type: none; /* Remove default bullets */
            padding-left: 0;
        }
        .final-summary ul li {
            margin-bottom: 8px; /* Increased spacing */
            font-weight: bold;
        }
        .speakable-block p, .speakable-block li {
            margin-bottom: 8px; /* Increased spacing */
        }
        .task-list li {
            margin-bottom: 10px; /* Spacing for task list items */
        }
        .section-intro {
            background-color: #e7f3fe; /* Light blue background for intros */
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        hr {
            border: 0;
            height: 1px;
            background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(44, 62, 80, 0.75), rgba(0, 0, 0, 0));
            margin: 30px 0;
        }
    </style>
</head>
<body>

<h1>ğŸ”¥ æ¨¡å—äºŒÂ·ç»ˆæå®æˆ˜åœºæ™¯æ¿€æ´» ğŸ”¥</h1>

<section class="section-intro">
    <p>æˆ‘ä»¬æ­£å¼è¿›å…¥ã€æ¨¡å—äºŒã€‘çš„æœ€ç»ˆè®¤çŸ¥è·ƒè¿åœºæ™¯ï¼š</p>
    <h2>ğŸ›’ è¶…å¸‚è´­ç‰©å®æˆ˜æ¼”ç»ƒ (æ¨¡å—äºŒé™å®šè¯­æ³•ç‰ˆ)</h2>
</section>

<hr>

<section id="language-universe-intro">
    <h3>ğŸ§ ã€è¯­è¨€å®‡å®™ã€‘è®¤çŸ¥æ¤å…¥è¯´æ˜ï¼š</h3>
    <p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œä½ ä¸æ˜¯åœ¨â€œå­¦â€èŠ¬å…°è¯­ï¼Œä½ æ˜¯åœ¨<strong>ç”¨å®ƒç”Ÿå­˜</strong>ã€‚<br>
    ä½ å°†ç”¨ä»¥ä¸‹åŠ¨è¯ç³»ç»Ÿ<strong>æ„å»ºä½ çš„è´­ç‰©è¯­è¨€ç°å®</strong>ï¼š</p>
    <ul class="final-summary">
        <li><span class="speakable-finnish">Haluan</span> = æˆ‘æƒ³è¦</li>
        <li><span class="speakable-finnish">Tarvitsen</span> = æˆ‘éœ€è¦</li>
        <li><span class="speakable-finnish">PidÃ¤n</span> = æˆ‘å–œæ¬¢</li>
        <li><span class="speakable-finnish">En halua</span> = æˆ‘ä¸æƒ³è¦</li>
        <li><span class="speakable-finnish">En tarvitse</span> = æˆ‘ä¸éœ€è¦</li>
        <li><span class="speakable-finnish">En pidÃ¤</span> = æˆ‘ä¸å–œæ¬¢</li>
        <li><span class="speakable-finnish">Juon</span> = æˆ‘å–</li>
        <li><span class="speakable-finnish">SyÃ¶n</span> = æˆ‘åƒ</li>
        <li><span class="speakable-finnish">En juo</span> = æˆ‘ä¸å–</li>
        <li><span class="speakable-finnish">En syÃ¶</span> = æˆ‘ä¸åƒ</li>
    </ul>
</section>

<hr>

<section id="phase3-simulation">
    <h2>ğŸ§ªã€é˜¶æ®µ3ã€‘å®æˆ˜è®¾è®¡ï¼šè™šæ‹Ÿè¶…å¸‚æŒ‘æˆ˜ (AIæ¨¡æ‹Ÿå™¨æ“ä½œé€»è¾‘)</h2>
    <div class="speakable-block">
        <h4>ğŸ“Œ æ¨¡æ‹Ÿå™¨å¯åŠ¨æŒ‡ä»¤ï¼ˆAIåº—å‘˜è¯­éŸ³æ¿€æ´»ï¼‰ï¼š</h4>
        <p><span class="speakable-finnish">Tervetuloa. Voit valita tavarat.</span> <span class="note">(æ¬¢è¿æ¥åˆ°è¶…å¸‚ã€‚ä½ å¯ä»¥é€‰æ‹©å•†å“ã€‚)</span></p>
    </div>
</section>

<hr>

<section id="challenge1-shopping-list">
    <h3>ğŸ§±ã€è™šæ‹ŸæŒ‘æˆ˜ã€‘1ï¼šAIè´­ç‰©æ¸…å• â†’ å›¾ç‰‡é€‰æ‹©ä»»åŠ¡</h3>
    <h4>ğŸ›’ ä»»åŠ¡è¯´æ˜ï¼š</h4>
    <p>AIæ˜¾ç¤ºä¸€ä»½è´­ç‰©æ¸…å•ï¼ˆæ–‡å­—+å›¾ç‰‡ï¼‰ï¼Œä½ éœ€è¦é€‰æ‹©å¯¹åº”çš„ç‰©å“ï¼Œå¹¶ç”¨èŠ¬å…°è¯­è¯´å‡ºä½ çš„é€‰æ‹©ã€‚</p>
    <h4>ğŸ“ AIè´­ç‰©æ¸…å•ç¤ºä¾‹ï¼š</h4>
    <ul class="task-list">
        <li><span class="speakable-finnish">yksi leipÃ¤</span> <span class="note">(é¢åŒ…)</span></li>
        <li><span class="speakable-finnish">kaksi kahvipakettia</span> <span class="note">(å’–å•¡, pakettia = åŒ…/è¢‹çš„éƒ¨åˆ†æ ¼å¤æ•°)</span></li>
        <li><span class="speakable-finnish">kolme vesipulloa</span> <span class="note">(æ°´, pulloa = ç“¶çš„éƒ¨åˆ†æ ¼å¤æ•°)</span></li>
        <li><span class="speakable-finnish">vÃ¤hÃ¤n mehua</span> <span class="note">(ä¸€ç‚¹æœæ±)</span></li>
    </ul>
</section>

<hr>

<section id="implant2-checkout-dialogue">
    <h3>ğŸ§ªã€å®æˆ˜æ¤å…¥ã€‘2ï¼šç»“è´¦å¯¹è¯ï¼ˆAIåº—å‘˜åé¦ˆç³»ç»Ÿï¼‰</h3>
    <div class="speakable-block">
        <h4>ğŸ“Œ ä½ ä¼šè§åˆ°AIåº—å‘˜ï¼Œå¯¹è¯å¼€å§‹äºï¼š</h4>
        <p><span class="speakable-finnish">MitÃ¤ haluat?</span> <span class="note">(ä½ æƒ³è¦ç‚¹ä»€ä¹ˆï¼Ÿ)</span></p>
    </div>
    <p>ä½ å¿…é¡»ç”¨æ¨¡å—äºŒåŠ¨è¯ç³»ç»Ÿå›åº”ã€‚</p>
</section>

<hr>

<section id="ai-feedback-mechanism">
    <h3>ğŸ§¬ã€AIåº—å‘˜ã€‘åé¦ˆæœºåˆ¶ï¼ˆæ¨¡å—äºŒè¯­æ³•é™å®šè®¤çŸ¥ï¼‰</h3>
    <table>
        <thead>
            <tr>
                <th>å­¦ä¹ è€…è¯´</th>
                <th>AIåº—å‘˜å›åº”</th>
                <th>ä¸­æ–‡æç¤º</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><span class="speakable-finnish">Haluan kaksi leipÃ¤Ã¤.</span></td><td><span class="speakable-finnish">SelvÃ¤. Kassa on 3,50â‚¬.</span> <span class="note">(Kassa = æ”¶é“¶å°/æ€»é¢)</span></td><td>æ­£ç¡®è¡¨è¾¾ï¼šæ•°é‡+éƒ¨åˆ†æ ¼</td></tr>
            <tr><td><span class="speakable-finnish">Haluan leipÃ¤Ã¤ ja vettÃ¤.</span></td><td><span class="speakable-finnish">HyvÃ¤ valinta!</span></td><td>åˆç†è¡¨è¾¾ï¼šéƒ¨åˆ†æ ¼</td></tr>
            <tr><td><span class="speakable-finnish">Haluan vÃ¤hÃ¤n kahvia.</span></td><td><span class="speakable-finnish">TÃ¤ssÃ¤ on kahvia.</span></td><td>æ­£ç¡®ä½¿ç”¨ï¼šæ¨¡ç³Šé‡ â†’ éƒ¨åˆ†æ ¼</td></tr>
            <tr><td><span class="speakable-finnish">Tarvitsen juustoa.</span></td><td><span class="speakable-finnish">Juustoa? TÃ¤ssÃ¤ on hyvÃ¤ valinta.</span></td><td>éœ€è¦+éƒ¨åˆ†æ ¼</td></tr>
            <tr><td><span class="speakable-finnish">SyÃ¶n muroja. Juon kahvia.</span></td><td><span class="speakable-finnish">YmmÃ¤rrÃ¤n. Onko maku hyvÃ¤?</span></td><td>è¡Œä¸º+å–œå¥½è¯¢é—®</td></tr>
            <tr><td><span class="speakable-finnish">En tarvitse mehua.</span></td><td><span class="speakable-finnish">Ei mitÃ¤Ã¤n ongelmaa.</span></td><td>å¦å®šéœ€è¦</td></tr>
            <tr><td><span class="speakable-finnish">En pidÃ¤ mehusta.</span></td><td><span class="speakable-finnish">SelvÃ¤ juttu.</span> <span class="note">(TiedÃ¤nne on vanhahtava)</span></td><td>å¦å®šå–œå¥½</td></tr>
            <tr><td><span class="speakable-finnish">En syÃ¶ kalaa.</span></td><td><span class="speakable-finnish">SelvÃ¤. SiirrytÃ¤Ã¤n seuraavaan.</span></td><td>å¦å®šè¡Œä¸º</td></tr>
        </tbody>
    </table>
</section>

<hr>

<section id="error-trigger-repair">
    <h4>âŒã€é”™è¯¯è§¦å‘ã€‘AIè¯­è¨€ä¿®å¤æœºåˆ¶</h4>
    <table>
        <thead>
            <tr>
                <th>å­¦ä¹ è€…è¯´</th>
                <th>AIåº—å‘˜å›åº”</th>
                <th>ä¸­æ–‡æç¤ºå¼¹å‡ºå†…å®¹</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><span class="speakable-finnish">Haluan kaksi leipÃ¤.</span></td><td><span class="speakable-finnish">LeipÃ¤? Tarkoitatko kaksi leipÃ¤Ã¤?</span></td><td>â€œä¸¤ä¸ªé¢åŒ…â€æ˜¯ç¡®å®šé‡ â†’ åŠ â€œå‘€â€ï¼ˆleipÃ¤Ã¤ï¼‰</td></tr>
            <tr><td><span class="speakable-finnish">Haluan mehua ja kahvi.</span></td><td><span class="speakable-finnish">Kahvia? Haluatko myÃ¶s kahvia?</span> <span class="note">(kahvi -> kahvia)</span></td><td>â€œå’–å•¡â€åº”è¯¥ç”¨â€œå‘€â€ç»“å°¾ï¼ˆkahviaï¼‰</td></tr>
            <tr><td><span class="speakable-finnish">Haluan kolmea vesiÃ¤.</span></td><td><span class="speakable-finnish">VettÃ¤? Haluatko kolme pulloa vettÃ¤?</span> <span class="note">(vesiÃ¤ -> vettÃ¤)</span></td><td>â€œæ°´â€è¯´ vettÃ¤ (éƒ¨åˆ†æ ¼å•æ•°)</td></tr>
            <tr><td><span class="speakable-finnish">SyÃ¶n kala.</span></td><td><span class="speakable-finnish">SyÃ¶tkÃ¶ kalaa?</span></td><td>â€œåƒé±¼â€è¦ç”¨ kalaaï¼Œä¸æ˜¯ kala</td></tr>
            <tr><td><span class="speakable-finnish">Juon mehu.</span></td><td><span class="speakable-finnish">Mehua? Haluatko mehua?</span> <span class="note">(mehu -> mehua)</span></td><td>æœæ±æ˜¯ mehuaï¼Œä¸æ˜¯ mehu</td></tr>
        </tbody>
    </table>
</section>

<hr>

<section id="implant3-free-dialogue" class="speakable-block">
    <h2>ğŸ“¦ã€å®æˆ˜æ¤å…¥ã€‘3ï¼šè‡ªç”±å¯¹è¯ï¼ˆAIåº—å‘˜é—®ç­”ç³»ç»Ÿï¼‰</h2>
    <p>ä½ å¯ä»¥é—®ï¼š<br><span class="speakable-finnish">Paljonko tÃ¤mÃ¤ maksaa?</span> <span class="note">(è¿™æ˜¯å¤šå°‘é’±ï¼Ÿ)</span></p>
    <p>AIå›åº”ï¼š<br><span class="speakable-finnish">TÃ¤mÃ¤ maksaa 2,50 euroa.</span> <span class="note">(è¿™ä¸ªæ˜¯2.50æ¬§å…ƒã€‚)</span></p>
    <p>ä½ å¯ä»¥è¯´ï¼š<br><span class="speakable-finnish">PidÃ¤n tÃ¤stÃ¤.</span> <span class="note">(æˆ‘å–œæ¬¢è¿™ä¸ªã€‚)</span></p>
    <p>AIå›åº”ï¼š<br><span class="speakable-finnish">HyvÃ¤! Monet pitÃ¤vÃ¤t tÃ¤stÃ¤.</span> <span class="note">(å¥½é€‰æ‹©ï¼å¾ˆå¤šäººéƒ½å–œæ¬¢è¿™ä¸ªã€‚Monet = è®¸å¤šäºº)</span></p>
    <p>ä½ å¯ä»¥è¯´ï¼š<br><span class="speakable-finnish">Tarvitsen lisÃ¤Ã¤ maitoa.</span> <span class="note">(æˆ‘éœ€è¦æ›´å¤šç‰›å¥¶ã€‚)</span></p>
    <p>AIå›åº”ï¼š<br><span class="speakable-finnish">TÃ¤ssÃ¤ on maitoa.</span> <span class="note">(è¿™é‡Œæœ‰ç‰›å¥¶ã€‚)</span></p>
    <p>ä½ å¯ä»¥è¯´ï¼š<br><span class="speakable-finnish">En halua tÃ¤tÃ¤.</span> <span class="note">(æˆ‘ä¸è¦è¿™ä¸ªã€‚)</span></p>
    <p>AIå›åº”ï¼š<br><span class="speakable-finnish">YmmÃ¤rrÃ¤n. EikÃ¶ tÃ¤mÃ¤ ole hyvÃ¤?</span> <span class="note">(æˆ‘ç†è§£ã€‚è¿™ä¸ªä¸å¥½å—ï¼Ÿ EikÃ¶ ole = æ˜¯ä¸æ˜¯ä¸)</span></p>
</section>

<hr>

<section id="module2-transformer">
    <h2>ğŸ§®ã€æ¨¡å—äºŒè¯­å—å˜å½¢å™¨ã€‘ï¼šå¤æ‚è¡¨è¾¾ç»„åˆè®­ç»ƒ</h2>
    <table>
        <thead>
            <tr>
                <th>ç»„åˆå¥å‹</th>
                <th>ä¸­æ–‡æ˜ å°„</th>
                <th>åŠŸèƒ½</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><span class="speakable-finnish">Haluan yhden leivÃ¤n ja vÃ¤hÃ¤n vettÃ¤.</span></td><td>æˆ‘æƒ³è¦ä¸€ä¸ªé¢åŒ…å’Œä¸€ç‚¹æ°´ã€‚</td><td>æ•°é‡+è¯­è¨€ç»‘å®š</td></tr>
            <tr><td><span class="speakable-finnish">Juon kahvia ja syÃ¶n leipÃ¤Ã¤.</span></td><td>æˆ‘å–å’–å•¡ï¼Œåƒé¢åŒ…ã€‚</td><td>å–+åƒ åŒæ—¶è¡¨è¾¾</td></tr>
            <tr><td><span class="speakable-finnish">En halua mehua. Tarvitsen kahvia.</span></td><td>æˆ‘ä¸è¦æœæ±ã€‚æˆ‘éœ€è¦å’–å•¡ã€‚</td><td>è¯­è¨€å†³ç­–</td></tr>
            <tr><td><span class="speakable-finnish">PidÃ¤n tÃ¤stÃ¤ mehusta. Haluan kolme pulloa mehua.</span> <span class="note">(tai kolme mehua)</span></td><td>æˆ‘å–œæ¬¢è¿™æœæ±ã€‚æˆ‘æƒ³è¦ä¸‰ç“¶æœæ±ã€‚</td><td>å–œå¥½+æ„æ„¿</td></tr>
            <tr><td><span class="speakable-finnish">En syÃ¶ kalaa. Juon kahvia.</span></td><td>æˆ‘ä¸åƒé±¼ã€‚æˆ‘å–å’–å•¡ã€‚</td><td>åƒ+å– å¦å®šè¡¨è¾¾</td></tr>
            <tr><td><span class="speakable-finnish">Paljonko tÃ¤mÃ¤ maksaa?</span> <span class="note">(Montako? kysyy lukumÃ¤Ã¤rÃ¤Ã¤)</span></td><td>è¿™å¤šå°‘é’±ï¼Ÿ</td><td>ä»·æ ¼ç¡®è®¤</td></tr>
            <tr><td><span class="speakable-finnish">Paljonko vettÃ¤?</span></td><td>å¤šå°‘æ°´ï¼Ÿ<span class="note">(tai: Kuinka paljon vettÃ¤?)</span></td><td>é€‰æ‹©æ—¶è¯¢é—®</td></tr>
            <tr><td><span class="speakable-finnish">Onko tÃ¤mÃ¤ kahvia?</span></td><td>è¿™æ˜¯å’–å•¡å—ï¼Ÿ</td><td>è¯­å—ç¡®è®¤</td></tr>
            <tr><td><span class="speakable-finnish">Haluan tÃ¤mÃ¤n. TÃ¤mÃ¤ on hyvÃ¤Ã¤.</span></td><td>æˆ‘æƒ³è¦è¿™ä¸ªã€‚è¿™ä¸ªå¥½ã€‚</td><td>å®ç‰©ç»‘å®š</td></tr>
        </tbody>
    </table>
</section>

<hr>

<section id="language-bleeding-task-supermarket" class="speakable-block">
    <h2>ğŸ§ªã€è¯­è¨€å‡ºè¡€ä»»åŠ¡ã€‘ï¼šä»Šæ—¥æ¤å…¥å®éªŒï¼ˆè¶…å¸‚å®æˆ˜ï¼‰</h2>
    <h3>ğŸ›’ è¯­è¨€å‡ºè¡€ä¸‰æ­¥è®­ç»ƒæ³•ï¼š</h3>
    <ol class="task-list">
        <li><strong><span class="speakable-finnish">ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©å•†å“æ—¶è‡ªè¨€è‡ªè¯­</span></strong>
            <ul>
                <li><span class="speakable-finnish">çœ‹åˆ°ç‰›å¥¶ â†’ è¯´ï¼š"Tarvitsen maitoa."</span></li>
                <li><span class="speakable-finnish">çœ‹åˆ°é¢åŒ… â†’ è¯´ï¼š"SyÃ¶n leipÃ¤Ã¤."</span></li>
                <li><span class="speakable-finnish">çœ‹åˆ°å’–å•¡ â†’ è¯´ï¼š"Juon kahvia."</span></li>
            </ul>
        </li>
        <li><strong><span class="speakable-finnish">ç¬¬äºŒæ­¥ï¼šç»“è´¦å¯¹è¯ï¼ˆAIåº—å‘˜æ¿€æ´»ï¼‰</span></strong>
            <ul>
                <li><span class="speakable-finnish">åº—å‘˜é—®ï¼š"MitÃ¤ haluat?"</span><br>
                <span class="speakable-finnish">ä½ å›ç­”ï¼š"Juon kahvia. SyÃ¶n leipÃ¤Ã¤. Haluan kolme maitoa."</span> <span class="note">(maitoa on maidon partitiivi)</span></li>
                <li><span class="speakable-finnish">åº—å‘˜é—®ï¼š"Montako?"</span><br>
                <span class="speakable-finnish">ä½ å›ç­”ï¼š"Yhden." æˆ– "VÃ¤hÃ¤n."</span></li>
            </ul>
        </li>
        <li><strong><span class="speakable-finnish">ç¬¬ä¸‰æ­¥ï¼šé”™è¯¯è§¦å‘ â†’ è‡ªæˆ‘ä¿®æ­£</span></strong>
            <ul>
                <li><span class="speakable-finnish">è¯´é”™ï¼š"Haluan kaksi leipÃ¤."</span><br>
                <span class="speakable-finnish">åº—å‘˜çº æ­£ï¼š"LeipÃ¤? Tarkoitatko kaksi leipÃ¤Ã¤?"</span><br>
                <span class="speakable-finnish">â†’ ä½ å›åº”ï¼š"KyllÃ¤. Haluan kaksi leipÃ¤Ã¤."</span></li>
            </ul>
        </li>
    </ol>
</section>

<hr>

<section id="chinese-speaker-cognition">
    <h3>ğŸ§ ã€ä¸­æ–‡æ¯è¯­è€…è®¤çŸ¥æ¤å…¥æœºåˆ¶ã€‘æ³¨è§£</h3>
    <p>åœ¨ä¸­æ–‡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¯´ï¼š</p>
    <ul>
        <li>æˆ‘è¦ä¸¤ä¸ªé¢åŒ…</li>
        <li>æˆ‘è¦ä¸€ç‚¹æ°´</li>
        <li>æˆ‘è¦ä¸€æ¯å’–å•¡</li>
    </ul>
    <p>ä½†åœ¨èŠ¬å…°è¯­ä¸­ï¼š</p>
    <ul>
        <li><strong>â€œéƒ¨åˆ†æ ¼æ˜¯ä½ çš„è¯­è¨€è§¦è§’â€</strong>ï¼šå½“ä½ è¯´â€œ<span class="speakable-finnish">leipÃ¤Ã¤</span>â€æ—¶ï¼Œä¸æ˜¯â€œé¢åŒ…çš„æ ¼â€ï¼Œè€Œæ˜¯â€œ<strong>ä½ ç°åœ¨æ­£åœ¨ç”¨è¯­è¨€è½»è½»æ¥è§¦è¿™ä¸ªé¢åŒ…</strong>â€ã€‚</li>
        <li><strong>â€œç¡®å®šæ•°é‡å¯èƒ½éœ€è¦å®¾æ ¼/æ‰€æœ‰æ ¼â€</strong>ï¼šå½“ä½ è¯´â€œ<span class="speakable-finnish">yhden leivÃ¤n</span>â€(ä¸€ä¸ªé¢åŒ…-å®¾æ ¼)æ—¶ï¼Œä½ æ˜¯åœ¨â€œ<strong>ç¡®è®¤è¿™ä¸ªå­˜åœ¨</strong>â€ï¼Œä¸æ˜¯â€œåƒå®ƒâ€ï¼Œä¸æ˜¯â€œå–å®ƒâ€ï¼Œä¸æ˜¯â€œå–œæ¬¢å®ƒâ€â€”â€”ä½ æ˜¯åœ¨â€œ<strong>ç¡®å®šå®ƒçš„å®ä½“</strong>â€ã€‚
        <span class="note">(TÃ¤mÃ¤ on monimutkaisempaa, mutta tÃ¤ssÃ¤ vaiheessa yksinkertaistus on ok.)</span></li>
    </ul>
    <p>è¿™æ­£æ˜¯æˆ‘ä»¬ä¸æè¯­æ³•æœ¯è¯­ï¼Œè€Œæ˜¯ç”¨<strong>è¯­è¨€å®‡å®™çš„æ„ŸçŸ¥æ–¹å¼</strong>æ¥å¼•å¯¼ä½ çš„å¤§è„‘è®¤çŸ¥ã€‚</p>
</section>

<!-- TTSè°ƒè¯•åŒºåŸŸçš„JavaScriptä¿æŒä¸å˜ -->
<script>
/**
 * è°ƒè¯•è¾“å‡ºå‡½æ•°
 * @param {string} message - è¦æ˜¾ç¤ºçš„æ¶ˆæ¯
 */
function debugLog(message) {
    const output = document.getElementById('debug-output');
    if (output && output.innerHTML !== undefined) { // Check if output is valid and has innerHTML
        const time = new Date().toLocaleTimeString();
        output.innerHTML += `[${time}] ${message}<br>`;
        output.scrollTop = output.scrollHeight;
    } else if (output === null) {
      // console.warn("Debug output element not found early in script. This is okay if it's defined later in HTML.");
    }
    // Always log to console
    // console.log(`[TTS DEBUG] ${message}`);
}


function testBasicTTS() {
    debugLog('å¼€å§‹æµ‹è¯•åŸºæœ¬TTSåŠŸèƒ½...');
    if (!('speechSynthesis' in window)) {
        debugLog('âŒ é”™è¯¯ï¼šæµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆAPI');
        alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½ï¼Œè¯·å°è¯•ä½¿ç”¨Chromeã€Edgeæˆ–Firefoxçš„æœ€æ–°ç‰ˆæœ¬ã€‚');
        return;
    }
    debugLog('âœ… æµè§ˆå™¨æ”¯æŒè¯­éŸ³åˆæˆAPI');
    const utterance = new SpeechSynthesisUtterance('Hello World');
    utterance.onstart = () => debugLog('âœ… è‹±è¯­æµ‹è¯•å¼€å§‹æ’­æ”¾');
    utterance.onend = () => debugLog('âœ… è‹±è¯­æµ‹è¯•æ’­æ”¾å®Œæˆ');
    utterance.onerror = (event) => debugLog('âŒ è‹±è¯­æµ‹è¯•é”™è¯¯: ' + event.error);
    window.speechSynthesis.speak(utterance);
}

function testFinnishTTS() {
    debugLog('å¼€å§‹æµ‹è¯•èŠ¬å…°è¯­TTSåŠŸèƒ½...');
    const utterance = new SpeechSynthesisUtterance('Tervetuloa. Voit valita tavarat.'); // Example from this module
    utterance.lang = 'fi-FI';
    utterance.onstart = () => debugLog('âœ… èŠ¬å…°è¯­æµ‹è¯•å¼€å§‹æ’­æ”¾');
    utterance.onend = () => debugLog('âœ… èŠ¬å…°è¯­æµ‹è¯•æ’­æ”¾å®Œæˆ');
    utterance.onerror = (event) => debugLog('âŒ èŠ¬å…°è¯­æµ‹è¯•é”™è¯¯: ' + event.error);
    window.speechSynthesis.speak(utterance);
}

function listVoices() {
    debugLog('æ­£åœ¨è·å–å¯ç”¨è¯­éŸ³åˆ—è¡¨...');
    const voices = window.speechSynthesis.getVoices();
    if (voices.length === 0) {
        debugLog('âš ï¸ æœªæ‰¾åˆ°ä»»ä½•è¯­éŸ³ï¼Œè¯­éŸ³å¯èƒ½è¿˜åœ¨åŠ è½½ä¸­ã€‚è¯·ç¨åå†è¯•æˆ–æ£€æŸ¥æµè§ˆå™¨è®¾ç½®ã€‚');
        window.speechSynthesis.onvoiceschanged = () => {
            debugLog('è¯­éŸ³åˆ—è¡¨å·²æ›´æ–°ï¼Œé‡æ–°è·å–...');
            const updatedVoices = window.speechSynthesis.getVoices();
            if (updatedVoices.length === 0) {
                 debugLog('âš ï¸ æ›´æ–°åä»æœªæ‰¾åˆ°ä»»ä½•è¯­éŸ³ã€‚');
                 return;
            }
            logVoiceList(updatedVoices);
        };
        return;
    }
    logVoiceList(voices);
}

function logVoiceList(voices) {
    debugLog(`æ‰¾åˆ° ${voices.length} ä¸ªå¯ç”¨è¯­éŸ³:`);
    voices.forEach((voice, index) => {
        const isDefault = voice.default ? ' (é»˜è®¤)' : '';
        debugLog(`${index + 1}. ${voice.name} (${voice.lang})${isDefault}`);
    });
    const finnishVoices = voices.filter(voice => 
        voice.lang.toLowerCase().startsWith('fi') || 
        voice.name.toLowerCase().includes('finnish') ||
        voice.name.toLowerCase().includes('suomi')
    );
    if (finnishVoices.length > 0) {
        debugLog(`âœ… æ‰¾åˆ° ${finnishVoices.length} ä¸ªèŠ¬å…°è¯­è¯­éŸ³:`);
        finnishVoices.forEach(voice => {
            debugLog(`  - ${voice.name} (${voice.lang})`);
        });
    } else {
        debugLog('âŒ æœªæ‰¾åˆ°èŠ¬å…°è¯­è¯­éŸ³ã€‚TTSå¯èƒ½ä½¿ç”¨é»˜è®¤è¯­è¨€æˆ–æ— æ³•æ’­æ”¾èŠ¬å…°è¯­ã€‚');
    }
}

function removeDebugSection() {
    const debugSection = document.querySelector('.debug-section');
    if (debugSection) {
        debugSection.style.display = 'none';
        debugLog('è°ƒè¯•åŒºåŸŸå·²éšè—');
    }
}

let isSpeaking = false;

function speakText(text, lang) {
   // debugLog(`å°è¯•æ’­æ”¾: "${text}" (è¯­è¨€: ${lang})`);
    if (!('speechSynthesis' in window)) {
        alert('æŠ±æ­‰ï¼Œæ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆã€‚');
        debugLog('âŒ è¯­éŸ³åˆæˆAPIä¸å¯ç”¨');
        return;
    }
    if (isSpeaking) {
        window.speechSynthesis.cancel();
      //  debugLog('â¹ï¸ åœæ­¢ä¹‹å‰çš„æ’­æ”¾');
        setTimeout(() => startSpeaking(text, lang), 50); // Shorter delay
    } else {
        startSpeaking(text, lang);
    }
}

function startSpeaking(text, lang) {
    isSpeaking = true;
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = lang;
    utterance.rate = 0.85; 
    utterance.volume = 1.0;
    utterance.pitch = 1.0;

    const voices = window.speechSynthesis.getVoices();
    let selectedVoice = null;
    if (lang.toLowerCase().startsWith('fi')) {
        selectedVoice = voices.find(voice => voice.lang.toLowerCase() === 'fi-fi') ||
                        voices.find(voice => voice.lang.toLowerCase().startsWith('fi')) ||
                        voices.find(voice => voice.name.toLowerCase().includes('finnish') || voice.name.toLowerCase().includes('suomi'));
    }
    
    if (selectedVoice) {
        utterance.voice = selectedVoice;
      //  debugLog(`ä½¿ç”¨è¯­éŸ³: ${selectedVoice.name} (${selectedVoice.lang})`);
    } else {
        debugLog(`âš ï¸ æœªæ‰¾åˆ°è¯­è¨€ ${lang} çš„ç‰¹å®šè¯­éŸ³ï¼Œä½¿ç”¨ç³»ç»Ÿé»˜è®¤è¯­éŸ³`);
    }
    
    // utterance.onstart = () => debugLog(`â–¶ï¸ å¼€å§‹æ’­æ”¾: "${text}"`);
    utterance.onend = () => {
      //  debugLog(`âœ… æ’­æ”¾å®Œæˆ: "${text}"`);
        isSpeaking = false;
    };
    utterance.onerror = (event) => {
        debugLog(`âŒ æ’­æ”¾é”™è¯¯: ${event.error} (æ–‡æœ¬: "${text}")`);
        isSpeaking = false;
        if (event.error !== 'interrupted' && event.error !== 'canceled') {
            alert('è¯­éŸ³æ’­æ”¾å‡ºé”™: ' + event.error + '. è¯·ç¡®ä¿æ‚¨çš„æµè§ˆå™¨æ”¯æŒå¹¶å·²å¯ç”¨èŠ¬å…°è¯­TTSã€‚');
        }
    };
    window.speechSynthesis.speak(utterance);
}

function addTTSButton(element, textToSpeak, lang) {
    const headers = ['åŠ¨è¯', 'åŠŸèƒ½', 'ç»“æ„ (æ ¼)', 'ç¤ºä¾‹', 'èŠ¬å…°è¯­', 'ä¸­æ–‡ç¿»è¯‘', 'æ¨¡å—äºŒè¯­å—', 'ä¸­æ–‡æ˜ å°„', 'è¡¨è¾¾', 'ä½¿ç”¨é¢‘ç‡', 'å­¦ä¹ è€…è¯´', 'AIåº—å‘˜å›åº”', 'ä¸­æ–‡æç¤º', 'ç»„åˆå¥å‹', 'AIè´­ç‰©æ¸…å•ç¤ºä¾‹ï¼š', 'ä»»åŠ¡è¯´æ˜ï¼š', 'AIåº—å‘˜è¯­éŸ³æ¿€æ´»ï¼‰ï¼š'];
    let cleanedTextToSpeak = textToSpeak;

    // Remove Chinese explanations like (é¢åŒ…) or (ä¿šè¯­ï¼Œç‰¹æŒ‡0.5L) for TTS
    cleanedTextToSpeak = cleanedTextToSpeak.replace(/\s*ï¼ˆ[^ï¼‰]*ï¼‰\s*/g, '').trim();
    cleanedTextToSpeak = cleanedTextToSpeak.replace(/\s*\([^\)]*\)\s*/g, '').trim();


    if (!cleanedTextToSpeak || cleanedTextToSpeak === '' || headers.includes(cleanedTextToSpeak) || headers.some(h => cleanedTextToSpeak.startsWith(h))) {
        return; 
    }
    if (element.querySelector('.tts-button')) { // Check if button is already direct child
        const directChildButton = Array.from(element.childNodes).find(node => node.nodeType === 1 && node.classList.contains('tts-button'));
        if (directChildButton) return;
    }
    
    const button = document.createElement('button');
    button.className = 'tts-button';
    button.innerHTML = 'ğŸ”Š'; 
    button.title = 'æ’­æ”¾: ' + cleanedTextToSpeak;
    button.setAttribute('aria-label', 'æ’­æ”¾éŸ³é¢‘: ' + cleanedTextToSpeak);
    
    button.onclick = function(event) {
        event.preventDefault(); 
        event.stopPropagation(); 
      //  debugLog(`ğŸ”Š æŒ‰é’®è¢«ç‚¹å‡»: "${cleanedTextToSpeak}" (è¯­è¨€: ${lang})`);
        speakText(cleanedTextToSpeak, lang);
        return false; 
    };
    
    // Append button logic:
    // If element is a span.speakable-finnish, append to it.
    // If element is a block (p, li, td), append at the end of its content, before any .note span.
    if (element.classList.contains('speakable-finnish')) {
        element.appendChild(button);
    } else {
        const noteSpan = element.querySelector('.note');
        if (noteSpan) {
            element.insertBefore(button, noteSpan);
        } else {
            element.appendChild(button);
        }
    }
}


function initializeTTSFunctionality() {
    debugLog('ğŸš€ å¼€å§‹åˆå§‹åŒ–TTSåŠŸèƒ½ (è¶…å¸‚è´­ç‰©å®æˆ˜)...');
    const finnishLang = 'fi-FI';

    if (window.speechSynthesis.getVoices().length === 0) {
        window.speechSynthesis.onvoiceschanged = () => {
            debugLog("voices changed, now attaching buttons (è¶…å¸‚è´­ç‰©å®æˆ˜)");
            attachAllTTSButtons(finnishLang);
        };
    } else {
        debugLog("voices already loaded, attaching buttons (è¶…å¸‚è´­ç‰©å®æˆ˜)");
        attachAllTTSButtons(finnishLang);
    }
}

function attachAllTTSButtons(finnishLang) {
    debugLog('ğŸ“ å¼€å§‹æ·»åŠ TTSæŒ‰é’®åˆ°å„ä¸ªéƒ¨åˆ† (è¶…å¸‚è´­ç‰©å®æˆ˜)...');

    // 1. Speakable Finnish Spans - Highest Priority
    document.querySelectorAll('span.speakable-finnish').forEach(span => {
        // Ensure text content is not just a placeholder or already handled
        const text = span.textContent.trim();
        if (text.length > 0 && !span.querySelector('.tts-button')) {
            addTTSButton(span, text, finnishLang);
        }
    });

    // 2. Table Cells (TDs) - specifically targeting Finnish content
    // Prioritize first TD in rows of specific tables if they contain sentences.
    const mainContentTables = ['ai-feedback-mechanism', 'error-trigger-repair', 'module2-transformer'];
    mainContentTables.forEach(tableId => {
        const table = document.getElementById(tableId);
        if (table) {
            table.querySelectorAll('tbody tr').forEach(row => {
                if (row.cells[0]) {
                    const firstTd = row.cells[0];
                    const speakableInTd = firstTd.querySelector('span.speakable-finnish');
                    if (!speakableInTd && !firstTd.querySelector('.tts-button')) { // If no span and no button yet
                        const text = firstTd.textContent.trim();
                        if (text.length > 1 && (text.match(/[Ã¤Ã¶Ã¥Ã„Ã–Ã…]/) || text.includes('.') || text.includes('!'))) {
                           addTTSButton(firstTd, text, finnishLang);
                        }
                    }
                }
            });
        }
    });
    
    // 3. Block elements (p, li) within designated speakable blocks
    const blockSelectors = [
        '#language-universe-intro ul li', // For the list of verbs
        '#phase3-simulation .speakable-block p',
        '#challenge1-shopping-list ul li',
        '#implant2-checkout-dialogue .speakable-block p',
        '#implant3-free-dialogue .speakable-block p',
        '#language-bleeding-task-supermarket ol.task-list > li', // Top level LIs
        '#language-bleeding-task-supermarket ol.task-list ul li', // Nested LIs
        '#chinese-speaker-cognition ul li', // For the "éƒ¨åˆ†æ ¼æ˜¯ä½ çš„è¯­è¨€è§¦è§’" part
        '#chinese-speaker-cognition p'
    ];

    blockSelectors.forEach(selector => {
        document.querySelectorAll(selector).forEach(el => {
            const speakableInEl = el.querySelector('span.speakable-finnish');
             // Only add button to el if no speakable-finnish child, or if speakable-finnish child doesn't cover whole text
            if (!el.querySelector('.tts-button')) { // Check if el itself or a direct child span already has a button
                let textContent = '';
                // Construct text from direct child text nodes and non-button, non-note, non-speakable-span elements
                Array.from(el.childNodes).forEach(node => {
                    if (node.nodeType === Node.TEXT_NODE) {
                        textContent += node.textContent;
                    } else if (node.nodeType === Node.ELEMENT_NODE &&
                               !node.classList.contains('note') &&
                               !node.classList.contains('tts-button') &&
                               !node.classList.contains('speakable-finnish')) {
                        // This might be too greedy if there are other structural elements
                        // For simple P and LI, it's often just text and .note or .speakable-finnish
                        // If we want to speak the whole block if no specific span:
                         // textContent += node.textContent; 
                    }
                });
                textContent = textContent.trim();
                
                // If we constructed text, and it's likely Finnish, add button to 'el'
                if (textContent.length > 1 && (textContent.match(/[Ã¤Ã¶Ã¥Ã„Ã–Ã…]/) || textContent.includes('.') || textContent.includes('!'))) {
                    addTTSButton(el, textContent, finnishLang);
                } else if (speakableInEl && speakableInEl.textContent.trim() !== el.textContent.replace(/<[^>]+>/g, '').trim()) {
                    // Case: speakable-finnish is present but doesn't cover all text, and we want to speak the whole block
                    // This logic might be too complex; simpler to ensure .speakable-finnish covers exactly what to speak.
                    // For now, we prioritize the .speakable-finnish span.
                }
            }
        });
    });


    debugLog('âœ… TTSåŠŸèƒ½æŒ‰é’®æ·»åŠ å®Œæ¯• (è¶…å¸‚è´­ç‰©å®æˆ˜)ï¼');
}


document.addEventListener('DOMContentLoaded', () => {
    // Ensure debug output element exists if scripts run very early
    if (!document.getElementById('debug-output')) {
        const body = document.querySelector('body');
        const debugDiv = document.createElement('div');
        debugDiv.id = 'debug-output';
        debugDiv.style.cssText = "margin-top: 10px; padding: 10px; background-color: #f0f0f0; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; display:none;"; // Initially hidden
        const firstDebugSection = document.querySelector('.debug-section');
        if (firstDebugSection) {
            firstDebugSection.appendChild(debugDiv);
        } else if (body) {
            // As a last resort, append to body if no .debug-section is found (should not happen with your HTML structure)
            // body.insertBefore(debugDiv, body.firstChild);
        }
    }

    if (window.speechSynthesis.getVoices().length === 0) {
        window.speechSynthesis.onvoiceschanged = initializeTTSFunctionality;
    } else {
        initializeTTSFunctionality();
    }
});

</script>
</body>
</html>