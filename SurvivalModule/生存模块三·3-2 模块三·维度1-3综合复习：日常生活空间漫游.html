<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>èŠ¬å…°è¯­æ¨¡å—ä¸‰Â·ç»¼åˆå¤ä¹ ï¼šæ—¥å¸¸ç”Ÿæ´»ç©ºé—´æ¼«æ¸¸ (TTS)</title>
    <style>
        body { font-family: "Microsoft YaHei", sans-serif; line-height: 1.7; margin: 20px auto; max-width: 900px; padding: 0 20px; color: #333; background-color: #f9f9f9; }
        h1, h2, h3, h4, h5 { color: #2c3e50; }
        h1 { text-align: center; margin-bottom: 35px; font-size: 2.2em; }
        h2 { border-bottom: 2px solid #27ae60; padding-bottom: 12px; margin-top: 45px; font-size: 1.8em; color: #27ae60; } /* Review section color */
        h3 { margin-top: 30px; font-size: 1.5em; color: #2ecc71; }
        h4 { font-size: 1.3em; color: #e67e22; margin-top:25px; margin-bottom:15px; }
        h5 { font-size: 1.1em; color: #34495e; margin-top:20px; margin-bottom:10px;}

        table { width: 100%; border-collapse: collapse; margin-bottom: 25px; display: block; overflow-x: auto; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; vertical-align: top;}
        thead { background-color: #e9ecef; }
        
        .review-section-card, .scene-card, .practice-plan-card, .summary-card, .example {
            background-color: #fff; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 30px; box-shadow: 0 4px 10px rgba(0,0,0,0.08);
        }
        .example, .scene-card { border-left: 6px solid #27ae60 !important; } /* Review section card color */
        
        .scene-card h4 { color: #8e44ad; margin-top: 0; font-size: 1.4em; border-bottom: 1px dashed #bdc3c7; padding-bottom: 10px; margin-bottom: 20px; }
        .dialogue-step { margin-bottom: 15px; padding-left: 20px; border-left: 3px solid #f1c40f; }
        .dialogue-step img { max-width: 150px; height: auto; border-radius: 4px; float: right; margin-left: 15px; margin-bottom:10px; }
        .dialogue-step p { margin: 8px 0; font-size: 1.1em; clear: right; /* Ensure text flows below floated image */}
        
        .finnish-phrase { font-weight: bold; color: #27ae60; font-size: 1.1em; } /* Review phrase color */
        .example-sentence .finnish-phrase { font-size: 1.05em; }
        .chinese-sense, .note { font-size: 0.95em; color: #555; font-style: italic; }
        .tts-button { background: none; border: none; cursor: pointer; font-size: 1.2em; margin-left: 8px; padding: 0; display: inline-block; vertical-align: middle; color: #27ae60; } /* Review TTS color */
        .tts-button:hover { color: #229954; opacity: 0.8; }
        
        .debug-section { background-color: #fffbf0; border: 2px solid #ffa500; padding: 15px; margin: 20px 0; border-radius: 8px; }
        .debug-button { background-color: #4CAF50; color: white; padding: 8px 16px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .debug-button:hover { background-color: #45a049; }
        .highlight { color: #c0392b; font-weight: bold; }
        hr { border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0,0,0,0), rgba(39,174,96,0.4), rgba(0,0,0,0)); margin: 40px 0; } /* Review hr color */
        
        .task-list { list-style-type: none; padding-left: 0; }
        .task-list > li { margin-bottom: 15px; }
        .task-list h5 { margin-top:0; color: #2c3e50; font-size: 1.15em; }
        .task-list ul { list-style-type: disc; padding-left: 25px; margin-top: 5px; }
        .task-list ul li { font-size: 1em; margin-bottom: 8px; }
        
        .final-summary-list { list-style-type: none; padding-left:0; }
        .final-summary-list li { margin-bottom: 10px; font-size: 1.1em;}
        .final-summary-list .finnish-phrase { font-weight: normal;}

        .interactive-question { margin-top: 15px; padding: 10px; background-color: #ecf0f1; border-radius: 5px;}
        .interactive-question p { margin-bottom: 8px; }
        .interactive-question button { background-color: #3498db; color:white; border:none; padding: 8px 12px; margin: 3px; border-radius: 4px; cursor:pointer; }
        .interactive-question button:hover { background-color: #2980b9;}
        .feedback { margin-top: 5px; font-weight: bold; }
        .correct { color: green; }
        .incorrect { color: red; }

    </style>
</head>
<body>

    <h1>ğŸ› ï¸ æ¨¡å—ä¸‰Â·ç»´åº¦1-3ç»¼åˆå¤ä¹ ï¼šæ—¥å¸¸ç”Ÿæ´»ç©ºé—´æ¼«æ¸¸</h1>

    <!-- TTSè°ƒè¯•åŒºåŸŸ -->
    <div class="debug-section">
        <h3>ğŸ”§ TTSåŠŸèƒ½æµ‹è¯• (æ¨¡å—ä¸‰ ç»¼åˆå¤ä¹ )</h3>
        <p>å¦‚æœTTSæŒ‰é’®æ²¡æœ‰å£°éŸ³ï¼Œè¯·å…ˆæµ‹è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
        <button class="debug-button" onclick="testBasicTTS()">æµ‹è¯•åŸºæœ¬TTS</button>
        <button class="debug-button" onclick="testFinnishTTSModule3_Review()">æµ‹è¯•èŠ¬å…°è¯­TTS (æ¨¡å—3å¤ä¹ )</button>
        <button class="debug-button" onclick="listVoices()">æŸ¥çœ‹å¯ç”¨è¯­éŸ³</button>
        <button class="debug-button" onclick="removeDebugSection()">ç§»é™¤è°ƒè¯•åŒºåŸŸ</button>
        <div id="debug-output" style="margin-top: 10px; padding: 10px; background-color: #f0f0f0; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;"></div>
    </div>

    <hr>

    <section id="review-intro" class="review-section-card">
        <h2>ğŸš€ å‡çº§ä½ çš„èŠ¬å…°è¯­å·¥å…·ç®±ï¼šç©ºé—´ä¸éœ€æ±‚çš„å®Œç¾ç»“åˆï¼</h2>
        <p><span class="speakable-finnish">Onneksi olkoon! Olet selvinnyt kolmesta avaruusulottuvuudesta!</span> (æ­å–œï¼ä½ å·²ç»æˆåŠŸæ¢ç´¢äº†ä¸‰ä¸ªç©ºé—´ç»´åº¦ï¼)</p>
        <p>ç°åœ¨ï¼Œä½ ä¸ä»…çŸ¥é“æ€ä¹ˆè¯´â€œåœ¨æˆ¿å­<span class="highlight">é‡Œ</span>â€(<span class="finnish-phrase speakable-finnish">talossa</span>)ã€â€œåœ¨æ¡Œå­<span class="highlight">ä¸Š</span>â€(<span class="finnish-phrase speakable-finnish">pÃ¶ydÃ¤llÃ¤</span>)ï¼Œè¿˜èƒ½è¯´â€œä¹¦åœ¨æˆ‘<span class="highlight">å‰é¢</span>â€(<span class="finnish-phrase speakable-finnish">kirja on minun edessÃ¤</span>)äº†ã€‚åŒæ—¶ï¼Œåœ¨æ¨¡å—äºŒï¼Œä½ ä¹ŸæŒæ¡äº†å¦‚ä½•è¡¨è¾¾â€œæˆ‘æƒ³è¦â€(<span class="speakable-finnish">Haluan</span>)ã€â€œæˆ‘éœ€è¦â€(<span class="speakable-finnish">Tarvitsen</span>)ã€â€œæˆ‘å–œæ¬¢â€(<span class="speakable-finnish">PidÃ¤n</span>)ã€â€œæˆ‘åƒ/å–â€(<span class="speakable-finnish">SyÃ¶n/Juon</span>)è¿™äº›æ ¸å¿ƒéœ€æ±‚å’Œè¡Œä¸ºã€‚</p>
        <p>æ˜¯æ—¶å€™æŠŠè¿™äº›å·¥å…·éƒ½æ‹¿å‡ºæ¥ï¼Œçœ‹çœ‹å®ƒä»¬åœ¨æˆ‘ä»¬çš„æ—¥å¸¸ç”Ÿæ´»ä¸­æ˜¯å¦‚ä½•ä¸€èµ·å·¥ä½œçš„äº†ï¼å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹ä¸€æ®µèŠ¬å…°è¯­çš„â€œæ—¥å¸¸ç”Ÿæ´»ç©ºé—´æ¼«æ¸¸â€å§ï¼</p>
    </section>

    <hr>

    <section id="scenario1-kitchen-morning">
        <h2>åœºæ™¯ä¸€ï¼šæ¸©é¦¨çš„å¨æˆ¿æ—©æ™¨æ—¶å…‰ ğŸ³â˜•</h2>
        <div class="scene-card">
            <h4><span class="speakable-finnish">Aamu keittiÃ¶ssÃ¤</span> (å¨æˆ¿çš„æ—©æ™¨)</h4>
            <p class="note">åœºæ™¯æè¿°ï¼šè¿™æ˜¯æ˜ŸæœŸå…­çš„æ—©ä¸Šï¼Œä½ ï¼ˆ<span class="speakable-finnish">MinÃ¤</span>ï¼‰åœ¨å¨æˆ¿é‡Œå‡†å¤‡æ—©é¤ï¼Œä½ çš„æœ‹å‹ï¼ˆ<span class="speakable-finnish">SinÃ¤</span>ï¼‰ä¹Ÿåˆšèµ·åºŠã€‚</p>

            <div class="dialogue-step">
                <img src="https://images.pexels.com/photos/6999006/pexels-photo-6999006.jpeg?auto=compress&cs=tinysrgb&w=300" alt="æ‰“å¼€å†°ç®±">
                <h5>1. ä½  (MinÃ¤) æ‰“å¼€å†°ç®±ï¼š</h5>
                <p><span class="speakable-finnish">MinÃ¤ tarvitsen maitoa. MissÃ¤ maito on?</span> <span class="note">(æˆ‘éœ€è¦ç‰›å¥¶ã€‚ç‰›å¥¶åœ¨å“ªé‡Œï¼Ÿ)</span></p>
                <p><span class="speakable-finnish">Ah, maito on <span class="finnish-phrase">jÃ¤Ã¤kaapissa</span>, minun <span class="finnish-phrase">edessÃ¤</span>ni. MinÃ¤ otan maidon <span class="finnish-phrase">jÃ¤Ã¤kaapista</span>.</span> <span class="note">(å•Šï¼Œç‰›å¥¶åœ¨å†°ç®±<span class="highlight">é‡Œ</span>ï¼Œåœ¨æˆ‘<span class="highlight">å‰é¢</span>ã€‚æˆ‘ä»å†°ç®±<span class="highlight">é‡Œ</span>æ‹¿å‡ºç‰›å¥¶ã€‚)</span></p>
                <p class="chinese-sense">æ„ŸçŸ¥é“¾æ¥ï¼š<span class="finnish-phrase speakable-finnish">jÃ¤Ã¤kaapissa</span> (ç»´åº¦ä¸€ï¼šåœ¨å®¹å™¨é‡Œ)ï¼Œ<span class="finnish-phrase speakable-finnish">edessÃ¤ni</span> (ç»´åº¦ä¸‰ï¼šç›¸å¯¹ä½ç½®-å‰é¢)ï¼Œ<span class="finnish-phrase speakable-finnish">jÃ¤Ã¤kaapista</span> (ç»´åº¦ä¸€ï¼šä»å®¹å™¨å‡ºæ¥)ã€‚åŠ¨è¯ <span class="speakable-finnish">Tarvitsen</span> (æ¨¡å—äºŒï¼šéœ€è¦)ã€‚</p>
            </div>

            <div class="dialogue-step">
                <img src="https://images.pexels.com/photos/4109943/pexels-photo-4109943.jpeg?auto=compress&cs=tinysrgb&w=300" alt="å‡†å¤‡éº¦ç‰‡å’Œå’–å•¡">
                <h5>2. ä½  (MinÃ¤) å‡†å¤‡éº¦ç‰‡å’Œå’–å•¡ï¼š</h5>
                <p><span class="speakable-finnish">MinÃ¤ laitan murokulhon <span class="finnish-phrase">pÃ¶ydÃ¤lle</span>. Sitten minÃ¤ laitan kahvikupin <span class="finnish-phrase">pÃ¶ydÃ¤lle</span>, murokulhon <span class="finnish-phrase">viereen</span>.</span> <span class="note">(æˆ‘æŠŠéº¦ç‰‡ç¢—æ”¾åˆ°æ¡Œå­<span class="highlight">ä¸Š</span>ã€‚ç„¶åæˆ‘æŠŠå’–å•¡æ¯ä¹Ÿæ”¾åˆ°æ¡Œå­<span class="highlight">ä¸Š</span>ï¼Œéº¦ç‰‡ç¢—çš„<span class="highlight">æ—è¾¹</span>ã€‚ <span class="speakable-finnish">murokulho</span>=éº¦ç‰‡ç¢—)</span></p>
                <p><span class="speakable-finnish">MinÃ¤ haluan kahvia ja syÃ¶n muroja.</span> <span class="note">(æˆ‘æƒ³è¦å’–å•¡ï¼Œå¹¶ä¸”æˆ‘åƒéº¦ç‰‡ã€‚)</span></p>
                <p class="chinese-sense">æ„ŸçŸ¥é“¾æ¥ï¼š<span class="finnish-phrase speakable-finnish">pÃ¶ydÃ¤lle</span> (ç»´åº¦äºŒï¼šåˆ°è¡¨é¢ä¸Š)ï¼Œ<span class="finnish-phrase speakable-finnish">viereen</span> (ç»´åº¦ä¸‰/äº”ï¼šåˆ°æ—è¾¹å»ï¼ŒåˆæœŸæ„ŸçŸ¥ä¸ºâ€œæ—è¾¹â€)ã€‚åŠ¨è¯ <span class="speakable-finnish">Haluan</span>, <span class="speakable-finnish">SyÃ¶n</span> (æ¨¡å—äºŒ)ã€‚</p>
            </div>

            <div class="dialogue-step">
                <img src="https://images.pexels.com/photos/7775638/pexels-photo-7775638.jpeg?auto=compress&cs=tinysrgb&w=300" alt="æœ‹å‹èµ°è¿›å¨æˆ¿æ‰¾ç³–">
                <h5>3. æœ‹å‹ (SinÃ¤) èµ°è¿›æ¥ï¼Œæ‰¾ç³–ï¼š</h5>
                <p><span class="speakable-finnish">SinÃ¤ sanot: "Huomenta! MissÃ¤ sokeri on? MinÃ¤ tarvitsen sokeria minun teehen."</span> <span class="note">(ä½ è¯´ï¼šâ€œæ—©ä¸Šå¥½ï¼ç³–åœ¨å“ªé‡Œï¼Ÿæˆ‘çš„èŒ¶éœ€è¦ç³–ã€‚â€ <span class="speakable-finnish">teehen</span> = åˆ°èŒ¶é‡Œï¼ŒIllative)</span></p>
                <p><span class="speakable-finnish">MinÃ¤ vastaan: "Huomenta! Sokeri on <span class="finnish-phrase">kaapissa</span>, sinun <span class="finnish-phrase">ylÃ¤puolella</span>, oven <span class="finnish-phrase">takana</span>."</span> <span class="note">(æˆ‘å›ç­”ï¼šâ€œæ—©ä¸Šå¥½ï¼ç³–åœ¨æ©±æŸœ<span class="highlight">é‡Œ</span>ï¼Œåœ¨ä½ çš„<span class="highlight">ä¸Šæ–¹</span>ï¼Œé—¨çš„<span class="highlight">åé¢</span>ã€‚â€ <span class="speakable-finnish">kaappi</span>=æ©±æŸœ, <span class="speakable-finnish">ovi</span>=é—¨)</span></p>
                <p class="chinese-sense">æ„ŸçŸ¥é“¾æ¥ï¼š<span class="finnish-phrase speakable-finnish">kaapissa</span> (ç»´åº¦ä¸€)ï¼Œ<span class="finnish-phrase speakable-finnish">ylÃ¤puolella</span> (ç»´åº¦ä¸‰ï¼šç›¸å¯¹ä½ç½®-ä¸Šæ–¹)ï¼Œ<span class="finnish-phrase speakable-finnish">takana</span> (ç»´åº¦ä¸‰ï¼šç›¸å¯¹ä½ç½®-åé¢)ã€‚åŠ¨è¯ <span class="speakable-finnish">Tarvitsen</span> (æ¨¡å—äºŒ)ã€‚</p>
            </div>

            <div class="dialogue-step">
                 <img src="https://images.pexels.com/photos/5903179/pexels-photo-5903179.jpeg?auto=compress&cs=tinysrgb&w=300" alt="æœ‹å‹æ‹¿åˆ°ç³–åä¸‹">
                <h5>4. æœ‹å‹ (SinÃ¤) æ‹¿åˆ°ç³–ï¼Œåä¸‹ï¼š</h5>
                <p><span class="speakable-finnish">SinÃ¤ sanot: "Kiitos! MinÃ¤ otan sokerin <span class="finnish-phrase">kaapista</span>. Nyt minÃ¤ istun <span class="finnish-phrase">tuolille</span> sinun <span class="finnish-phrase">vasemmalle</span> puolelle."</span> <span class="note">(ä½ è¯´ï¼šâ€œè°¢è°¢ï¼æˆ‘ä»æ©±æŸœ<span class="highlight">é‡Œ</span>æ‹¿å‡ºç³–ã€‚ç°åœ¨æˆ‘ååˆ°<span class="highlight">åˆ°</span>ä½ <span class="highlight">å·¦è¾¹</span>çš„æ¤…å­<span class="highlight">ä¸Š</span>ã€‚â€ <span class="speakable-finnish">vasemmalle puolelle</span>=åˆ°å·¦è¾¹)</span></p>
                <p><span class="speakable-finnish">SinÃ¤ juot teetÃ¤. SinÃ¤ mietit: "PidÃ¤nkÃ¶ minÃ¤ tÃ¤stÃ¤ teestÃ¤? EhkÃ¤."</span> <span class="note">(ä½ å–èŒ¶ã€‚ä½ æ€è€ƒï¼šâ€œæˆ‘å–œæ¬¢è¿™èŒ¶å—ï¼Ÿä¹Ÿè®¸å§ã€‚â€ <span class="speakable-finnish">mietit</span>=ä½ æ€è€ƒ, <span class="speakable-finnish">PidÃ¤nkÃ¶ minÃ¤...?</span>=æˆ‘å–œæ¬¢...å—ï¼Ÿ <span class="speakable-finnish">ehkÃ¤</span>=ä¹Ÿè®¸)</span></p>
                <p class="chinese-sense">æ„ŸçŸ¥é“¾æ¥ï¼š<span class="finnish-phrase speakable-finnish">kaapista</span> (ç»´åº¦ä¸€)ï¼Œ<span class="finnish-phrase speakable-finnish">tuolille</span> (ç»´åº¦äºŒ)ï¼Œ<span class="finnish-phrase speakable-finnish">vasemmalle puolelle</span> (ç»´åº¦ä¸‰ï¼šç›¸å¯¹ä½ç½®-å·¦è¾¹)ã€‚åŠ¨è¯ <span class="speakable-finnish">Juon</span>, <span class="speakable-finnish">PidÃ¤nkÃ¶</span> (æ¨¡å—äºŒ)ã€‚</p>
            </div>

            <div class="interactive-question">
                <p><strong>å°æµ‹éªŒ1ï¼š</strong>åœ¨ä¸Šé¢çš„å¯¹è¯ä¸­ï¼Œå½“æˆ‘è¯´â€œç‰›å¥¶åœ¨å†°ç®±<span class="highlight">é‡Œ</span>â€(<span class="finnish-phrase speakable-finnish">jÃ¤Ã¤kaapissa</span>)æ—¶ï¼Œé‚£ç§â€œåœ¨é‡Œé¢â€çš„â€œå°¾éŸ³æ„Ÿè§‰â€ä¸»è¦æ˜¯å“ªä¸ªï¼Ÿ</p>
                <button onclick="checkAnswer('q1_1', '-ssa')">-ssa</button>
                <button onclick="checkAnswer('q1_1', '-lle')">-lle</button>
                <button onclick="checkAnswer('q1_1', '-sta')">-sta</button>
                <div id="q1_1_feedback" class="feedback"></div>
            </div>
        </div>
    </section>

    <hr>

    <section id="scenario2-shopping-trip">
        <h2>åœºæ™¯äºŒï¼šä¸€èµ·å»å•†åº—è´­ç‰© ğŸ›ï¸ğŸ›’</h2>
        <div class="scene-card">
            <h4><span class="speakable-finnish">Kauppareissu ystÃ¤vÃ¤n kanssa</span> (å’Œæœ‹å‹çš„è´­ç‰©ä¹‹æ—…)</h4>
            <p class="note">åœºæ™¯æè¿°ï¼šæ—©é¤åï¼Œä½ ï¼ˆ<span class="speakable-finnish">MinÃ¤</span>ï¼‰å’Œæœ‹å‹ï¼ˆ<span class="speakable-finnish">SinÃ¤</span>ï¼‰å†³å®šä¸€èµ·å»é™„è¿‘çš„å•†åº—ä¹°ç‚¹ä¸œè¥¿ã€‚</p>

            <div class="dialogue-step">
                <img src="https://images.pexels.com/photos/5632382/pexels-photo-5632382.jpeg?auto=compress&cs=tinysrgb&w=300" alt="å‡†å¤‡å‡ºé—¨æ‹¿åŒ…å’Œé’¥åŒ™">
                <h5>1. ä½  (MinÃ¤) å‡†å¤‡å‡ºé—¨ï¼š</h5>
                <p><span class="speakable-finnish">MinÃ¤ sanon: "MinÃ¤ tarvitsen minun laukun ja avaimen. MissÃ¤ ne ovat?"</span> <span class="note">(æˆ‘è¯´ï¼šâ€œæˆ‘éœ€è¦æˆ‘çš„åŒ…å’Œé’¥åŒ™ã€‚å®ƒä»¬åœ¨å“ªï¼Ÿâ€ <span class="speakable-finnish">ne</span>=å®ƒä»¬)</span></p>
                <p><span class="speakable-finnish">"Minun laukku on <span class="finnish-phrase">tuolilla</span>. Avain on <span class="finnish-phrase">pÃ¶ydÃ¤llÃ¤</span>, lampun <span class="finnish-phrase">alla</span>. MinÃ¤ otan ne."</span> <span class="note">(æˆ‘çš„åŒ…åœ¨æ¤…å­<span class="highlight">ä¸Š</span>ã€‚é’¥åŒ™åœ¨æ¡Œå­<span class="highlight">ä¸Š</span>ï¼Œç¯çš„<span class="highlight">ä¸‹é¢</span>ã€‚æˆ‘æ‹¿ä¸Šå®ƒä»¬ã€‚)</span></p>
                <p class="chinese-sense">æ„ŸçŸ¥é“¾æ¥ï¼š<span class="finnish-phrase speakable-finnish">tuolilla</span>, <span class="finnish-phrase speakable-finnish">pÃ¶ydÃ¤llÃ¤</span> (ç»´åº¦äºŒ)ï¼Œ<span class="finnish-phrase speakable-finnish">alla</span> (ç»´åº¦ä¸‰)ã€‚åŠ¨è¯ <span class="speakable-finnish">Tarvitsen</span> (æ¨¡å—äºŒ)ã€‚</p>
            </div>

            <div class="dialogue-step">
                <img src="https://images.pexels.com/photos/7084313/pexels-photo-7084313.jpeg?auto=compress&cs=tinysrgb&w=300" alt="ä¸¤äººèµ°å‘å•†åº—">
                <h5>2. ä½ å’Œæœ‹å‹ (SinÃ¤) å‡ºé—¨å»å•†åº—ï¼š</h5>
                <p><span class="speakable-finnish">MinÃ¤ kysyn sinulta: "MennÃ¤Ã¤nkÃ¶ <span class="finnish-phrase">kauppaan</span> nyt? Se on <span class="finnish-phrase">lÃ¤hellÃ¤</span>, vain vÃ¤hÃ¤n matkaa <span class="finnish-phrase">suoraan</span> ja sitten <span class="finnish-phrase">oikealle</span>."</span> <span class="note">(æˆ‘é—®ä½ ï¼šâ€œæˆ‘ä»¬ç°åœ¨å»å•†åº—å—ï¼Ÿå®ƒåœ¨<span class="highlight">é™„è¿‘</span>ï¼Œåªéœ€è¦<span class="highlight">ç›´èµ°</span>ä¸€ç‚¹è·¯ï¼Œç„¶åå‘<span class="highlight">å³</span>ã€‚â€ <span class="speakable-finnish">vÃ¤hÃ¤n matkaa</span>=ä¸€ç‚¹è·¯ç¨‹)</span></p>
                <p><span class="speakable-finnish">SinÃ¤ vastaat: "KyllÃ¤, mennÃ¤Ã¤n! MinÃ¤ haluan ostaa jÃ¤Ã¤telÃ¶Ã¤ <span class="finnish-phrase">kaupasta</span>."</span> <span class="note">(ä½ å›ç­”ï¼šâ€œå¥½ï¼Œæˆ‘ä»¬èµ°ï¼æˆ‘æƒ³è¦ä»å•†åº—<span class="highlight">é‡Œ</span>ä¹°å†°æ·‡æ·‹ã€‚â€ <span class="speakable-finnish">jÃ¤Ã¤telÃ¶</span>=å†°æ·‡æ·‹)</span></p>
                <p class="chinese-sense">æ„ŸçŸ¥é“¾æ¥ï¼š<span class="finnish-phrase speakable-finnish">kauppaan</span> (ç»´åº¦ä¸€ï¼šå»é‡Œé¢)ï¼Œ<span class="finnish-phrase speakable-finnish">lÃ¤hellÃ¤</span> (ç»´åº¦ä¸‰)ï¼Œ<span class="finnish-phrase speakable-finnish">suoraan</span> (æ–¹å‘è¯)ï¼Œ<span class="finnish-phrase speakable-finnish">oikealle</span> (ç»´åº¦ä¸‰/æ–¹å‘è¯)ã€‚åŠ¨è¯ <span class="speakable-finnish">Haluan</span>, <span class="speakable-finnish">ostaa</span> (æ¨¡å—äºŒ)ã€‚</p>
            </div>

            <div class="dialogue-step">
                 <img src="https://images.pexels.com/photos/3944454/pexels-photo-3944454.jpeg?auto=compress&cs=tinysrgb&w=300" alt="åœ¨å•†åº—é‡Œæ‰¾ç‰›å¥¶">
                <h5>3. åœ¨å•†åº—é‡Œ (SinÃ¤)ï¼š</h5>
                <p><span class="speakable-finnish">SinÃ¤ kysyt minulta: "Anteeksi, missÃ¤ maito on? MinÃ¤ en nÃ¤e sitÃ¤."</span> <span class="note">(ä½ é—®æˆ‘ï¼šâ€œè¯·é—®ï¼Œç‰›å¥¶åœ¨å“ªé‡Œï¼Ÿæˆ‘æ²¡çœ‹è§å®ƒã€‚â€)</span></p>
                <p><span class="speakable-finnish">MinÃ¤ vastaan: "Maito on <span class="finnish-phrase">hyllyllÃ¤</span> tuolla <span class="finnish-phrase">takana</span>, mehujen <span class="finnish-phrase">vieressÃ¤</span>."</span> <span class="note">(æˆ‘å›ç­”ï¼šâ€œç‰›å¥¶åœ¨æ¶å­<span class="highlight">ä¸Š</span>ï¼Œåœ¨é‚£è¾¹<span class="highlight">åé¢</span>ï¼Œæœæ±çš„<span class="highlight">æ—è¾¹</span>ã€‚â€ <span class="speakable-finnish">hylly</span>=æ¶å­, <span class="speakable-finnish">mehu</span>=æœæ±)</span></p>
                <p class="chinese-sense">æ„ŸçŸ¥é“¾æ¥ï¼š<span class="finnish-phrase speakable-finnish">hyllyllÃ¤</span> (ç»´åº¦äºŒ)ï¼Œ<span class="finnish-phrase speakable-finnish">takana</span> (ç»´åº¦ä¸‰)ï¼Œ<span class="finnish-phrase speakable-finnish">vieressÃ¤</span> (ç»´åº¦ä¸‰/äº”)ã€‚åŠ¨è¯ <span class="speakable-finnish">En nÃ¤e</span> (æ¨¡å—äºŒå¦å®š)ã€‚</p>
            </div>

            <div class="dialogue-step">
                 <img src="https://images.pexels.com/photos/5632402/pexels-photo-5632402.jpeg?auto=compress&cs=tinysrgb&w=300" alt="ç»“è´¦ç¦»å¼€å•†åº—">
                <h5>4. ç»“è´¦ç¦»å¼€ï¼š</h5>
                <p><span class="speakable-finnish">SinÃ¤ sanot: "MinÃ¤ otan tÃ¤mÃ¤n maidon ja jÃ¤Ã¤telÃ¶n. En tarvitse muuta, kiitos."</span> <span class="note">(ä½ è¯´ï¼šâ€œæˆ‘æ‹¿è¿™ä¸ªç‰›å¥¶å’Œå†°æ·‡æ·‹ã€‚æˆ‘ä¸éœ€è¦åˆ«çš„äº†ï¼Œè°¢è°¢ã€‚â€ <span class="speakable-finnish">muuta</span>=åˆ«çš„(éƒ¨åˆ†æ ¼))</span></p>
                <p><span class="speakable-finnish">MinÃ¤ sanon: "SelvÃ¤. Sitten me tulemme <span class="finnish-phrase">kaupasta</span> ja menemme <span class="finnish-phrase">kotiin</span>. MinÃ¤ haluan syÃ¶dÃ¤ jÃ¤Ã¤telÃ¶Ã¤ <span class="finnish-phrase">kotona</span>!"</span> <span class="note">(æˆ‘è¯´ï¼šâ€œå¥½çš„ã€‚ç„¶åæˆ‘ä»¬ä»å•†åº—<span class="highlight">é‡Œ</span>å‡ºæ¥ï¼Œå›å®¶ã€‚æˆ‘æƒ³åœ¨å®¶<span class="highlight">é‡Œ</span>åƒå†°æ·‡æ·‹ï¼â€)</span></p>
                <p class="chinese-sense">æ„ŸçŸ¥é“¾æ¥ï¼š<span class="finnish-phrase speakable-finnish">kaupasta</span>, <span class="finnish-phrase speakable-finnish">kotiin</span>, <span class="finnish-phrase speakable-finnish">kotona</span> (ç»´åº¦ä¸€)ã€‚åŠ¨è¯ <span class="speakable-finnish">En tarvitse</span>, <span class="speakable-finnish">Haluan syÃ¶dÃ¤</span> (æ¨¡å—äºŒ)ã€‚</p>
            </div>
             <div class="interactive-question">
                <p><strong>å°æµ‹éªŒ2ï¼š</strong>åœ¨ä¸Šé¢çš„å¯¹è¯ä¸­ï¼Œå½“æˆ‘è¯´â€œç‰›å¥¶åœ¨æ¶å­<span class="highlight">ä¸Š</span>â€(<span class="finnish-phrase speakable-finnish">hyllyllÃ¤</span>)æ—¶ï¼Œé‚£ç§â€œåœ¨è¡¨é¢â€çš„â€œå°¾éŸ³æ„Ÿè§‰â€ä¸»è¦æ˜¯å“ªä¸ªï¼Ÿ</p>
                <button onclick="checkAnswer('q1_2', '-lla')">-lla</button>
                <button onclick="checkAnswer('q1_2', '-ssa')">-ssa</button>
                <button onclick="checkAnswer('q1_2', '-lle')">-lle</button>
                <div id="q1_2_feedback" class="feedback"></div>
            </div>
        </div>
    </section>

    <hr>

    <section id="review-language-bleeding-plan" class="practice-plan-card">
        <h2>ç»¼åˆâ€œè¯­è¨€å‡ºè¡€â€è®¡åˆ’ï¼šæˆ‘çš„å‘¨æœ«å‡ºè¡Œ ğŸï¸â˜•</h2>
        <p>ç°åœ¨ï¼Œè¯•ç€ç”¨ä¸€ä¸ªä½ è‡ªå·±çš„å‘¨æœ«ç®€å•å‡ºè¡Œè®¡åˆ’ï¼ˆä¾‹å¦‚ï¼Œä»å®¶å»å…¬å›­ï¼Œåœ¨å…¬å›­çš„é•¿æ¤…ä¸Šä¼‘æ¯ï¼Œç„¶åå»å’–å•¡é¦†å–å’–å•¡ï¼‰ä¸ºä¸»çº¿ï¼Œä¸²è”ä½¿ç”¨æ¨¡å—ä¸‰çš„å„ç§ç©ºé—´è¡¨è¾¾å’Œæ¨¡å—äºŒçš„éœ€æ±‚/è¡Œä¸ºè¡¨è¾¾ã€‚ä½ å¯ä»¥è¯•ç€å†™ä¸‹æ¥ï¼Œæˆ–è€…å¯¹ç€è‡ªå·±è¯´å‡ºæ¥ï¼</p>
        <div class="usage-example">
            <p><strong>å¡«ç©º/é€ å¥æç¤º (ä½ å¯ä»¥æ›¿æ¢æ‹¬å·é‡Œçš„å†…å®¹)ï¼š</strong></p>
            <p><span class="speakable-finnish">Lauantaina minÃ¤ menen <span class="finnish-phrase">[<u>minne? esim. puistoon</u>]</span>.</span> <span class="note">(æ˜ŸæœŸå…­æˆ‘<span style="text-decoration: underline;">å»</span>[<u>å“ªé‡Œï¼Ÿä¾‹å¦‚ å…¬å›­<span class="highlight">é‡Œ</span></u>]ã€‚)</span></p>
            <p><span class="speakable-finnish">MinÃ¤ istun <span class="finnish-phrase">[<u>millÃ¤? esim. penkillÃ¤</u>]</span> <span class="finnish-phrase">[<u>minkÃ¤ alla/vieressÃ¤? esim. puun alla</u>]</span>.</span> <span class="note">(æˆ‘<span style="text-decoration: underline;">ååœ¨</span>[<u>ä»€ä¹ˆ<span class="highlight">ä¸Š</span>ï¼Ÿä¾‹å¦‚ é•¿æ¤…ä¸Š</u>] [<u>åœ¨ä»€ä¹ˆä¸‹é¢/æ—è¾¹ï¼Ÿä¾‹å¦‚ æ ‘ä¸‹</u>]ã€‚)</span></p>
            <p><span class="speakable-finnish">MinÃ¤ haluan [<u>tehdÃ¤ mitÃ¤? esim. lukea kirjaa</u>].</span> <span class="note">(æˆ‘<span style="text-decoration: underline;">æƒ³è¦</span>[<u>åšä»€ä¹ˆï¼Ÿä¾‹å¦‚ è¯»ä¼šå„¿ä¹¦</u>]ã€‚)</span></p>
            <p><span class="speakable-finnish">Sitten minÃ¤ tulen <span class="finnish-phrase">[<u>mistÃ¤? esim. puistosta</u>]</span> ja menen <span class="finnish-phrase">[<u>minne? esim. kahvilaan</u>]</span>.</span> <span class="note">(ç„¶åæˆ‘<span style="text-decoration: underline;">ä»</span>[<u>å“ªé‡Œ<span class="highlight">å‡ºæ¥</span>ï¼Ÿä¾‹å¦‚ å…¬å›­é‡Œ</u>] <span style="text-decoration: underline;">å»</span>[<u>å“ªé‡Œ<span class="highlight">é‡Œ</span>ï¼Ÿä¾‹å¦‚ å’–å•¡é¦†é‡Œ</u>]ã€‚)</span></p>
            <p><span class="speakable-finnish">MinÃ¤ juon [<u>mitÃ¤? esim. kahvia</u>] <span class="finnish-phrase">[<u>missÃ¤? esim. kahvilassa</u>]</span>. MinÃ¤ pidÃ¤n [<u>mistÃ¤? esim. siitÃ¤ kahvista</u>].</span> <span class="note">(æˆ‘<span style="text-decoration: underline;">å–</span>[<u>ä»€ä¹ˆï¼Ÿä¾‹å¦‚ å’–å•¡</u>] [<u>åœ¨å“ªé‡Œ<span class="highlight">é‡Œ</span>ï¼Ÿä¾‹å¦‚ å’–å•¡é¦†é‡Œ</u>]ã€‚æˆ‘<span style="text-decoration: underline;">å–œæ¬¢</span>[<u>ä»€ä¹ˆï¼Ÿä¾‹å¦‚ é‚£æ¯å’–å•¡</u>]ã€‚)</span></p>
        </div>
    </section>

    <hr>

    <section id="review-summary" class="summary-card">
        <h2>âœ¨ ä½ çš„ç©ºé—´é­”æ³•å·¥å…·ç®±è¶Šæ¥è¶Šå¼ºå¤§äº†ï¼</h2>
        <p>å¤ªæ£’äº†ï¼ä½ ç°åœ¨å·²ç»èƒ½ç”¨èŠ¬å…°è¯­è°ˆè®ºå¾ˆå¤šå…³äºç©ºé—´çš„äº‹æƒ…äº†ï¼å›é¡¾ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¸€èµ·æ„Ÿå—äº†ï¼š</p>
        <ul class="final-summary-list">
            <li><span class="speakable-finnish">ç‰©ä½“åœ¨â€œå°é—­å®¹å™¨â€çš„â€˜<span class="finnish-phrase">-ssa</span>â€™ (é‡Œé¢æ„Ÿ), â€˜<span class="finnish-phrase">-Vn/-seen</span>â€™ (è¿›å»æ„Ÿ), â€˜<span class="finnish-phrase">-sta</span>â€™ (å‡ºæ¥æ„Ÿ)ã€‚</span></li>
            <li><span class="speakable-finnish">ç‰©ä½“åœ¨â€œç‰©ä½“è¡¨é¢â€æˆ–â€œå¼€æ”¾åœ°ç‚¹â€çš„â€˜<span class="finnish-phrase">-lla</span>â€™ (ä¸Šé¢/æ—è¾¹æ„Ÿ), â€˜<span class="finnish-phrase">-lle</span>â€™ (åˆ°...ä¸Šå»/å»æ„Ÿ), â€˜<span class="finnish-phrase">-lta</span>â€™ (ä»...ä¸Šç¦»å¼€æ„Ÿ)ã€‚</span></li>
            <li><span class="speakable-finnish">ä»â€œæˆ‘â€æˆ–â€œä½ â€çš„è§’åº¦çœ‹ï¼Œç‰©ä½“åœ¨â€˜<span class="finnish-phrase">edessÃ¤</span>â€™(å‰é¢), â€˜<span class="finnish-phrase">takana</span>â€™(åé¢), â€˜<span class="finnish-phrase">vasemmalla</span>â€™(å·¦è¾¹), â€˜<span class="finnish-phrase">oikealla</span>â€™(å³è¾¹)ç­‰ç­‰ã€‚</span></li>
        </ul>
        <p>ä½ è¿˜æŠŠè¿™äº›ç©ºé—´è¯´æ³•å’Œä½ æ¨¡å—äºŒå­¦çš„ï¼š</p>
        <ul class="final-summary-list">
            <li><span class="speakable-finnish">â€˜Haluanâ€™ (æˆ‘æƒ³è¦)</span></li>
            <li><span class="speakable-finnish">â€˜Tarvitsenâ€™ (æˆ‘éœ€è¦)</span></li>
            <li><span class="speakable-finnish">â€˜PidÃ¤nâ€™ (æˆ‘å–œæ¬¢)</span></li>
            <li><span class="speakable-finnish">â€˜SyÃ¶nâ€™ (æˆ‘åƒ) / â€˜Juonâ€™ (æˆ‘å–)</span></li>
            <li><span class="speakable-finnish">ä»¥åŠå®ƒä»¬çš„å¦å®šå½¢å¼ (En halua, En tarvitse, jne.)</span></li>
        </ul>
        <p>è¿™äº›é‡è¦çš„æ—¥å¸¸è¡¨è¾¾éƒ½å·§å¦™åœ°ç»“åˆèµ·æ¥äº†ï¼</p>
        <p>æœ€é‡è¦çš„æ˜¯ï¼Œä½ ä¸æ˜¯åœ¨èƒŒè§„åˆ™ï¼Œä½ æ˜¯åœ¨**æ„Ÿå—**è¿™äº›ä¸åŒè¯´æ³•å¸¦æ¥çš„ä¸åŒâ€˜ç”»é¢æ„Ÿâ€™å’Œâ€˜å£°éŸ³æ„Ÿè§‰â€™ã€‚ç»§ç»­ä¿æŒè¿™ç§æ–¹å¼ï¼Œä½ çš„èŠ¬å…°è¯­ä¼šè¶Šæ¥è¶Šæ£’ï¼</p>
        <p><strong>ä¸‹ä¸€ç»´åº¦é¢„å‘Šï¼š</strong> æˆ‘ä»¬å°†ç»§ç»­æ‰©å±•ä½ çš„ç©ºé—´è¯å…¸ï¼Œçœ‹çœ‹èŠ¬å…°è¯­å¦‚ä½•è¡¨è¾¾æ›´å¤§èŒƒå›´çš„â€œæ–¹å‘â€ï¼ˆæ¯”å¦‚ä¸œå—è¥¿åŒ—ï¼‰ï¼Œä»¥åŠç‰©ä½“ä¹‹é—´æ›´ç²¾ç¡®çš„â€œä½ç½®å…³ç³»â€ï¼ˆæ¯”å¦‚åœ¨ä¸¤ä¸ªä¸œè¥¿çš„ä¸­é—´ï¼‰ã€‚æ•¬è¯·æœŸå¾…ã€ç»´åº¦å››ã€‘å’Œã€ç»´åº¦äº”ã€‘çš„æ¢ç´¢ï¼</p>
    </section>

<script>
    const finnishLang = 'fi-FI';

    function debugLog(message) {
        const output = document.getElementById('debug-output');
        if (output && output.innerHTML !== undefined) {
            const time = new Date().toLocaleTimeString();
            output.innerHTML += `[${time}] ${message}<br>`;
            output.scrollTop = output.scrollHeight;
        }
    }

    function testBasicTTS() {
        debugLog('å¼€å§‹æµ‹è¯•åŸºæœ¬TTSåŠŸèƒ½...');
        if (!('speechSynthesis' in window)) {
            debugLog('âŒ é”™è¯¯ï¼šæµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆAPI');
            alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½ã€‚');
            return;
        }
        debugLog('âœ… æµè§ˆå™¨æ”¯æŒè¯­éŸ³åˆæˆAPI');
        const utterance = new SpeechSynthesisUtterance('Hello World');
        utterance.onstart = () => debugLog('âœ… è‹±è¯­æµ‹è¯•å¼€å§‹æ’­æ”¾');
        utterance.onend = () => debugLog('âœ… è‹±è¯­æµ‹è¯•æ’­æ”¾å®Œæˆ');
        utterance.onerror = (event) => debugLog('âŒ è‹±è¯­æµ‹è¯•é”™è¯¯: ' + event.error);
        window.speechSynthesis.speak(utterance);
    }

    function testFinnishTTSModule3_Review() { 
        debugLog('å¼€å§‹æµ‹è¯•èŠ¬å…°è¯­TTSåŠŸèƒ½ (æ¨¡å—3å¤ä¹ )...');
        const utterance = new SpeechSynthesisUtterance('MinÃ¤ tarvitsen maitoa. MissÃ¤ maito on?');
        utterance.lang = finnishLang;
        utterance.onstart = () => debugLog('âœ… èŠ¬å…°è¯­(M3 Review)æµ‹è¯•å¼€å§‹æ’­æ”¾');
        utterance.onend = () => debugLog('âœ… èŠ¬å…°è¯­(M3 Review)æµ‹è¯•æ’­æ”¾å®Œæˆ');
        utterance.onerror = (event) => debugLog('âŒ èŠ¬å…°è¯­(M3 Review)æµ‹è¯•é”™è¯¯: ' + event.error);
        window.speechSynthesis.speak(utterance);
    }
     function listVoices() {
        debugLog('æ­£åœ¨è·å–å¯ç”¨è¯­éŸ³åˆ—è¡¨...');
        const voices = window.speechSynthesis.getVoices();
        if (voices.length === 0) {
            debugLog('âš ï¸ æœªæ‰¾åˆ°ä»»ä½•è¯­éŸ³ï¼Œè¯­éŸ³å¯èƒ½è¿˜åœ¨åŠ è½½ä¸­ã€‚');
            window.speechSynthesis.onvoiceschanged = () => {
                debugLog('è¯­éŸ³åˆ—è¡¨å·²æ›´æ–°ï¼Œé‡æ–°è·å–...');
                const updatedVoices = window.speechSynthesis.getVoices();
                if (updatedVoices.length === 0 && voices.length === 0) { 
                    debugLog('âš ï¸ æ›´æ–°åä»æœªæ‰¾åˆ°ä»»ä½•è¯­éŸ³ã€‚'); return;
                }
                if (updatedVoices.length > 0) logVoiceList(updatedVoices);
            };
            if (navigator.userAgent.toLowerCase().indexOf('firefox') > -1 || (navigator.userAgent.toLowerCase().indexOf('safari') > -1 && navigator.userAgent.toLowerCase().indexOf('chrome') === -1) ) {
                setTimeout(() => { if(window.speechSynthesis.getVoices().length > 0) listVoices(); }, 500);
            }
            return;
        }
        logVoiceList(voices);
    }
     function logVoiceList(voices) {
        debugLog(`æ‰¾åˆ° ${voices.length} ä¸ªå¯ç”¨è¯­éŸ³:`);
        voices.forEach((voice, index) => {
            const isDefault = voice.default ? ' (é»˜è®¤)' : '';
            debugLog(`${index + 1}. ${voice.name} (${voice.lang})${isDefault}`);
        });
        const finnishVoices = voices.filter(voice =>
            voice.lang.toLowerCase().startsWith('fi') ||
            voice.name.toLowerCase().includes('finnish') ||
            voice.name.toLowerCase().includes('suomi')
        );
        if (finnishVoices.length > 0) {
            debugLog(`âœ… æ‰¾åˆ° ${finnishVoices.length} ä¸ªèŠ¬å…°è¯­è¯­éŸ³:`);
            finnishVoices.forEach(voice => {
                debugLog(`  - ${voice.name} (${voice.lang})`);
            });
        } else {
            debugLog('âŒ æœªæ‰¾åˆ°èŠ¬å…°è¯­è¯­éŸ³ã€‚');
        }
    }

    function removeDebugSection() {
        const debugSection = document.querySelector('.debug-section');
        if (debugSection) {
            debugSection.style.display = 'none';
            debugLog('è°ƒè¯•åŒºåŸŸå·²éšè—');
        }
    }

    let isSpeaking = false;
    function speakText(text, lang = finnishLang) {
        if (!('speechSynthesis' in window)) return;
        if (isSpeaking) {
            window.speechSynthesis.cancel();
            setTimeout(() => startSpeaking(text, lang), 50);
        } else {
            startSpeaking(text, lang);
        }
    }

    function startSpeaking(text, lang) {
        isSpeaking = true;
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = lang;
        utterance.rate = 0.9;
        utterance.pitch = 1.0;
        utterance.volume = 1.0;
        const voices = window.speechSynthesis.getVoices();
        let selectedVoice = null;
        if (lang.toLowerCase().startsWith('fi')) {
            selectedVoice = voices.find(voice => voice.lang.toLowerCase() === 'fi-fi') ||
                            voices.find(voice => voice.lang.toLowerCase().startsWith('fi')) ||
                            voices.find(voice => voice.name.toLowerCase().includes('finnish') || voice.name.toLowerCase().includes('suomi'));
        }
        if (selectedVoice) utterance.voice = selectedVoice;
        utterance.onend = () => { isSpeaking = false; };
        utterance.onerror = (event) => {
            debugLog(`âŒ æ’­æ”¾é”™è¯¯: ${event.error} (æ–‡æœ¬: "${text}")`);
            isSpeaking = false;
        };
        window.speechSynthesis.speak(utterance);
    }

    function addTTSButton(element, textToSpeak) {
        let cleanedText = textToSpeak.replace(/\s*\(.*?\)\s*/g, '').trim(); 
        cleanedText = cleanedText.replace(/ï¼ˆ.*?ï¼‰/g, '').trim();
        cleanedText = cleanedText.replace(/\[.*?\]/g, '').trim(); 

        if (!cleanedText || cleanedText === '') return;
        
        const existingButton = Array.from(element.childNodes).find(node => node.nodeType === Node.ELEMENT_NODE && node.classList.contains('tts-button') && node.title === 'æ’­æ”¾: ' + cleanedText);
        if (existingButton) return;

        const button = document.createElement('button');
        button.className = 'tts-button';
        button.innerHTML = 'ğŸ”Š';
        button.title = 'æ’­æ”¾: ' + cleanedText;
        button.setAttribute('aria-label', 'æ’­æ”¾éŸ³é¢‘: ' + cleanedText);
        button.onclick = (event) => {
            event.preventDefault();
            event.stopPropagation();
            speakText(cleanedText);
        };
        
        if (element.tagName === 'SPAN' && (element.classList.contains('speakable-finnish') || element.classList.contains('finnish-phrase'))) {
            if (!element.querySelector('.tts-button')) {
                element.appendChild(button);
            }
        } else {
            let insertBeforeNode = null;
            for (let i = 0; i < element.childNodes.length; i++) {
                const child = element.childNodes[i];
                if (child.nodeType === Node.ELEMENT_NODE && (child.classList.contains('note') || child.classList.contains('chinese-sense'))) {
                    insertBeforeNode = child;
                    break;
                }
            }
            if (insertBeforeNode) {
                element.insertBefore(button, insertBeforeNode);
            } else {
                element.appendChild(button);
            }
        }
    }
    
    function initializeTTSForPage() {
        debugLog('ğŸš€ åˆå§‹åŒ–é¡µé¢TTSæŒ‰é’® (æ¨¡å—ä¸‰ ç»¼åˆå¤ä¹ )...');
        
        document.querySelectorAll('.speakable-finnish, .finnish-phrase').forEach(span => {
            const text = span.textContent.trim();
            if (text && !span.querySelector('.tts-button')) {
                 addTTSButton(span, text);
            }
        });

        const sentenceLevelContainers = [
            ...document.querySelectorAll('.dialogue-step p'),
            ...document.querySelectorAll('.interactive-question p'),
            ...document.querySelectorAll('.practice-plan-card .usage-example p'),
            ...document.querySelectorAll('.summary-card p'),
            ...document.querySelectorAll('.summary-card ul li'),
            ...document.querySelectorAll('#review-intro p')
        ];

        sentenceLevelContainers.forEach(el => {
            if (el.classList.contains('speakable-finnish') || el.classList.contains('finnish-phrase')) return;
            
            let hasButtonAlready = false;
            if (el.querySelector('.tts-button')) { // Check if a descendant already has a button
                 hasButtonAlready = true;
            } else { // Check if this element itself directly has a button
                const directButton = Array.from(el.childNodes).find(node => node.nodeType === Node.ELEMENT_NODE && node.classList.contains('tts-button'));
                if (directButton) hasButtonAlready = true;
            }
            if (hasButtonAlready) return;

            if (el.closest('thead')) return;

            let textToSpeak = "";
            Array.from(el.childNodes).forEach(node => {
                if (node.nodeType === Node.TEXT_NODE) {
                    textToSpeak += node.textContent;
                } else if (node.nodeType === Node.ELEMENT_NODE &&
                           !node.classList.contains('note') &&
                           !node.classList.contains('chinese-sense') &&
                           !node.classList.contains('tts-button') &&
                           !node.classList.contains('speakable-finnish') && 
                           !node.classList.contains('finnish-phrase') &&
                           !node.classList.contains('highlight') 
                           ) {
                    textToSpeak += node.textContent; 
                }
            });
            textToSpeak = textToSpeak.trim();
            
            if (textToSpeak.length > 1 && textToSpeak.match(/[Ã¤Ã¶Ã¥Ã„Ã–Ã…]/i)) { 
                addTTSButton(el, textToSpeak);
            }
        });
        
        document.querySelectorAll('.scene-card h4 .speakable-finnish, .practice-plan-card .task-list h5 .speakable-finnish, #review-intro h2 .speakable-finnish, #review-summary h2 .speakable-finnish').forEach(el => {
             if(!el.querySelector('.tts-button')) addTTSButton(el, el.textContent);
        });
        
        document.querySelectorAll('#review-intro h2, #scenario1-kitchen-morning h2, #scenario2-shopping-trip h2, #review-language-bleeding-plan h2, #review-summary h2').forEach(h => {
            if (!h.querySelector('.tts-button')) { // Check if button already added (e.g. via child span)
                const text = h.textContent.split('(')[0].trim();
                if (text.length > 1 && text.match(/[Ã¤Ã¶Ã¥Ã„Ã–Ã…]/i)) {
                    addTTSButton(h, text);
                }
            }
        });

        debugLog('âœ… é¡µé¢TTSæŒ‰é’®åˆå§‹åŒ–å®Œæ¯• (æ¨¡å—ä¸‰ ç»¼åˆå¤ä¹ )');
    }

    // Simple Quiz Logic for review
    function checkAnswer(questionId, correctAnswer) {
        const selectedOption = document.querySelector(`input[name="${questionId}"]:checked`);
        const feedbackEl = document.getElementById(questionId + '_feedback');
        if (!selectedOption) {
            feedbackEl.innerHTML = "<span class='speakable-finnish'>Valitse vastaus!</span> (è¯·é€‰æ‹©ç­”æ¡ˆ!)";
            feedbackEl.className = 'feedback incorrect';
            addTTSButton(feedbackEl.querySelector('.speakable-finnish'), "Valitse vastaus!");
            speakText("Valitse vastaus!");
            return;
        }
        if (selectedOption.value === correctAnswer) {
            feedbackEl.innerHTML = "<span class='speakable-finnish'>Oikein! HyvÃ¤Ã¤ tyÃ¶tÃ¤!</span> (æ­£ç¡®ï¼å¹²å¾—å¥½ï¼)";
            feedbackEl.className = 'feedback correct';
             addTTSButton(feedbackEl.querySelector('.speakable-finnish'), "Oikein! HyvÃ¤Ã¤ tyÃ¶tÃ¤!");
            speakText("Oikein! HyvÃ¤Ã¤ tyÃ¶tÃ¤!");
        } else {
            feedbackEl.innerHTML = "<span class='speakable-finnish'>Ei ihan. YritÃ¤ uudelleen!</span> (ä¸å¤ªå¯¹ã€‚å†è¯•ä¸€æ¬¡ï¼)";
            feedbackEl.className = 'feedback incorrect';
            addTTSButton(feedbackEl.querySelector('.speakable-finnish'), "Ei ihan. YritÃ¤ uudelleen!");
            speakText("Ei ihan. YritÃ¤ uudelleen!");
        }
    }
    // Q1_1 and Q1_2 are simplified from original prompt as no radio buttons were used.
    // Re-implementing the button based quiz for q1_1 and q1_2
    function checkAnswer(quizId, selectedValue) {
        const feedbackEl = document.getElementById(quizId + '_feedback');
        let correctAnswer, à¤¸à¤¹à¥€_à¤œà¤µà¤¾à¤¬_à¤µà¤¾à¤•à¥à¤¯;
        if (quizId === 'q1_1') {
            correctAnswer = '-ssa';
            à¤¸à¤¹à¥€_à¤œà¤µà¤¾à¤¬_à¤µà¤¾à¤•à¥à¤¯ = "Maito on jÃ¤Ã¤kaapissa.";
        } else if (quizId === 'q1_2') {
            correctAnswer = '-lla';
            à¤¸à¤¹à¥€_à¤œà¤µà¤¾à¤¬_à¤µà¤¾à¤•à¥à¤¯ = "Maito on hyllyllÃ¤.";
        }

        if (selectedValue === correctAnswer) {
            feedbackEl.innerHTML = `<span class="speakable-finnish">Oikein! Esimerkiksi: "${à¤¸à¤¹à¥€_Ø¬à¤µà¤¾à¤¬_à¤µà¤¾à¤•à¥à¤¯}"</span>`;
            feedbackEl.className = 'feedback correct';
        } else {
            feedbackEl.innerHTML = `<span class="speakable-finnish">Ei ihan. Oikea "Ã¤Ã¤nituntuma" olisi lÃ¤hempÃ¤nÃ¤ tÃ¤tÃ¤: "${à¤¸à¤¹à¥€_à¤œà¤µà¤¾à¤¬_à¤µà¤¾à¤•à¥à¤¯}" YritÃ¤ uudelleen kuunnella esimerkkejÃ¤!</span>`;
            feedbackEl.className = 'feedback incorrect';
        }
        const speakableFeedback = feedbackEl.querySelector('.speakable-finnish');
        if (speakableFeedback && !speakableFeedback.querySelector('.tts-button')) {
            addTTSButton(speakableFeedback, speakableFeedback.textContent);
        }
        if(speakableFeedback) speakText(speakableFeedback.textContent.split('.')[0].split('"')[0].trim() + '.');
    }


    document.addEventListener('DOMContentLoaded', () => {
        if (window.speechSynthesis.getVoices().length === 0) {
            window.speechSynthesis.onvoiceschanged = initializeTTSForPage;
        } else {
            initializeTTSForPage();
        }
        setTimeout(initializeTTSForPage, 200); 
    });
</script>
</body>
</html>